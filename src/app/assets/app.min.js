!function(){"use strict";angular.module("FHIRCloud",["ngAnimate","ngMaterial","ngRoute","ngSanitize","ngMessages","ngCookies","common","ui.bootstrap"])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(a,b){return c.all(a).then(function(a){var c={controllerId:b};l(g.config.controllerActivateSuccessEvent,c)})}function j(a){if(angular.isDefined(a)){var c={activeServer:a};f.localStorage.removeItem("patient"),f.localStorage.removeItem("organization");var d=b.path();"/patient"!==d&&"/organization"!==d&&b.path("/home"),l(g.config.serverChangeEvent,c)}}function k(a){var b={show:a};l(g.config.progressToggleEvent,b)}function l(){return d.$broadcast.apply(d,arguments)}function m(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)})}function n(a){return/^[-]?\d+$/.test(a)}function o(a){var b=new RegExp("^(?:[a-z]+:)?//","i");return b.test(a)}function p(a){var b={given:[],family:[],text:a};if(a)for(var c=a.split(" "),d=parseInt(c.length,10),e=parseInt(Math.ceil(d/2),10),f=0;e>f;f++)b.given.push(c[f]),c[e+f]&&b.family.push(d%2>0&&f>0?c[e+f]:c[e+f]);return b}function q(a,b){for(var c,d=0;d<b.length;d++)if(a===b[d].display){c=b[d];break}return c}function r(a){return Object.keys(a).map(function(b){a[b]instanceof Object?Object.keys(a[b]).length||"function"==typeof a[b].getMonth?r(a[b]):delete a[b]:null===a[b]&&delete a[b]}),a}function s(a,b){var c=a;if(angular.isUndefined(b)===!1&&angular.isUndefined(a)){var d=b.indexOf("/_history");c=d>0?b.substring(0,d):b}return c}function t(a,b){return a&&-1!==a.toLowerCase().indexOf(b.toLowerCase())}function u(a){var b="Unexpected response from server - ";return a.status&&(b=b+"HTTP Status: "+a.status),a.outcome&&a.outcome.issue&&_.forEach(a.outcome.issue,function(a){b=b+": "+a.severity+" - "+a.details}),b}function v(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;5>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function w(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}var x={$broadcast:l,$http:a,$q:c,$timeout:e,activateController:i,changeServer:j,generateUUID:m,isAbsoluteUri:o,isNumber:n,logger:h,makeHumanName:p,mapDisplayToCoding:q,randomHash:v,removeNullProperties:r,setResourceId:s,shuffle:w,textContains:t,toggleProgressBar:k,unexpectedOutcome:u};return x}var b=angular.module("common",[]);b.provider("commonConfig",function(){this.config={},this.$get=function(){return{config:this.config}}}),b.factory("common",["$http","$location","$q","$rootScope","$timeout","$window","commonConfig","logger",a])}(),function(){"use strict";var a=angular.module("FHIRCloud"),b={imageBasePath:"./assets/jpeg/",unknownPersonImageSource:"./assets/jpeg/unknown_person.jpg"},c={backspace:8,tab:9,enter:13,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46},d={controllerActivateSuccess:"controller.activateSuccess",progressToggle:"progress.toggle",serverChanged:"server.changed"},e={appErrorPrefix:"[FS Error] ",docTitle:"FHIRCloud: ",events:d,imageSettings:b,keyCodes:c,version:"0.1.0"};a.value("config",e),a.config(["$logProvider",function(a){a.debugEnabled&&a.debugEnabled(!0)}]),a.config(["$routeProvider",function(a){a.when("/conformance",{templateUrl:"conformance/conformance-search.html"}).when("/conformance/view/:hashKey",{templateUrl:"conformance/conformance-view.html"}).when("/consultation",{templateUrl:"consultation/consultation-edit.html"}).when("/consultation/smart/:smartApp/:patientId",{templateUrl:"consultation/consultation-smart.html"}).when("/extensionDefinition",{templateUrl:"extensionDefinition/extensionDefinition-search.html"}).when("/extensionDefinition/view/:hashKey",{templateUrl:"extensionDefinition/extensionDefinition-view.html"}).when("/extensionDefinition/edit/:hashKey",{templateUrl:"extensionDefinition/extensionDefinition-edit.html"}).when("/home",{templateUrl:"home/home.html"}).when("/lab",{templateUrl:"lab/lab-edit.html"}).when("/operationDefinition",{templateUrl:"operationDefinition/operationDefinition-search.html"}).when("/operationDefinition/view/:hashKey",{templateUrl:"operationDefinition/operationDefinition-view.html"}).when("/operationDefinition/edit/:hashKey",{templateUrl:"operationDefinition/operationDefinition-edit.html"}).when("/organization",{templateUrl:"organization/organization-search.html"}).when("/organization/get/:id",{templateUrl:"organization/organization-view.html"}).when("/organization/detailed-search",{templateUrl:"organization/organization-detailed-search.html"}).when("/organization/view/:hashKey",{templateUrl:"organization/organization-view.html"}).when("/organization/edit/:hashKey",{templateUrl:"organization/organization-edit.html"}).when("/organization/get/:resourceId",{templateUrl:"organization/organization-view.html"}).when("/patient/org/:orgId",{templateUrl:"patient/patient-detailed-search.html"}).when("/patient",{templateUrl:"patient/patient-search.html"}).when("/patient/get/:id",{templateUrl:"patient/patient-view.html"}).when("/patient/view/:hashKey",{templateUrl:"patient/patient-view.html"}).when("/patient/edit/:hashKey",{templateUrl:"patient/patient-edit.html"}).when("/patient/detailed-search",{templateUrl:"patient/patient-detailed-search.html"}).when("/practitioner",{templateUrl:"practitioner/practitioner-search.html"}).when("/person",{templateUrl:"person/person-search.html"}).when("/person/view/:hashKey",{templateUrl:"person/person-view.html"}).when("/person/edit/:hashKey",{templateUrl:"person/person-edit.html"}).when("/profile",{templateUrl:"profile/profile-search.html"}).when("/profile/view/:hashKey",{templateUrl:"profile/profile-view.html"}).when("/profile/edit/:hashKey",{templateUrl:"profile/profile-edit.html"}).when("/healthcareService",{templateUrl:"templates/home.html"}).when("/relatedPerson",{templateUrl:"relatedPerson/relatedPerson-search.html"}).when("/relatedPerson/view/:hashKey",{templateUrl:"relatedPerson/relatedPerson-view.html"}).when("/relatedPerson/edit/:hashKey",{templateUrl:"person/person-edit.html"}).when("/valueSet",{templateUrl:"valueSet/valueSet-search.html"}).when("/valueSet/view/:hashKey",{templateUrl:"valueSet/valueSet-view.html"}).when("/valueSet/edit/:hashKey",{templateUrl:"valueSet/valueSet-edit.html"}).when("/daf/:profile",{templateUrl:"templates/daf.html"}).otherwise({redirectTo:"/home"})}]),a.config(["$mdThemingProvider","$mdIconProvider",function(a,b){a.theme("default").primaryPalette("light-blue").accentPalette("green"),b.icon("actions","./assets/svg/actions.svg",24).icon("account","./assets/svg/account.svg",24).icon("add","./assets/svg/add.svg",24).icon("cardio","./assets/svg/cardio3.svg",24).icon("cloud","./assets/svg/cloud.svg",24).icon("consult","./assets/svg/stethoscope.svg",24).icon("delete","./assets/svg/delete.svg",24).icon("edit","./assets/svg/edit.svg",24).icon("error","./assets/svb/error.svg",48).icon("female","./assets/svg/female.svg",24).icon("fire","./assets/svg/fire.svg",24).icon("group","./assets/svg/group.svg",24).icon("groupAdd","./assets/svg/groupAdd.svg",24).icon("healing","./assets/svg/healing.svg",24).icon("hospital","./assets/svg/hospital.svg",24).icon("https","./assets/svg/https.svg",24).icon("lab","./assets/svg/lab3.svg",24).icon("list","./assets/svg/list.svg",24).icon("male","./assets/svg/male.svg",24).icon("menu","./assets/svg/menu.svg",24).icon("more","./assets/svg/more.svg",24).icon("openId","./assets/svg/openId.svg",24).icon("organization","./assets/svg/hospital.svg",24).icon("person","./assets/svg/person.svg",24).icon("personAdd","./assets/svg/personAdd.svg",24).icon("practitioner","./assets/svg/md.svg",24).icon("refresh","./assets/svg/refresh.svg",24).icon("rx","./assets/svg/rx.svg",24).icon("saveToCloud","./assets/svg/saveToCloud.svg",24).icon("saveToList","./assets/svg/saveToList.svg",24).icon("search","./assets/svg/search.svg",24).icon("settings","./assets/svg/settings.svg",24).icon("smart","./assets/svg/SMART.svg",24).icon("view","./assets/svg/visibility.svg",12).icon("vitals","./assets/svg/pulse1.svg",24)}]),a.config(["$httpProvider",function(a){a.defaults.headers.common={Accept:"application/json+fhir, application/json, text/plain, */*"},a.defaults.headers.put={"Content-Type":"application/json+fhir"},a.defaults.headers.post={"Content-Type":"application/json+fhir"}}]),a.config(["commonConfigProvider",function(a){a.config.controllerActivateSuccessEvent=e.events.controllerActivateSuccess,a.config.progressToggleEvent=e.events.progressToggle,a.config.serverChangeEvent=e.events.serverChanged}]),a.config(["$compileProvider",function(a){a.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|file|chrome-extension):|data:image\//)}])}(),function(){"use strict";function a(a){function b(a,b){f.put(a,b)}function c(){return f.info()}function d(a,b){var c;if(a&&b){var d=e(b);if(d)for(var f=0,g=d.length;g>f;f++)if(d[f].$$hashKey===a){c=d[f];break}}return c}function e(a){return f.get(a)}var f=a("fhirCache",{capacity:20}),g={addToCache:b,readFromCache:e,getCacheStats:c,getItemFromCache:d};return g}var b="dataCache";angular.module("FHIRCloud").factory(b,["$cacheFactory",a])}(),function(){"use strict";var a=angular.module("FHIRCloud");a.directive("fcGenderIcon",["$compile",function(a){var b={restrict:"E",scope:{gender:"=?"},link:function(b,c,d){var e=b.gender;if(angular.isDefined(e)){e=e.toLowerCase();var f='<md-icon md-svg-icon="'+e+'" style="height: 12px; width=12px"></md-icon>';c.append(a(f)(b))}}};return b}]),a.directive("fsAddListItem",["$parse",function(a){function b(b,c,d){var e=a(d.fsAddListItem),f=e.assign,g=a(d.onChange),h=function(){b.$apply(function(){f(b,c[0].files[0]),g(b)})};c.bind("change",h)}var c={restrict:"EA",template:"<input multiple='false' type='file' />",replace:!0,link:b};return c}]),a.directive("fsPagination",function(){var a={restrict:"E",scope:{click:"&onClick",links:"=links",refresh:"=?"},templateUrl:"templates/pagination.html",link:function(a,b,c){a.$watch("links",function(b){b&&(a.refresh=_.remove(b,function(a){return"self"===a.relation}))})}};return a}),a.directive("fsAddToList",[function(){function a(a,b,c){a.$watch("fsAddToList",function(a){a===!0&&(c.$set("class","glyphicon glyphicon-plus"),c.$set("tooltip","Add item to list"))})}var b={restrict:"A",replace:!0,link:a,scope:{fsAddToList:"=?"}};return b}]),a.directive("fsFileInput",function(a){function b(b,c,d){var e=a(d.fsFileInput),f=e.assign,g=a(d.onChange),h=function(){b.$apply(function(){f(b,c[0].files[0]),g(b)})};c.bind("change",h)}var c={restrict:"EA",template:"<input multiple='false' type='file' />",replace:!0,link:b};return c}),a.directive("fsImgPerson",["config",function(a){function b(b,c,d){b.$watch("fsImgPerson",function(b){var c=a.imageSettings.unknownPersonImageSource;b&&(b.url?c=b.url:b.data&&(c="data:"+b.contentType+";base64,"+b.data)),d.$set("src",c)})}var c={link:b,scope:{fsImgPerson:"=?"},restrict:"A"};return c}]),a.directive("fsRepeats",[function(){function a(a,b,c){a.$watch("fsRepeats",function(a){a===!0&&c.$set("class","fa fa-repeat")})}var b={restrict:"A",replace:!0,link:a,scope:{fsRepeats:"=?"}};return b}]),a.directive("fsRequired",[function(){function a(a,b,c){a.$watch("fsRequired",function(a){a===!0&&c.$set("class","fa fa-asterisk")})}var b={restrict:"A",replace:!0,link:a,scope:{fsRequired:"=?"}};return b}]),a.directive("fsSearchItem",function(){var a={restrict:"E",replace:!0,require:!0,templateUrl:"/templates/searchItem.html",scope:{name:"@name",resourceid:"@resourceid",summary:"@summary"}};return a}),a.directive("fsTrueCheck",[function(){function a(a,b,c){a.$watch("fsTrueCheck",function(a){a===!0&&c.$set("class","fa fa-check")})}var b={restrict:"A",replace:!0,link:a,scope:{fsTrueCheck:"=?"}};return b}])}(),function(){"use strict";function a(a,b){function c(c,d){var e=b.removeNullProperties(d),f=g.defer();return a.post(c,e).success(function(a,b,c,d){var e={};e.data=a,e.headers=c(),e.status=b,e.config=d,f.resolve(e)}).error(function(a,b){var c={status:b,outcome:a};f.reject(c)}),f.promise}function d(b){var c=g.defer();return a["delete"](b).success(function(a,b,d,e){var f={};f.data=a,f.headers=d(),f.status=b,f.config=e,c.resolve(f)}).error(function(a,b,d){if(410===b){var e={};e.data=a,e.status=b,e.headers=d,c.resolve(e)}else{var f={status:b,outcome:a};c.reject(f)}}),c.promise}function e(b){var c=g.defer();return a.get(b).success(function(a,b,d,e){var f={};f.data=a,f.headers=d(),f.status=b,f.config=e,c.resolve(f)}).error(function(a,b){var d={status:b,outcome:a};c.reject(d)}),c.promise}function f(c,d){var e=b.removeNullProperties(d),f=g.defer();return a.put(c,e).success(function(a,b,c,d){var e={};e.data=a,e.headers=c(),e.status=b,e.config=d,f.resolve(e)}).error(function(a,b){var c={status:b,outcome:a};f.reject(c)}),f.promise}var g=b.$q,h={deleteResource:d,getResource:e,addResource:c,updateResource:f};return h}var b="fhirClient";angular.module("FHIRCloud").factory(b,["$http","common",a])}(),function(){"use strict";function a(a,b,c){function d(){var b=c.readFromCache("activeServer");return angular.isUndefined(b)&&(b=a.get("activeServer")),angular.isUndefined(b)&&f().then(function(a){b=a[0],e(b)}),h.when(b)}function e(b){c.addToCache("activeServer",b),a.put("activeServer",b)}function f(){var a=h.defer();try{var b=[{id:0,name:"SMART",baseUrl:"https://fhir-open-api-dstu2.smarthealthit.org",secure:!0},{id:1,name:"HAPI",baseUrl:"https://fhirtest.uhn.ca/baseDstu2",secure:!0},{id:2,name:"RelayHealth",baseUrl:"https://api.stage.data.relayhealth.com/rhc/fhirservice",secure:!0},{id:3,name:"Health Directions",baseUrl:"http://fhir-dev.healthintersections.com.au/open",secure:!1},{id:4,name:"Argonaut Reference",baseUrl:"http://argonaut.healthintersections.com.au/open",secure:!1}],d=c.readFromCache("servers");angular.isUndefined(d)&&(d=b,c.addToCache("servers",d)),a.resolve(d)}catch(e){a.reject(e)}return a.promise}function g(a){var b=h.defer(),c=null;return f().then(function(d){for(var e=0,f=d.length;f>e;e++)if(d[e].id===a){c=d[e];break}return b.resolve(c)}),b.promise}var h=b.$q,i={getAllServers:f,getServerById:g,getActiveServer:d,setActiveServer:e};return i}var b="fhirServers";angular.module("FHIRCloud").factory(b,["$cookieStore","common","dataCache",a])}(),function(){"use strict";function a(a){function b(a,b){var d=g.defer(),e=c(d,b);return e.readAsDataURL(a),d.promise}function c(a,b){var c=new FileReader;return c.onload=e(c,a,b),c.onerror=d(c,a,b),c.onprogress=f(c,b),c}function d(a,b,c){return function(){c.$apply(function(){b.reject(a.result)})}}function e(a,b,c){return function(){c.$apply(function(){b.resolve(a.result)})}}function f(a,b){return function(a){b.$broadcast("fileProgress",{total:a.total,loaded:a.loaded})}}var g=a.$q,h={readAsDataUrl:b};return h}var b="fileReader";angular.module("FHIRCloud").factory(b,["common",a])}(),function(){"use strict";var a=angular.module("FHIRCloud");a.filter("lastUrlPart",function(){return function(a){var b=a.split("/");return angular.isArray(b)?b[b.length-1]:a}}),a.filter("displayAge",function(){return function(a){if(a){var b,c=a;angular.isDate(c)===!1&&(c=new Date(a));var d=Date.now()-c.getTime(),e=new Date(d),f=Math.floor(e.getUTCFullYear()-1970);if(b="age "+f,2>f){var g=Math.floor(d/2628e6);if(b="age "+g+" months",6>g){var h=Math.floor(d/6048e5);b="age "+h+" weeks"}}return b}return"unknown"}}),a.filter("codeableConcept",function(){return function(a){if(angular.isUndefined(a))return"";if(angular.isArray(a.coding)){if(a.text)return a.text;var b=_.first(a.coding,"display");return b&&angular.isArray(b)&&b.length>0?b[0].display:b&&b.display?b.display:"No display text for code: ("+b.system+":"+b.code+")"}return"Bad input"}}),a.filter("smartUrl",function(a){return function(b,c,d){var e=b+"?fhirServiceUrl="+c+"&patient="+d;return a.trustAsResourceUrl(e)}}),a.filter("dateString",function(){return function(a){return angular.isDefined(a)?moment(a).format("YYYY-MM-DD"):void 0}}),a.filter("fullName",function(){function a(a){return a&&angular.isArray(a)?a.join(" "):""}return function(b){return b&&angular.isArray(b)?a(b[0].given)+" "+a(b[0].family):b&&b.given?a(b.given)+" "+a(b.family):"Name Unknown"}}),a.filter("idFromURL",function(){return function(a){if(a.length>5){var b=a.split("/");return b[b.length-1]}}}),a.filter("periodText",function(){return function(a){return a?(a.start?moment(a.start).format("MMM`YY")+"-":"?-")+(a.end?moment(a.end).format("MMM`YY"):"current"):""}}),a.filter("questionnaireAnswerType",function(){function a(a){return a.replace(/^./,function(a){return a.toUpperCase()})}return function(b){return _.contains(["choice","open-choice"],b)?"valueCoding":"reference"===b?"valueResource":"value"+a(b)}}),a.filter("titleCase",function(){return function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}}),a.filter("questionnaireInputType",function(){return function(a){var b="text";return a&&(_.contains(["date","dateTime"],a)?b="date":_.contains(["time"],a)?b="time":_.contains(["instant"],a)?b="datetime-local":_.contains(["integer","decimal"],a)?b="number":_.contains(["boolean"],a)?b="checkbox":_.contains(["Attachment"],a)&&(b="file")),b}}),a.filter("messageTotalResults",function(){return function(a){switch(a){case 0:return"No results";case 1:return"1 result";default:return a+" results"}}}),a.filter("questionnaireFlyover",function(){return function(a){var b="";if(angular.isArray(a)){var c=_.find(a,function(a){return"http://hl7.org/fhir/Profile/questionnaire-extensions#flyover"===a.url});null!==c&&c.valueString&&(b=c.valueString)}return b}}),a.filter("questionnaireLabel",function(){function a(a){return a.replace(/^./,function(a){return a.toUpperCase()})}function b(a){return a.replace(/([a-z])([A-Z])/g,"$1 $2")}return function(c){var d="Unspecified";if(c){d=b(c);var e=d.lastIndexOf(".");if(e>0){d=d.substring(e+1);var f=d.indexOf("[#");f>0&&(d=d.substring(f+2),d=d.replace("]","")),d=d.replace("[x]",""),d=a(d)}}return d}}),a.filter("renderObject",function(){return function(a){var b="",c=_.keys(a);return _.forEach(c,function(c){angular.isDefined(a[c])&&"$$hashKey"!==c&&(b=angular.isDefined(b)?b+", "+c+": "+a[c]:c+": "+a[c])}),b}}),a.filter("singleLineAddress",function(){return function(a){return a?(a.line?a.line.join(" ")+", ":"")+(a.city?a.city+", ":"")+(a.state?a.state:"")+(a.postalCode?" "+a.postalCode:"")+(a.country?", "+a.country:""):""}}),a.filter("truncate",function(){return function(a,b){if("undefined"==typeof a||null===a||""===a)return"";(isNaN(b)||0>=b)&&(b=20),a=a.replace(/\r?\n|\r/gm," ").replace(/<[^>]*>/gi," ").split(" ");for(var c="";a.length>0&&(c+=a.splice(0,b).join(" "),!(c.length>=b)););return c.length>b&&c.indexOf(" ")&&(c=c.substring(0,b)+" ..."),c}}),a.filter("unexpectedOutcome",function(){return function(a){var b="Unexpected response from server/n";return a.status&&(b="HTTP Status: "+b.status+"\n"),a.outcome&&a.outcome.issue&&_.forEach(b.outcome.issue,function(a){b=b+a.severity+": "+a.details+"\n"}),b}}),a.filter("abbreviateState",function(){return function(a){var b,c=angular.lowercase(a);switch(c){case"alabama":b="AL";break;case"alaska":b="AK";break;case"hawaii":b="HI";break;case"idaho":b="ID";break;case"illinois":b="IL";break;case"indiana":b="IN";break;case"iowa":b="IA";break;case"kansas":b="KS";break;case"kentucky":b="KY";break;case"louisiana":b="LA";break;case"maine":b="MA";break;case"maryland":b="MD";break;case"massachusetts":b="MA";break;case"michigan":b="MI";break;case"minnesota":b="MN";break;case"mississippi":b="MS";break;case"missouri":b="MO";break;case"montana ":b="MT";break;case"nebraska":b="NB";break;case"nevada":b="NV";break;case"new hampshire":b="NH";break;case"new jersey":b="NJ";break;case"new mexico":b="NM";break;case"new york":b="NY";break;case"north carolina":b="NC";break;case"north dakota":b="ND";break;case"ohio":b="OH";break;case"oklahoma":b="OK";break;case"oregon":b="OR";break;case"pennsylvania":b="PA";break;case"rhode island":b="RI";break;case"south carolina":b="SC";break;case"south dakota":b="SD";break;case"tennessee":b="TN";break;case"texas":b="TX";break;case"utah":b="UT";break;case"vermont":b="VT";break;case"virginia":b="VA";break;case"washington":b="WA";break;case"west virginia":b="WV";break;case"wisconsin":b="WI";break;case"wyoming":b="WY";break;case"georgia":b="GA";break;case"florida":b="FL";break;case"delaware":b="DE";break;case"connecticut":b="CT";break;case"colorado":b="CO";break;case"california":b="CA";break;case"arkansas":b="AR";break;case"arizona":b="AZ";break;case"district of columbia":b="DC";break;default:b=c}return b}})}(),function(){"use strict";function a(){function a(){return{system:"http://hl7.org/fhir/v3/Race",concept:[{code:"1002-5",display:"American Indian or Alaska Native"},{code:"2028-9",display:"Asian"},{code:"2054-5",display:"Black or African American"},{code:"2076-8",display:"Native Hawaiian or Other Pacific Islander"},{code:"2106-3",display:"White"}]}}function b(){return{system:"http://hl7.org/fhir/v3/Ethnicity",caseSensitive:!0,concept:[{code:"2135-2","abstract":!1,display:"Hispanic or Latino",definition:"Hispanic or Latino",concept:[{code:"2137-8","abstract":!1,display:"Spaniard",definition:"Spaniard",concept:[{code:"2138-6","abstract":!1,display:"Andalusian",definition:"Andalusian"},{code:"2139-4","abstract":!1,display:"Asturian",definition:"Asturian"},{code:"2140-2","abstract":!1,display:"Castillian",definition:"Castillian"},{code:"2141-0","abstract":!1,display:"Catalonian",definition:"Catalonian"},{code:"2142-8","abstract":!1,display:"Belearic Islander",definition:"Belearic Islander"},{code:"2143-6","abstract":!1,display:"Gallego",definition:"Gallego"},{code:"2144-4","abstract":!1,display:"Valencian",definition:"Valencian"},{code:"2145-1","abstract":!1,display:"Canarian",definition:"Canarian"},{code:"2146-9","abstract":!1,display:"Spanish Basque",definition:"Spanish Basque"}]},{code:"2148-5","abstract":!1,display:"Mexican",definition:"Mexican",concept:[{code:"2149-3","abstract":!1,display:"Mexican American",definition:"Mexican American"},{code:"2150-1","abstract":!1,display:"Mexicano",definition:"Mexicano"},{code:"2151-9","abstract":!1,display:"Chicano",definition:"Chicano"},{code:"2152-7","abstract":!1,display:"La Raza",definition:"La Raza"},{code:"2153-5","abstract":!1,display:"Mexican American Indian",definition:"Mexican American Indian"}]},{code:"2155-0","abstract":!1,display:"Central American",definition:"Central American",concept:[{code:"2156-8","abstract":!1,display:"Costa Rican",definition:"Costa Rican"},{code:"2157-6","abstract":!1,display:"Guatemalan",definition:"Guatemalan"},{code:"2158-4","abstract":!1,display:"Honduran",definition:"Honduran"},{code:"2159-2","abstract":!1,display:"Nicaraguan",definition:"Nicaraguan"},{code:"2160-0","abstract":!1,display:"Panamanian",definition:"Panamanian"},{code:"2161-8","abstract":!1,display:"Salvadoran",definition:"Salvadoran"},{code:"2162-6","abstract":!1,display:"Central American Indian",definition:"Central American Indian"},{code:"2163-4","abstract":!1,display:"Canal Zone",definition:"Canal Zone"}]},{code:"2165-9","abstract":!1,display:"South American",definition:"South American",concept:[{code:"2166-7","abstract":!1,display:"Argentinean",definition:"Argentinean"},{code:"2167-5","abstract":!1,display:"Bolivian",definition:"Bolivian"},{code:"2168-3","abstract":!1,display:"Chilean",definition:"Chilean"},{code:"2169-1","abstract":!1,display:"Colombian",definition:"Colombian"},{code:"2170-9","abstract":!1,display:"Ecuadorian",definition:"Ecuadorian"},{code:"2171-7","abstract":!1,display:"Paraguayan",definition:"Paraguayan"},{code:"2172-5","abstract":!1,display:"Peruvian",definition:"Peruvian"},{code:"2173-3","abstract":!1,display:"Uruguayan",definition:"Uruguayan"},{code:"2174-1","abstract":!1,display:"Venezuelan",definition:"Venezuelan"},{code:"2175-8","abstract":!1,display:"South American Indian",definition:"South American Indian"},{code:"2176-6","abstract":!1,display:"Criollo",definition:"Criollo"}]},{code:"2178-2","abstract":!1,display:"Latin American",definition:"Latin American"},{code:"2180-8","abstract":!1,display:"Puerto Rican",definition:"Puerto Rican"},{code:"2182-4","abstract":!1,display:"Cuban",definition:"Cuban"},{code:"2184-0","abstract":!1,display:"Dominican",definition:"Dominican"}]},{code:"2186-5","abstract":!1,display:"Not Hispanic or Latino",definition:'Note that this term remains in the table for completeness, even though within HL7, the notion of "not otherwise coded" term is deprecated.'}]}}function c(){return{system:"http://hl7.org/fhir/v3/ReligiousAffiliation",caseSensitive:!0,concept:[{code:"1001","abstract":!1,display:"Adventist",definition:"Adventist"},{code:"1002","abstract":!1,display:"African Religions",definition:"African Religions"},{code:"1003","abstract":!1,display:"Afro-Caribbean Religions",definition:"Afro-Caribbean Religions"},{code:"1004","abstract":!1,display:"Agnosticism",definition:"Agnosticism"},{code:"1005","abstract":!1,display:"Anglican",definition:"Anglican"},{code:"1006","abstract":!1,display:"Animism",definition:"Animism"},{code:"1007","abstract":!1,display:"Atheism",definition:"Atheism"},{code:"1008","abstract":!1,display:"Babi & Baha'I faiths",definition:"Babi & Baha'I faiths"},{code:"1009","abstract":!1,display:"Baptist",definition:"Baptist"},{code:"1010","abstract":!1,display:"Bon",definition:"Bon"},{code:"1011","abstract":!1,display:"Cao Dai",definition:"Cao Dai"},{code:"1012","abstract":!1,display:"Celticism",definition:"Celticism"},{code:"1013","abstract":!1,display:"Christian (non-Catholic, non-specific)",definition:"Christian (non-Catholic, non-specific)"},{code:"1014","abstract":!1,display:"Confucianism",definition:"Confucianism"},{code:"1015","abstract":!1,display:"Cyberculture Religions",definition:"Cyberculture Religions"},{code:"1016","abstract":!1,display:"Divination",definition:"Divination"},{code:"1017","abstract":!1,display:"Fourth Way",definition:"Fourth Way"},{code:"1018","abstract":!1,display:"Free Daism",definition:"Free Daism"},{code:"1019","abstract":!1,display:"Gnosis",definition:"Gnosis"},{code:"1020","abstract":!1,display:"Hinduism",definition:"Hinduism"},{code:"1021","abstract":!1,display:"Humanism",definition:"Humanism"},{code:"1022","abstract":!1,display:"Independent",definition:"Independent"},{code:"1023","abstract":!1,display:"Islam",definition:"Islam"},{code:"1024","abstract":!1,display:"Jainism",definition:"Jainism"},{code:"1025","abstract":!1,display:"Jehovah's Witnesses",definition:"Jehovah's Witnesses"},{code:"1026","abstract":!1,display:"Judaism",definition:"Judaism"},{code:"1027","abstract":!1,display:"Latter Day Saints",definition:"Latter Day Saints"},{code:"1028","abstract":!1,display:"Lutheran",definition:"Lutheran"},{code:"1029","abstract":!1,display:"Mahayana",definition:"Mahayana"},{code:"1030","abstract":!1,display:"Meditation",definition:"Meditation"},{code:"1031","abstract":!1,display:"Messianic Judaism",definition:"Messianic Judaism"},{code:"1032","abstract":!1,display:"Mitraism",definition:"Mitraism"},{code:"1033","abstract":!1,display:"New Age",definition:"New Age"},{code:"1034","abstract":!1,display:"non-Roman Catholic",definition:"non-Roman Catholic"},{code:"1035","abstract":!1,display:"Occult",definition:"Occult"},{code:"1036","abstract":!1,display:"Orthodox",definition:"Orthodox"},{code:"1037","abstract":!1,display:"Paganism",definition:"Paganism"},{code:"1038","abstract":!1,display:"Pentecostal",definition:"Pentecostal"},{code:"1039","abstract":!1,display:"Process, The",definition:"Process, The"},{code:"1040","abstract":!1,display:"Reformed/Presbyterian",definition:"Reformed/Presbyterian"},{code:"1041","abstract":!1,display:"Roman Catholic Church",definition:"Roman Catholic Church"},{code:"1042","abstract":!1,display:"Satanism",definition:"Satanism"},{code:"1043","abstract":!1,display:"Scientology",definition:"Scientology"},{code:"1044","abstract":!1,display:"Shamanism",definition:"Shamanism"},{code:"1045","abstract":!1,display:"Shiite (Islam)",definition:"Shiite (Islam)"},{code:"1046","abstract":!1,display:"Shinto",definition:"Shinto"},{code:"1047","abstract":!1,display:"Sikism",definition:"Sikism"},{code:"1048","abstract":!1,display:"Spiritualism",definition:"Spiritualism"},{code:"1049","abstract":!1,display:"Sunni (Islam)",definition:"Sunni (Islam)"},{code:"1050","abstract":!1,display:"Taoism",definition:"Taoism"},{code:"1051","abstract":!1,display:"Theravada",definition:"Theravada"},{code:"1052","abstract":!1,display:"Unitarian-Universalism",definition:"Unitarian-Universalism"},{code:"1053","abstract":!1,display:"Universal Life Church",definition:"Universal Life Church"},{code:"1054","abstract":!1,display:"Vajrayana (Tibetan)",definition:"Vajrayana (Tibetan)"},{code:"1055","abstract":!1,display:"Veda",definition:"Veda"},{code:"1056","abstract":!1,display:"Voodoo",definition:"Voodoo"},{code:"1057","abstract":!1,display:"Wicca",definition:"Wicca"},{code:"1058","abstract":!1,display:"Yaohushua",definition:"Yaohushua"},{code:"1059","abstract":!1,display:"Zen Buddhism",definition:"Zen Buddhism"},{code:"1060","abstract":!1,display:"Zoroastrianism",definition:"Zoroastrianism"},{code:"1061","abstract":!1,display:"Assembly of God",definition:"Assembly of God"},{code:"1062","abstract":!1,display:"Brethren",definition:"Brethren"},{code:"1063","abstract":!1,display:"Christian Scientist",definition:"Christian Scientist"},{code:"1064","abstract":!1,display:"Church of Christ",definition:"Church of Christ"},{code:"1065","abstract":!1,display:"Church of God",definition:"Church of God"},{code:"1066","abstract":!1,display:"Congregational",definition:"Congregational"},{code:"1067","abstract":!1,display:"Disciples of Christ",definition:"Disciples of Christ"},{code:"1068","abstract":!1,display:"Eastern Orthodox",definition:"Eastern Orthodox"},{code:"1069","abstract":!1,display:"Episcopalian",definition:"Episcopalian"},{code:"1070","abstract":!1,display:"Evangelical Covenant",definition:"Evangelical Covenant"},{code:"1071","abstract":!1,display:"Friends",definition:"Friends"},{code:"1072","abstract":!1,display:"Full Gospel",definition:"Full Gospel"},{code:"1073","abstract":!1,display:"Methodist",definition:"Methodist"},{code:"1074","abstract":!1,display:"Native American",definition:"Native American"},{code:"1075","abstract":!1,display:"Nazarene",definition:"Nazarene"},{code:"1076","abstract":!1,display:"Presbyterian",definition:"Presbyterian"},{code:"1077","abstract":!1,display:"Protestant",definition:"Protestant"},{code:"1078","abstract":!1,display:"Protestant, No Denomination",definition:"Protestant, No Denomination"},{code:"1079","abstract":!1,display:"Reformed",definition:"Reformed"},{code:"1080","abstract":!1,display:"Salvation Army",definition:"Salvation Army"},{code:"1081","abstract":!1,display:"Unitarian Universalist",definition:"Unitarian Universalist"},{code:"1082","abstract":!1,display:"United Church of Christ",definition:"United Church of Christ"}]}}function d(){return[{code:"unknown",display:"Unknown",system:"http://hl7.org/fhir/administrative-gender"},{code:"female",display:"Female",system:"http://hl7.org/fhir/administrative-gender"},{code:"male",display:"Male",system:"http://hl7.org/fhir/administrative-gender"},{code:"other",display:"Other",system:"http://hl7.org/fhir/administrative-gender"}]}function e(){return[{code:"BILL",display:"Billing",system:"http://hl7.org/fhir/contactentity-type"},{code:"ADMIN",display:"Administrative",system:"http://hl7.org/fhir/contactentity-type"},{code:"HR",display:"Human Resource",system:"http://hl7.org/fhir/contactentity-type"},{code:"PAYOR",display:"Payor",system:"http://hl7.org/fhir/contactentity-type"},{code:"PATINF",display:"Patient",system:"http://hl7.org/fhir/contactentity-type"},{code:"PRESS",display:"Press",system:"http://hl7.org/fhir/contactentity-type"}]}function f(){return[{code:"ab",display:"Abkhaz",system:"urn:std:iso:639-1"},{code:"aa",display:"Afar",
system:"urn:std:iso:639-1"},{code:"af",display:"Afrikaans",system:"urn:std:iso:639-1"},{code:"ak",display:"Akan",system:"urn:std:iso:639-1"},{code:"sq",display:"Albanian",system:"urn:std:iso:639-1"},{code:"am",display:"Amharic",system:"urn:std:iso:639-1"},{code:"ar",display:"Arabic",system:"urn:std:iso:639-1"},{code:"an",display:"Aragonese",system:"urn:std:iso:639-1"},{code:"hy",display:"Armenian",system:"urn:std:iso:639-1"},{code:"as",display:"Assamese",system:"urn:std:iso:639-1"},{code:"av",display:"Avaric",system:"urn:std:iso:639-1"},{code:"ae",display:"Avestan",system:"urn:std:iso:639-1"},{code:"ay",display:"Aymara",system:"urn:std:iso:639-1"},{code:"az",display:"Azerbaijani",system:"urn:std:iso:639-1"},{code:"bm",display:"Bambara",system:"urn:std:iso:639-1"},{code:"ba",display:"Bashkir",system:"urn:std:iso:639-1"},{code:"eu",display:"Basque",system:"urn:std:iso:639-1"},{code:"be",display:"Belarusian",system:"urn:std:iso:639-1"},{code:"bn",display:"Bengali",system:"urn:std:iso:639-1"},{code:"bh",display:"Bihari",system:"urn:std:iso:639-1"},{code:"bi",display:"Bislama",system:"urn:std:iso:639-1"},{code:"bs",display:"Bosnian",system:"urn:std:iso:639-1"},{code:"br",display:"Breton",system:"urn:std:iso:639-1"},{code:"bg",display:"Bulgarian",system:"urn:std:iso:639-1"},{code:"my",display:"Burmese",system:"urn:std:iso:639-1"},{code:"ca",display:"Catalan; Valencian",system:"urn:std:iso:639-1"},{code:"ch",display:"Chamorro",system:"urn:std:iso:639-1"},{code:"ce",display:"Chechen",system:"urn:std:iso:639-1"},{code:"ny",display:"Chichewa; Chewa; Nyanja",system:"urn:std:iso:639-1"},{code:"zh",display:"Chinese",system:"urn:std:iso:639-1"},{code:"cv",display:"Chuvash",system:"urn:std:iso:639-1"},{code:"kw",display:"Cornish",system:"urn:std:iso:639-1"},{code:"co",display:"Corsican",system:"urn:std:iso:639-1"},{code:"cr",display:"Cree",system:"urn:std:iso:639-1"},{code:"hr",display:"Croatian",system:"urn:std:iso:639-1"},{code:"cs",display:"Czech",system:"urn:std:iso:639-1"},{code:"da",display:"Danish",system:"urn:std:iso:639-1"},{code:"dv",display:"Divehi; Dhivehi; Maldivian;",system:"urn:std:iso:639-1"},{code:"nl",display:"Dutch",system:"urn:std:iso:639-1"},{code:"en",display:"English",system:"urn:std:iso:639-1"},{code:"eo",display:"Esperanto",system:"urn:std:iso:639-1"},{code:"et",display:"Estonian",system:"urn:std:iso:639-1"},{code:"ee",display:"Ewe",system:"urn:std:iso:639-1"},{code:"fo",display:"Faroese",system:"urn:std:iso:639-1"},{code:"fj",display:"Fijian",system:"urn:std:iso:639-1"},{code:"fi",display:"Finnish",system:"urn:std:iso:639-1"},{code:"fr",display:"French",system:"urn:std:iso:639-1"},{code:"ff",display:"Fula; Fulah; Pulaar; Pular",system:"urn:std:iso:639-1"},{code:"gl",display:"Galician",system:"urn:std:iso:639-1"},{code:"ka",display:"Georgian",system:"urn:std:iso:639-1"},{code:"de",display:"German",system:"urn:std:iso:639-1"},{code:"el",display:"Greek, Modern",system:"urn:std:iso:639-1"},{code:"gn",display:"Guaraní",system:"urn:std:iso:639-1"},{code:"gu",display:"Gujarati",system:"urn:std:iso:639-1"},{code:"ht",display:"Haitian; Haitian Creole",system:"urn:std:iso:639-1"},{code:"ha",display:"Hausa",system:"urn:std:iso:639-1"},{code:"he",display:"Hebrew (modern)",system:"urn:std:iso:639-1"},{code:"hz",display:"Herero",system:"urn:std:iso:639-1"},{code:"hi",display:"Hindi",system:"urn:std:iso:639-1"},{code:"ho",display:"Hiri Motu",system:"urn:std:iso:639-1"},{code:"hu",display:"Hungarian",system:"urn:std:iso:639-1"},{code:"ia",display:"Interlingua",system:"urn:std:iso:639-1"},{code:"id",display:"Indonesian",system:"urn:std:iso:639-1"},{code:"ie",display:"Interlingue",system:"urn:std:iso:639-1"},{code:"ga",display:"Irish",system:"urn:std:iso:639-1"},{code:"ig",display:"Igbo",system:"urn:std:iso:639-1"},{code:"ik",display:"Inupiaq",system:"urn:std:iso:639-1"},{code:"io",display:"Ido",system:"urn:std:iso:639-1"},{code:"is",display:"Icelandic",system:"urn:std:iso:639-1"},{code:"it",display:"Italian",system:"urn:std:iso:639-1"},{code:"iu",display:"Inuktitut",system:"urn:std:iso:639-1"},{code:"ja",display:"Japanese",system:"urn:std:iso:639-1"},{code:"jv",display:"Javanese",system:"urn:std:iso:639-1"},{code:"kl",display:"Kalaallisut, Greenlandic",system:"urn:std:iso:639-1"},{code:"kn",display:"Kannada",system:"urn:std:iso:639-1"},{code:"kr",display:"Kanuri",system:"urn:std:iso:639-1"},{code:"ks",display:"Kashmiri",system:"urn:std:iso:639-1"},{code:"kk",display:"Kazakh",system:"urn:std:iso:639-1"},{code:"km",display:"Khmer",system:"urn:std:iso:639-1"},{code:"ki",display:"Kikuyu, Gikuyu",system:"urn:std:iso:639-1"},{code:"rw",display:"Kinyarwanda",system:"urn:std:iso:639-1"},{code:"ky",display:"Kirghiz, Kyrgyz",system:"urn:std:iso:639-1"},{code:"kv",display:"Komi",system:"urn:std:iso:639-1"},{code:"kg",display:"Kongo",system:"urn:std:iso:639-1"},{code:"ko",display:"Korean",system:"urn:std:iso:639-1"},{code:"ku",display:"Kurdish",system:"urn:std:iso:639-1"},{code:"kj",display:"Kwanyama, Kuanyama",system:"urn:std:iso:639-1"},{code:"la",display:"Latin",system:"urn:std:iso:639-1"},{code:"lb",display:"Luxembourgish, Letzeburgesch",system:"urn:std:iso:639-1"},{code:"lg",display:"Luganda",system:"urn:std:iso:639-1"},{code:"li",display:"Limburgish, Limburgan, Limburger",system:"urn:std:iso:639-1"},{code:"ln",display:"Lingala",system:"urn:std:iso:639-1"},{code:"lo",display:"Lao",system:"urn:std:iso:639-1"},{code:"lt",display:"Lithuanian",system:"urn:std:iso:639-1"},{code:"lu",display:"Luba-Katanga",system:"urn:std:iso:639-1"},{code:"lv",display:"Latvian",system:"urn:std:iso:639-1"},{code:"gv",display:"Manx",system:"urn:std:iso:639-1"},{code:"mk",display:"Macedonian",system:"urn:std:iso:639-1"},{code:"mg",display:"Malagasy",system:"urn:std:iso:639-1"},{code:"ms",display:"Malay",system:"urn:std:iso:639-1"},{code:"ml",display:"Malayalam",system:"urn:std:iso:639-1"},{code:"mt",display:"Maltese",system:"urn:std:iso:639-1"},{code:"mi",display:"Maori",system:"urn:std:iso:639-1"},{code:"mr",display:"Marathi (Marāṭhī)",system:"urn:std:iso:639-1"},{code:"mh",display:"Marshallese",system:"urn:std:iso:639-1"},{code:"mn",display:"Mongolian",system:"urn:std:iso:639-1"},{code:"na",display:"Nauru",system:"urn:std:iso:639-1"},{code:"nv",display:"Navajo, Navaho",system:"urn:std:iso:639-1"},{code:"nb",display:"Norwegian Bokmål",system:"urn:std:iso:639-1"},{code:"nd",display:"North Ndebele",system:"urn:std:iso:639-1"},{code:"ne",display:"Nepali",system:"urn:std:iso:639-1"},{code:"ng",display:"Ndonga",system:"urn:std:iso:639-1"},{code:"nn",display:"Norwegian Nynorsk",system:"urn:std:iso:639-1"},{code:"no",display:"Norwegian",system:"urn:std:iso:639-1"},{code:"ii",display:"Nuosu",system:"urn:std:iso:639-1"},{code:"nr",display:"South Ndebele",system:"urn:std:iso:639-1"},{code:"oc",display:"Occitan",system:"urn:std:iso:639-1"},{code:"oj",display:"Ojibwe, Ojibwa",system:"urn:std:iso:639-1"},{code:"cu",display:"Old Church Slavonic",system:"urn:std:iso:639-1"},{code:"om",display:"Oromo",system:"urn:std:iso:639-1"},{code:"or",display:"Oriya",system:"urn:std:iso:639-1"},{code:"os",display:"Ossetian, Ossetic",system:"urn:std:iso:639-1"},{code:"pa",display:"Panjabi, Punjabi",system:"urn:std:iso:639-1"},{code:"pi",display:"Pali",system:"urn:std:iso:639-1"},{code:"fa",display:"Persian",system:"urn:std:iso:639-1"},{code:"pl",display:"Polish",system:"urn:std:iso:639-1"},{code:"ps",display:"Pashto, Pushto",system:"urn:std:iso:639-1"},{code:"pt",display:"Portuguese",system:"urn:std:iso:639-1"},{code:"qu",display:"Quechua",system:"urn:std:iso:639-1"},{code:"rm",display:"Romansh",system:"urn:std:iso:639-1"},{code:"rn",display:"Kirundi",system:"urn:std:iso:639-1"},{code:"ro",display:"Romanian, Moldavian, Moldovan",system:"urn:std:iso:639-1"},{code:"ru",display:"Russian",system:"urn:std:iso:639-1"},{code:"sa",display:"Sanskrit (Samskrta)",system:"urn:std:iso:639-1"},{code:"sc",display:"Sardinian",system:"urn:std:iso:639-1"},{code:"sd",display:"Sindhi",system:"urn:std:iso:639-1"},{code:"se",display:"Northern Sami",system:"urn:std:iso:639-1"},{code:"sm",display:"Samoan",system:"urn:std:iso:639-1"},{code:"sg",display:"Sango",system:"urn:std:iso:639-1"},{code:"sr",display:"Serbian",system:"urn:std:iso:639-1"},{code:"gd",display:"Scottish Gaelic; Gaelic",system:"urn:std:iso:639-1"},{code:"sn",display:"Shona",system:"urn:std:iso:639-1"},{code:"si",display:"Sinhala, Sinhalese",system:"urn:std:iso:639-1"},{code:"sk",display:"Slovak",system:"urn:std:iso:639-1"},{code:"sl",display:"Slovene",system:"urn:std:iso:639-1"},{code:"so",display:"Somali",system:"urn:std:iso:639-1"},{code:"st",display:"Southern Sotho",system:"urn:std:iso:639-1"},{code:"es",display:"Spanish; Castilian",system:"urn:std:iso:639-1"},{code:"su",display:"Sundanese",system:"urn:std:iso:639-1"},{code:"sw",display:"Swahili",system:"urn:std:iso:639-1"},{code:"ss",display:"Swati",system:"urn:std:iso:639-1"},{code:"sv",display:"Swedish",system:"urn:std:iso:639-1"},{code:"ta",display:"Tamil",system:"urn:std:iso:639-1"},{code:"te",display:"Telugu",system:"urn:std:iso:639-1"},{code:"tg",display:"Tajik",system:"urn:std:iso:639-1"},{code:"th",display:"Thai",system:"urn:std:iso:639-1"},{code:"ti",display:"Tigrinya",system:"urn:std:iso:639-1"},{code:"bo",display:"Tibetan Standard, Tibetan, Central",system:"urn:std:iso:639-1"},{code:"tk",display:"Turkmen",system:"urn:std:iso:639-1"},{code:"tl",display:"Tagalog",system:"urn:std:iso:639-1"},{code:"tn",display:"Tswana",system:"urn:std:iso:639-1"},{code:"to",display:"Tonga (Tonga Islands)",system:"urn:std:iso:639-1"},{code:"tr",display:"Turkish",system:"urn:std:iso:639-1"},{code:"ts",display:"Tsonga",system:"urn:std:iso:639-1"},{code:"tt",display:"Tatar",system:"urn:std:iso:639-1"},{code:"tw",display:"Twi",system:"urn:std:iso:639-1"},{code:"ty",display:"Tahitian",system:"urn:std:iso:639-1"},{code:"ug",display:"Uighur, Uyghur",system:"urn:std:iso:639-1"},{code:"uk",display:"Ukrainian",system:"urn:std:iso:639-1"},{code:"ur",display:"Urdu",system:"urn:std:iso:639-1"},{code:"uz",display:"Uzbek",system:"urn:std:iso:639-1"},{code:"ve",display:"Venda",system:"urn:std:iso:639-1"},{code:"vi",display:"Vietnamese",system:"urn:std:iso:639-1"},{code:"vo",display:"Volapuk",system:"urn:std:iso:639-1"},{code:"wa",display:"Walloon",system:"urn:std:iso:639-1"},{code:"cy",display:"Welsh",system:"urn:std:iso:639-1"},{code:"wo",display:"Wolof",system:"urn:std:iso:639-1"},{code:"fy",display:"Western Frisian",system:"urn:std:iso:639-1"},{code:"xh",display:"Xhosa",system:"urn:std:iso:639-1"},{code:"yi",display:"Yiddish",system:"urn:std:iso:639-1"},{code:"yo",display:"Yoruba",system:"urn:std:iso:639-1"},{code:"za",display:"Zhuang, Chuang",system:"urn:std:iso:639-1"}]}function g(){return[{code:"instance",display:"A specific location instance",system:"http://hl7.org/fhir/vs/location-mode"},{code:"kind",display:"A class of locations",system:"http://hl7.org/fhir/vs/location-mode"}]}function h(){return[{code:"bu",display:"Building",system:"http://hl7.org/fhir/location-physical-type"},{code:"wi",display:"Wing",system:"http://hl7.org/fhir/location-physical-type"},{code:"co",display:"Corridor",system:"http://hl7.org/fhir/location-physical-type"},{code:"ro",display:"Room",system:"http://hl7.org/fhir/location-physical-type"},{code:"ve",display:"Vehicle",system:"http://hl7.org/fhir/location-physical-type"},{code:"ho",display:"House",system:"http://hl7.org/fhir/location-physical-type"},{code:"ca",display:"Cabinet",system:"http://hl7.org/fhir/location-physical-type"},{code:"rd",display:"Road",system:"http://hl7.org/fhir/location-physical-type"}]}function i(){return[{code:"active",display:"Active",system:"http://hl7.org/fhir/vs/location-status"},{code:"suspended",display:"Suspended",system:"http://hl7.org/fhir/vs/location-status"},{code:"inactive",display:"Inactive",system:"http://hl7.org/fhir/vs/location-status"}]}function j(){return[{code:"UNK",display:"Unknown",system:"http://hl7.org/fhir/v3/NullFlavor"},{code:"A",display:"Annulled",system:"http://hl7.org/fhir/v3/MaritalStatus"},{code:"D",display:"Divorced",system:"http://hl7.org/fhir/v3/MaritalStatus"},{code:"I",display:"Interlocutory",system:"http://hl7.org/fhir/v3/MaritalStatus"},{code:"L",display:"Legally Seperated",system:"http://hl7.org/fhir/v3/MaritalStatus"},{code:"M",display:"Married",system:"http://hl7.org/fhir/v3/MaritalStatus"},{code:"P",display:"Polygamous",system:"http://hl7.org/fhir/v3/MaritalStatus"},{code:"S",display:"Never Married",system:"http://hl7.org/fhir/v3/MaritalStatus"},{code:"T",display:"Domestic Partner",system:"http://hl7.org/fhir/v3/MaritalStatus"},{code:"U",display:"Unmarried",system:"http://hl7.org/fhir/v3/MaritalStatus"},{code:"W",display:"Widowed",system:"http://hl7.org/fhir/v3/MaritalStatus"}]}function k(){return[{code:"prov",display:"Healthcare Provider",system:"http://hl7.org/fhir/organization-type"},{code:"dept",display:"Hospital Department",system:"http://hl7.org/fhir/organization-type"},{code:"icu",display:"Intensive Care Unit",system:"http://hl7.org/fhir/organization-type"},{code:"team",display:"Organization Team",system:"http://hl7.org/fhir/organization-type"},{code:"fed",display:"Federal Government",system:"http://hl7.org/fhir/organization-type"},{code:"ins",display:"Insurance Company",system:"http://hl7.org/fhir/organization-type"},{code:"edu",display:"Educational Institute",system:"http://hl7.org/fhir/organization-type"},{code:"reli",display:"Religious Institution",system:"http://hl7.org/fhir/organization-type"},{code:"pharm",display:"Pharmacy",system:"http://hl7.org/fhir/organization-type"}]}function l(){return[{code:"in progress",display:"in progress",definition:"This QuestionnaireAnswers has been partially filled out with answers, but changes or additions are still expected to be made to it."},{code:"completed",display:"completed",definition:"This QuestionnaireAnswers has been filled out with answers, and the current content is regarded as definitive."},{code:"amended",display:"amended",definition:"This QuestionnaireAnswers has been filled out with answers, then marked as complete, yet changes or additions have been made to it afterwards."}]}function m(){return[{code:"449868002",display:"Smokes tobacco daily",system:"http://snomed.info/sct"},{code:"428041000124106",display:"Occasional tobacco smoker",system:"http://snomed.info/sct"},{code:"8517006",display:"Ex-smoker",system:"http://snomed.info/sct"},{code:"266919005",display:"Never smoked tobacco",system:"http://snomed.info/sct"},{code:"77176002",display:"Smoker, current status unknown",system:"http://snomed.info/sct"},{code:"266927001",display:"Unknown if ever smoked",system:"http://snomed.info/sct"},{code:"428071000124103",display:"Heavy tobacco smoker",system:"http://snomed.info/sct"},{code:"428061000124105",display:"Light tobacco smoker",system:"http://snomed.info/sct"}]}var n={administrativeGender:d,contactEntityType:e,iso6391Languages:f,locationMode:g,locationPhysicalType:h,locationStatus:i,maritalStatus:j,organizationType:k,questionnaireAnswerStatus:l,religion:c,smokingStatus:m,ethnicity:b,race:a};return n}var b="localValueSets";angular.module("FHIRCloud").factory(b,[a])}(),function(){"use strict";function a(a,b,c){function d(a,b){switch(b=b||"log",b.toLowerCase()){case"success":b="logSuccess";break;case"error":b="logError";break;case"warn":b="logWarning";break;case"info":b="log"}var c=j[b]||j.log;return function(b,d,e){c(b,d,a,void 0===e?!0:e)}}function e(a,b,c,d){i(a,b,c,d,"info")}function f(a,b,c,d){i(a,b,c,d,"warning")}function g(a,b,c,d){i(a,b,c,d,"success")}function h(a,b,c,d){i(a,b,c,d,"error")}function i(b,d,e,f,g){var h="error"===g?a.error:a.log;e=e?"["+e+"] ":"",h(e,b),f&&c.show(c.simple().content(b).position("right bottom").hideDelay(h===a.error?4e3:2e3))}var j={getLogFn:d,log:e,logError:h,logSuccess:g,logWarning:f};return j}angular.module("common").factory("logger",["$log","$window","$mdToast",a])}(),function(){"use strict";function a(a,c,d,e,f,g){function h(){e.activateController([j(),i()],b).then(function(){},function(a){v("Error "+a)})}function i(){g.getActiveServer().then(function(a){t.activeServer=a})}function j(){g.getAllServers().then(function(a){t.FHIRServers=a})}function k(){c("left").toggle()}function l(){c("right").toggle()}function m(b){a.show({controller:n,templateUrl:"templates/about.html",targetEvent:b}).then(function(){w("About dialog closed",null,A)},function(a){v("Error",a,A)})}function n(a,b){function c(){b.hide()}a.close=c,a.activeServer=t.activeServer}function o(b){a.show({templateUrl:"./templates/authenticate.html",targetEvent:b}).then(function(a){},function(){})}function p(a){c("right").close(),f.clearCache(),f.getConformanceMetadata(a.baseUrl).then(function(b){w("Retrieved conformance statement for "+a.name,null,A),t.activeServer=a,g.setActiveServer(a),angular.isUndefined(b.rest[0].security)?w("Security information missing - this is an OPEN server",null,A):angular.isArray(b.rest[0].security.extension)&&_.forEach(b.rest[0].security.extension,function(a){_.endsWith(a.url,"#authorize")&&(t.activeServer.authorizeUri=a.valueUri,w("Authorize URI found: "+t.activeServer.authorizeUri,null,A)),_.endsWith(a.url,"#token")&&(t.activeServer.tokenUri=a.valueUri,w("Token URI found: "+t.activeServer.tokenUri,null,A))}),e.changeServer(a)},function(b){v("Error returning conformance statement for "+a.name+". Server "+t.activeServer.name+" abides.",b)}),w("Requesting access to server "+a.name+" ...")}function q(a){return a===t.menu.selectedSection}function r(a){t.menu.selectedPage=a.name,d.path("/"+a.href)}function s(a){angular.isDefined(t.menu.selectedSection)&&t.menu.selectedSection.id===a.id?t.menu.selectedSection=void 0:t.menu.selectedSection=a,t.menu.selectedPage=void 0,t.menu.selectedSubPage=void 0}var t=this,u=e.logger.getLogFn,v=u(b,"error"),w=u(b,"info"),x=[{name:"Organization",href:"organization/view/current"},{name:"Patient",href:"patient/view/current"}],y=[{name:"Patient",href:"daf/patient"},{name:"Allergy Intolerance",href:"daf/allergyIntolerance"},{name:"Diagnostic Order",href:"daf/organization"},{name:"Diagnostic Report",href:"daf/diagnosticReport"},{name:"Encounter",href:"daf/encounter"},{name:"Family History",href:"daf/familyHistory"},{name:"Immunization",href:"daf/immunization"},{name:"Results",href:"daf/results"},{name:"Medication",href:"daf/medication"},{name:"Medication Statement",href:"daf/medicationStatement"},{name:"Medication Administration",href:"daf/medicationAdministration"},{name:"Condition",href:"daf/condition"},{name:"Procedure",href:"daf/procedure"},{name:"Smoking Status",href:"daf/smokingStatus"},{name:"Vital Signs",href:"daf/vitalSigns"},{name:"List",href:"daf/list"}],z=[{name:"Administration",id:1,pages:x},{name:"DAF Profiles",id:3,pages:y}],A=!1;t.authenticate=o,t.FHIRServers=[],t.isSectionSelected=q,t.menu={sections:z,selectedSection:void 0,selectedPage:void 0,selectedSubPage:void 0},t.pageSelected=r,t.selectServer=p,t.showAbout=m,t.toggleMenu=k,t.toggleSelectSection=s,t.toggleServers=l,t.activeServer=null,h()}var b="mainController";angular.module("FHIRCloud").controller(b,["$mdDialog","$mdSidenav","$location","common","conformanceService","fhirServers",a])}(),function(){"use strict";function a(a,b){function c(){e(!1)}function d(){e(!0)}function e(c){a.$broadcast(b.config.progressToggleEvent,{show:c})}var f={progressHide:c,progressShow:d};return f}angular.module("common").factory("progress",["common","commonConfig",a])}(),function(){"use strict";function a(a){function b(b){a.addToCache(d,b)}function c(){var b=a.readFromCache(d);return b?b:{patient:void 0,organization:void 0,ihe:void 0,person:void 0}}var d="session",e={updateSession:b,getSession:c};return e}var b="sessionService";angular.module("FHIRCloud").factory(b,["dataCache",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i){function j(){}function k(){return!u.isEditing}function l(){return!u.isSaving}function m(b){function d(){b&&b.resourceId&&b.hashKey&&h.deleteCachedConformance(b.hashKey,b.resourceId).then(function(){w("Deleted conformance "+b.name),a.path("/conformances")},function(a){v(e.unexpectedOutcome(a))})}var f=c.confirm().title("Delete "+b.name+"?").ok("Yes").cancel("No");c.show(f).then(d)}function n(b){b&&b.hashKey&&a.path("/conformance/edit/"+b.hashKey)}function o(){f.getActiveServer().then(function(a){return u.activeServer=a,u.activeServer})}function p(){function a(a){var b=angular.copy(a.resource);angular.isDefined(b.text)?u.narrative=b.text.div||"<div>Not provided</div>":u.narrative="<div>Not provided</div>",u.json=b,u.json.text={div:"see narrative tab"},u.json=angular.toJson(b,!0),u.conformance=b,angular.isUndefined(u.conformance.code)&&(u.conformance.code={coding:[]}),u.title=u.conformance.name,g.init(u.conformance.identifier),i.init(u.conformance.telecom,!1,!1)}if("new"===d.hashKey){var b=h.initializeNewConformance();a(b),u.title="Add New Conformance",u.isEditing=!1}else if(d.hashKey)h.getCachedConformance(d.hashKey).then(a).then(function(){},function(a){v(a)});else if(d.id){var c=u.activeServer.baseUrl+"/Conformance/"+d.id;h.getConformance(c).then(a,function(a){v(a)})}}function q(){var a="";return a=u.conformance?u.title="Edit "+(u.conformance&&u.conformance.fullName||""):u.title="Add New Conformance",u.title=a,u.title}function r(a){var b=a.headers.location||a.headers["content-location"];angular.isUndefined(b)?x("Conformance saved, but location is unavailable. CORS not implemented correctly at remote host.",null,y):(u.conformance.resourceId=e.setResourceId(u.conformance.resourceId,b),w("Conformance saved at "+b)),u.isEditing=!0,q()}function s(){if(u.conformance.name.length<5)return void v("Conformance Name must be at least 5 characters");var a=h.initializeNewConformance().resource;a.name=u.conformance.name,a.identifier=g.getAll(),u.isEditing?h.updateConformance(u.conformance.resourceId,a).then(r,function(a){v(e.unexpectedOutcome(a))}):h.addConformance(a).then(r,function(a){v(e.unexpectedOutcome(a))})}function t(){e.activateController([o()],b).then(function(){p()})}var u=this,v=e.logger.getLogFn(b,"error"),w=e.logger.getLogFn(b,"success"),x=e.logger.getLogFn(b,"warning"),y=!1;Object.defineProperty(u,"canSave",{get:l}),Object.defineProperty(u,"canDelete",{get:k}),u.activeServer=null,u.cancel=j,u.activate=t,u["delete"]=m,u.edit=n,u.getTitle=q,u.isSaving=!1,u.isEditing=!0,u.conformance=void 0,u.save=s,u.states=void 0,u.title="conformanceDetail",t()}var b="conformanceDetail";angular.module("FHIRCloud").controller(b,["$location","$mdDialog","$routeParams","common","fhirServers","identifierService","conformanceService","contactPointService",a])}(),function(){"use strict";function a(a,c,d,e,f,g){function h(){f.getActiveServer().then(function(a){return v.activeServer=a,v.activeServer})}function i(){g.getCachedSearchResults().then(l)}function j(){d.activateController([h(),i()],b).then(function(){})}function k(b){b&&a.path("/conformance/view/"+b)}function l(a){a&&(v.conformances=a.entry||[],v.paging.links=a.link||[],v.paging.totalResults=a.total||0)}function m(a){a&&(q(!0),g.getConformances(v.activeServer.baseUrl,v.searchText).then(function(a){return t("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" Conformance Statements from "+v.activeServer.name,!1),a},function(a){q(!1),u(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(l).then(function(){q(!1)}))}function n(a){q(!0),g.getConformancesByLink(a).then(function(a){return t("Returned "+(angular.isArray(a.conformances)?a.conformances.length:0)+" Conformance Statements from "+v.activeServer.name),a},function(a){q(!1),u(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(l).then(function(){q(!1)})}function o(a){a.keyCode===r.esc&&(v.searchText="")}function p(a){a.preventDefault(),c("right").toggle()}function q(a){v.isBusy=a}var r=e.keyCodes,s=d.logger.getLogFn,t=s(b,"info"),u=s(b,"error"),v=this;v.activeServer=null,v.isBusy=!1,v.conformances=[],v.errorOutcome=null,v.paging={currentPage:1,totalResults:0,links:null},v.searchResults=null,v.searchText="",v.title="Conformance Statements",v.keyPress=o,v.dereferenceLink=n,v.submit=m,v.goToDetail=k,v.toggleSideNav=p,j()}var b="conformanceSearch";angular.module("FHIRCloud").controller(b,["$location","$mdSidenav","common","config","fhirServers","conformanceService",a])}(),function(){"use strict";function a(a,c,d,e){function f(a){var b=x.defer(),e=c.readFromCache(u);return e?b.resolve(e):d.getResource(a+"/metadata").then(function(a){c.addToCache(u,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function g(a){s(a).then(function(a){a.type.coding=t(a.type.coding)});var b=x.defer();return e.getActiveServer().then(function(c){var e=c.baseUrl+"/Conformance";d.addResource(e,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function h(){c.addToCache(u,null)}function i(a,b){function d(b){for(var d=!1,f=b.entry,g=0,h=f.length;h>g;g++)if(f[g].$$hashKey===a){f.splice(g,1),b.entry=f,b.totalResults=b.totalResults-1,c.addToCache(u,b),d=!0;break}d?e.resolve():(w("Conformance not found in cache: "+a),e.resolve())}var e=x.defer();return j(b).then(k,function(a){e.reject(a)}).then(d).then(function(){e.resolve()}),e.promise}function j(a){var b=x.defer();return d.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function k(){var a=x.defer(),b=c.readFromCache(u);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function l(a){function b(b){var d,e=b.entry;d=_.find(e,{$$hashKey:a}),d?c.resolve(d):c.reject("Conformance not found in cache: "+a)}var c=x.defer();return k().then(b,function(){c.reject("Conformance search results not found in cache.")}),c.promise}function m(a){var b=x.defer();return d.getResource(a).then(function(a){c.addToCache(u,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function n(a,b){var c=x.defer();return d.getResource(a+"/Conformance?name="+b+"&_count=20").then(function(a){var b=[];a.data.entry&&angular.forEach(a.data.entry,function(a){b.push({display:a.resource.name,reference:a.resource.id})}),0===b.length&&b.push({display:"No matches",reference:""}),c.resolve(b)},function(a){c.reject(a)}),c.promise}function o(a,b){var e=x.defer();return d.getResource(a+"/Conformance?name="+b+"&_count=20").then(function(a){c.addToCache(u,a.data),e.resolve(a.data)},function(a){e.reject(a)}),e.promise}function p(a){var b=x.defer();return d.getResource(a).then(function(a){c.addToCache(u,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function q(){var a={};return a.resource={resourceType:"Conformance",active:!0},a}function r(a,b){s(b).then(function(a){a.type.coding=t(a.type.coding)});var c=x.defer();return d.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function s(a){return x.when(a)}function t(a){var b=null;if(angular.isArray(a)&&angular.isDefined(a[0]))if(angular.isObject(a[0]))b=a;else{var c=JSON.parse(a[0]);b=[],b.push(c?c:null)}return b}var u="localConformances",v=a.logger.getLogFn,w=v(b,"warning"),x=a.$q,y={addConformance:g,clearCache:h,deleteCachedConformance:i,deleteConformance:j,getCachedConformance:l,getCachedSearchResults:k,getConformance:m,getConformanceMetadata:f,getConformances:o,getConformancesByLink:p,getConformanceReference:n,initializeNewConformance:q,updateConformance:r};return y}var b="conformanceService";angular.module("FHIRCloud").factory(b,["common","dataCache","fhirClient","fhirServers",a])}(),function(){"use strict";function a(a,b){function c(a,c){var d=m.defer();if(a){var e={contentType:a.type};e.size=a.size,b.readAsDataUrl(a,c).then(function(a){e.url=a,k.push(e),d.resolve(k)},function(a){d.reject(a)})}else d.reject("File not selected.");return d.promise}function d(a){var b={url:a};k.push(b)}function e(){return k}function f(){return l}function g(a){if(angular.isUndefined(a)===!1)for(var b=0,c=k.length;c>b;b++)if(k[b].$$hashKey===a)return b;return-1}function h(a,b){l=b,k=angular.isArray(a)?a:[]}function i(a){var b=g(a.$$hashKey);return k.splice(b,1),k}function j(){for(;k.length>0;)k.pop()}var k=[],l="",m=a.$q,n={add:c,addUrl:d,remove:i,getAll:e,getTitle:f,init:h,reset:j};return n}var b="attachmentService";angular.module("FHIRCloud").factory(b,["common","fileReader",a])}(),function(){"use strict";function a(a,c,d){function e(){c.activateController([f(),g()],b).then(function(){})}function f(){k.attachments=d.getAll()}function g(){k.title=d.getTitle()}function h(){d.add(k.selectedFile,a).then(function(a){k.attachments=a},function(a){m(a)})}function i(a){d.remove(a)}function j(a){k.attachment={},a.$setPristine()}var k=this,l=c.logger.getLogFn,m=l(b,"error");k.attachments=[],k.readFile=h,k.removeListItem=i,k.reset=j,k.selectedFile=null,k.title=g,e()}var b="attachment";angular.module("FHIRCloud").controller(b,["$scope","common","attachmentService",a])}(),function(){"use strict";function a(a,c){function d(a,b){a.$valid&&(c.add(_.clone(b)),m.addresses=c.getAll(),h(),a.$setPristine())}function e(){m.addresses=c.getAll()}function f(a){var b=o.defer();return c.searchGoogle(a).then(function(a){b.resolve(a)},function(a){n(a),b.reject()}),b.promise}function g(){return m.mode=c.getMode(),m.mode}function h(){return"single"===m.mode&&m.addresses.length>0?m.address=m.addresses[0]:m.address={},m.address}function i(a){c.remove(a),m.addresses=c.getAll()}function j(a){h(),a.$setPristine()}function k(){return m.showHome=c.supportHome(),m.showHome}function l(){a.activateController([e(),g(),k(),h()],b).then(function(){m.addresses.length>0&&"single"===m.mode&&(m.address=m.addresses[0])})}var m=this,n=a.logger.getLogFn(b,"error"),o=a.$q;m.addToList=d,m.getLocation=f,m.removeListItem=i,m.reset=j,m.address=void 0,m.addresses=[],m.mode="multi",m.searchText="",m.showHome=!0,l()}var b="address";angular.module("FHIRCloud").controller(b,["common","addressService",a])}(),function(){"use strict";function a(a,b){function c(a){function c(a){var c={};if(c.line=[],a.text){var d=a.text.split(", ");c.line.push(d[0]),c.city=d[1];var e=d[2].split(" ");c.state=e[0],c.postalCode=e[1],c.country=d[3]}return a.$$hashKey=b.randomHash(),a.address=c,a}var d=_.indexOf(o,a);d>-1?o[d]=c(a):o.push(c(a))}function d(){return _.compact(o)}function e(){return n}function f(a,b,c){if(n=c?c:"multi",p=b,o=[],a&&angular.isArray(a))for(var d=0,e=a.length;e>d;d++){var f={address:a[d]};angular.isObject(f.address)&&(f.use=f.address.use,f.text=(angular.isArray(f.address.line)?f.address.line.join(" ")+", ":"")+(f.address.city?f.address.city+", ":"")+(f.address.state?f.address.state+" ":"")+(f.address.postalCode?f.address.postalCode+", ":"")+(f.address.country?f.address.country:""),o.push(f))}}function g(){function a(a){var b={line:[]};return a&&(a.use&&(b.use=a.use),a.text&&(b.text=a.text),a.address&&(b.line=a.address.line,b.city=a.address.city,b.state=a.address.state,b.postalCode=a.address.postalCode,b.country=a.address.country)),b}var b;if(o){b=[];for(var c=0,d=o.length;d>c;c++){var e=a(o[c]);b.push(e)}}return b}function h(a){_.remove(o,function(b){return a.$$hashKey===b.$$hashKey})}function i(){for(;o.length>0;)o.pop()}function j(b){var c=m.defer();return a.get("https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyCtbVf7g-kQmMQjF_kAfGawAZabKcq4rdo",{params:{address:b}}).success(function(a){var b=[];a.results&&angular.forEach(a.results,function(a){b.push(a.formatted_address)}),c.resolve(b)}).error(function(a){c.reject(a)}),c.promise}function k(a){i(),c(a)}function l(){return p}var m=b.$q,n="multi",o=[],p=!0,q={add:c,remove:h,getAll:d,getMode:e,init:f,mapFromViewModel:g,reset:i,searchGoogle:j,setSingle:k,supportHome:l};return q}var b="addressService";angular.module("FHIRCloud").factory(b,["$http","common",a])}(),function(){"use strict";function a(a,c,d,e,f){function g(){a.activateController([h(),i()],b).then(function(){})}function h(){c.getActiveServer().then(function(a){p.activeServer=a})}function i(){for(var a=f.getAll(),b=0,c=a.length;c>b;b++){var g=a[b];-1!==g.reference.indexOf("Practitioner/")?e.add(g):d.add(g)}p.practitioners=e.getAll(),p.organizations=d.getAll();

}function j(b){var c=s.defer();return d.remoteLookup(p.activeServer.baseUrl,b).then(function(a){c.resolve(a)},function(b){q(a.unexpectedOutcome(b),null,r),c.reject()}),c.promise}function k(a){a&&(d.add(a),p.organizations=d.getAll(),f.add(a))}function l(a){d.remove(a),p.organizations=d.getAll(),f.remove(a)}function m(b){var c=s.defer();return e.remoteLookup(p.activeServer.baseUrl,b).then(function(a){c.resolve(a)},function(b){q(a.unexpectedOutcome(b),null,r),c.reject()}),c.promise}function n(a){a&&(e.add(a),p.practitioners=e.getAll(),f.add(a))}function o(a){e.remove(a),p.practitioners=e.getAll(),f.remove(a)}var p=this,q=a.logger.getLogFn(b,"error"),r=(a.logger.getLogFn(b,"info"),!1),s=a.$q;p.activate=g,p.getOrganizationReference=j,p.addToOrganizationList=k,p.removeFromOrganizationList=l,p.getPractitionerReference=m,p.addToPractitionerList=n,p.removeFromPractitionerList=o,p.activeServer=null,p.organizations=[],p.organizationSearchText="",p.practitioners=[],p.practitionerSearchText="",p.selectedOrganization=null,p.selectedPractitioner=null,g()}var b="careProvider";angular.module("FHIRCloud").controller(b,["common","fhirServers","organizationReferenceService","practitionerReferenceService","careProviderService",a])}(),function(){"use strict";function a(a){function b(a){var b=d(a.$$hashKey);b>-1?g[b]=a:g.push(a)}function c(){return _.compact(g)}function d(a){if(angular.isUndefined(a)===!1)for(var b=0,c=g.length;c>b;b++)if(g[b].$$hashKey===a)return b;return-1}function e(a){return angular.isArray(a)?g=a:angular.isObject(a)&&(g=[],g.push(a)),g}function f(a){var b=d(a.$$hashKey);g.splice(b,1)}var g=[],h={add:b,remove:f,getAll:c,init:e};return h}var b="careProviderService";angular.module("FHIRCloud").factory(b,["common",a])}(),function(){"use strict";function a(a,c,d){function e(){a.activateController([g(),k()],b).then(function(){})}function f(a,b){b&&(p.communication.language.coding.push(b),p.communication.preferred=!1,p.communication.$$hashKey=b.$$hashKey,c.add(_.clone(p.communication)),p.communications=c.getAll(),p.communication=o(),a.$setPristine(),a.$setUntouched())}function g(){return p.communications=c.getAll()}function h(a){c.update(a),p.communications=c.getAll()}function i(a){var b=a?p.languageValues.filter(j(a)):[];return b}function j(a){var b=angular.lowercase(a);return function(a){return 0===angular.lowercase(a.display).indexOf(b)}}function k(){return p.languageValues=d.iso6391Languages()}function l(a){c.remove(a),p.communications=c.getAll()}function m(a){a.$setPristine()}function n(){c.setSingle(_.clone(p.language))}function o(){return p.communication={language:{coding:[],text:void 0},preferred:!1}}var p=this;p.addToList=f,p.changePreferred=h,p.querySearch=i,p.removeFromList=l,p.reset=m,p.updateLanguage=n,p.communication=o(),p.communications=[],p.languageSearchText="",p.languageValues=[],p.selectedLanguage={},e()}var b="communication";angular.module("FHIRCloud").controller(b,["common","communicationService","localValueSets",a])}(),function(){"use strict";function a(a){function b(a){var b=d(a.$$hashKey);b>-1?l[b]=a:l.push(a)}function c(){return _.compact(l)}function d(a){if(angular.isUndefined(a)===!1)for(var b=0,c=l.length;c>b;b++)if(l[b].$$hashKey===a)return b;return-1}function e(){return m}function f(){return n}function g(a,b){return m=b?b:"multi",angular.isArray(a)?l=a:angular.isObject(a)&&(l=[],l.push(a)),n=l[0],l}function h(a){var b=d(a.$$hashKey);l.splice(b,1)}function i(a){if(angular.isUndefined(a.$$hashKey)===!1)for(var b=0,c=l.length;c>b;b++)l[b].$$hashKey===a.$$hashKey?l[b]=a:1==a.preferred&&(l[b].preferred=!1)}function j(){for(;l.length>0;)l.pop()}function k(a){n=a}var l=[],m="multi",n={language:null,preferred:!1},o={add:b,remove:h,update:i,getAll:c,getMode:e,getSingle:f,init:g,reset:j,setSingle:k};return o}var b="communicationService";angular.module("FHIRCloud").factory(b,["common",a])}(),function(){"use strict";function a(a,c,d){function e(){a.activateController([h(),i()],b).then(function(){})}function f(a,b){a.$valid&&(c.add(b),l.contacts=c.getAll(),l.contact={},a.$setPristine())}function g(a){l.contact=a}function h(){l.contacts=c.getAll()}function i(){l.contactTypes=d.contactEntityType()}function j(a){c.remove(a),l.contacts=c.getAll()}function k(a){l.contact={},a.$setPristine()}var l=this;l.addToList=f,l.editListItem=g,l.contact={purpose:{coding:[]}},l.contacts=[],l.removeListItem=j,l.reset=k,e()}var b="contact";angular.module("FHIRCloud").controller(b,["common","contactService","localValueSets",a])}(),function(){"use strict";function a(a,b){function c(a){if(a){var b=e(a.$$hashKey);b>-1?j[b]=a:j.push(a)}}function d(){return j}function e(a){if(angular.isUndefined(a)===!1)for(var b=0,c=j.length;c>b;b++)if(j[b].$$hashKey===a)return b;return-1}function f(a){j=angular.isArray(a)?a:[]}function g(){function c(c){var d={telecom:[],purpose:{}};if(c){if(c.name&&(d.name=a.makeHumanName(c.name)),c.email){var e={value:c.email,use:"work",system:"email"};d.telecom.push(e)}if(c.phone){var f={value:c.phone,use:"work",system:"phone"};d.telecom.push(f)}if(c.purpose){var g=a.mapDisplayToCoding(c.purpose,b.contactEntityType());g&&(d.purpose.coding=[],d.purpose.coding.push(g))}}return d}var d;if(j){d=[];for(var e=0,f=j.length;f>e;e++){var g=c(j[e]);d.push(g)}}return d}function h(a){var b=e(a.$$hashKey);j.splice(b,1)}function i(){for(;j.length>0;)j.pop()}var j=[],k={add:c,remove:h,getAll:d,init:f,mapFromViewModel:g,reset:i};return k}var b="contactService";angular.module("FHIRCloud").factory(b,["common","localValueSets",a])}(),function(){"use strict";function a(a,c){function d(){a.activateController([g(),j(),k()],b).then(function(){l.contactPoint={use:"work"}})}function e(a,b){a.$valid&&(b.email&&c.add({system:"email",value:b.email,use:b.use}),b.phone&&c.add({system:"phone",value:b.phone,use:b.use}),b.fax&&c.add({system:"fax",value:b.fax,use:b.use}),b.url&&c.add({system:"url",value:b.url,use:b.use}),l.contactPoints=c.getAll(),l.contactPoint={},a.$setPristine())}function f(a){l.contactPoint=a}function g(){l.contactPoints=c.getAll()}function h(a){c.remove(a),l.contactPoints=c.getAll()}function i(a){a.$setPristine(),l.contactPoint={use:"work"}}function j(){return l.showHome=c.supportHome(),l.showHome}function k(){return l.showMobile=c.supportMobile(),l.showMobile}var l=this;l.addToList=e,l.editListItem=f,l.contactPoint={purpose:{coding:[]}},l.contactPoints=[],l.removeListItem=h,l.reset=i,l.showHome=!0,l.showMobile=!0,d()}var b="contactPoint";angular.module("FHIRCloud").controller(b,["common","contactPointService",a])}(),function(){"use strict";function a(){function a(a){var b=c(a.$$hashKey);b>-1?j[b]=a:j.push(a)}function b(){return j}function c(a){if(angular.isUndefined(a)===!1)for(var b=0,c=j.length;c>b;b++)if(j[b].$$hashKey===a)return b;return-1}function d(a,b,c){k=b,l=c,j=angular.isArray(a)?a:[]}function e(){function a(a){var b=[],c={};return a&&(a.phone&&(c={system:"phone",value:a.phone},a.use&&(c.use=a.use),b.push(c)),a.fax&&(c={system:"fax",value:a.fax},a.use&&(c.use=a.use),b.push(c)),a.email&&(c={system:"email",value:a.email},a.use&&(c.use=a.use),b.push(c)),a.email&&(c={system:"url",value:a.url},a.use&&(c.use=a.use),b.push(c))),b}var b;if(j){b=[];for(var c=0,d=j.length;d>c;c++)for(var e=a(j[c]),f=0,g=e.length;g>f;f++)b.push(e[f])}return j}function f(a){var b=c(a.$$hashKey);j.splice(b,1)}function g(){for(;j.length>0;)j.pop()}function h(){return k}function i(){return l}var j=[],k=!0,l=!0,m={add:a,remove:f,getAll:b,init:d,mapFromViewModel:e,reset:g,supportHome:h,supportMobile:i};return m}var b="contactPointService";angular.module("FHIRCloud").factory(b,[a])}(),function(){"use strict";function a(a,c,d,e){function f(){a.activateController([],b).then(function(){n()})}function g(a){if(a.keyCode===z.esc)y.selectedLanguage=null;else if(a.keyCode===z.enter){if(null!==y.selectedLanguage){var b={coding:[y.selectedLanguage],text:y.selectedLanguage.display};0===_.first(y.demographics.language,b).length&&y.demographics.language.push(b),updateLanguage()}y.selectedLanguage=null}}function h(){return y.ethnicities=e.ethnicity()}function i(){return y.genders=e.administrativeGender()}function j(){return y.languages=e.iso6391Languages()}function k(){return y.maritalStatuses=e.maritalStatus()}function l(){return y.religions=e.religion()}function m(){return y.races=e.race()}function n(){y.demographics.birthDate=d.getBirthDate(),y.demographics.birthOrder=d.getBirthOrder(),y.demographics.deceased=d.getDeceased(),y.demographics.deceasedDate=d.getDeceasedDate(),y.demographics.gender=d.getGender(),y.demographics.language=d.getLanguage(),y.demographics.maritalStatus=d.getMaritalStatus(),y.demographics.multipleBirth=d.getMultipleBirth(),y.demographics.race=d.getRace(),y.demographics.religion=d.getReligion(),y.demographics.ethnicity=d.getEthnicity(),y.demographics.mothersMaidenName=d.getMothersMaidenName(),y.demographics.placeOfBirth=d.getBirthPlace(),k(),m(),h(),l()}function o(){d.setBirthDate(y.demographics.birthDate)}function p(){d.setBirthOrder(y.demographics.birthOrder)}function q(){d.setDeceased(y.demographics.deceased)}function r(){d.setDeceasedDate(y.demographics.deceasedDate)}function s(){d.setGender(y.demographics.gender)}function t(a){var b={text:a.display,coding:[{system:a.system,code:a.code,display:a.display}]};d.setMaritalStatus(b)}function u(){d.setMultipleBirth(y.demographics.multipleBirth)}function v(a){var b={text:a.display,coding:[{system:y.races.system,code:a.code,display:a.display}]};d.setRace(b)}function w(a){var b={text:a.display,coding:[{system:y.religions.system,code:a.code,display:a.display}]};d.setReligion(b)}function x(a){var b={text:a.display,coding:[{system:y.ethnicities.system,code:a.code,display:a.display}]};d.setEthnicity(b)}var y=this,z=c.keyCodes;y.loadEthnicities=h,y.loadGenders=i,y.loadLanguages=j,y.loadMaritalStatuses=k,y.loadReligions=l,y.loadRaces=m,y.addLanguage=g,y.demographics={birthDate:null,birthOrder:null,deceased:!1,deceasedDate:null,gender:null,language:[],maritalStatus:null,multipleBirth:!1},y.genders=[],y.maritalStatuses=[],y.religions=[],y.races=null,y.ethnicityCoding=null,y.raceCoding=null,y.religionCoding=null,y.raceCoding=null,y.maritalStatusCoding=null,y.ethnicities=[],y.updateBirthDate=o,y.updateBirthOrder=p,y.updateDeceased=q,y.updateDeceasedDate=r,y.updateGender=s,y.updateMaritalStatus=t,y.updateMultipleBirth=u,y.updateRace=v,y.updateReligion=w,y.updateEthnicity=x,f()}var b="demographics";angular.module("FHIRCloud").controller(b,["common","config","demographicsService","localValueSets",a])}(),function(){"use strict";function a(a){function b(){return N}function c(){return O}function d(){return P}function e(){return Q}function f(){return R}function g(){return F}function h(){return G}function i(){return H}function j(){return I}function k(){return L}function l(){return J}function m(){return M}function n(){return K}function o(a,b,c){a&&(L=a),b&&(M=b),c&&(J=c)}function p(a,b){b?(G=b,K=!0):K=a}function q(a,b){b?(I=b,H=!0):H=a}function r(b){if(b)for(var c=0,d=b.length;d>c;c++){var e=b[c];if(e.url)switch(e.url){case"http://hl7.org/fhir/StructureDefinition/us-core-race":N=e.valueCodeableConcept;break;case"http://hl7.org/fhir/StructureDefinition/us-core-religion":O=e.valueCodeableConcept;break;case"http://hl7.org/fhir/StructureDefinition/us-core-ethnicity":P=e.valueCodeableConcept;break;case"http://hl7.org/fhir/StructureDefinition/patient-mothersMaidenName":R=e.valueString;break;case"http://hl7.org/fhir/StructureDefinition/birthPlace":Q=e.valueAddress,Q.text=a("singleLineAddress")(e.valueAddress)}}}function s(a){N=a}function t(a){O=a}function u(a){P=a}function v(a){Q=a}function w(a){R=a}function x(a){F=new Date(a)}function y(a){G=a}function z(a){H=a,H===!1&&(I=null)}function A(a){I=a}function B(a){L=a}function C(a){J=a}function D(a){M.coding=[],a&&M.coding.push(angular.isObject(a)?a:JSON.parse(a))}function E(a){K=a,K===!1&&(G=null)}var F=null,G=null,H=!1,I=null,J=[],K=!1,L=null,M=void 0,N=void 0,O=void 0,P=void 0,Q=void 0,R=void 0,S={getBirthDate:g,getBirthOrder:h,getDeceased:i,getDeceasedDate:j,getGender:k,getLanguage:l,getMaritalStatus:m,getMultipleBirth:n,init:o,initBirth:p,initDeath:q,setBirthDate:x,setBirthOrder:y,setDeceased:z,setDeceasedDate:A,setGender:B,setLanguage:C,setMaritalStatus:D,setMultipleBirth:E,getRace:b,setRace:s,getEthnicity:d,setEthnicity:u,getReligion:c,setReligion:t,getMothersMaidenName:f,setMothersMaidenName:w,getBirthPlace:e,setBirthPlace:v,initializeKnownExtensions:r};return S}var b="demographicsService";angular.module("FHIRCloud").factory(b,["$filter",a])}(),function(){"use strict";function a(a,c){function d(){a.activateController([g(),h(),i()],b).then(function(){m.humanNames.length>0&&"single"===m.mode?m.humanName=m.humanNames[0]:m.humanName={use:"usual"}})}function e(a,b){if(a.$valid){var d={prefix:[],suffix:[],given:[],family:[],use:b.use,period:b.period};angular.isDefined(b.prefix)&&(d.prefix=b.prefix.split(" ")),angular.isDefined(b.suffix)&&(d.suffix=b.suffix.split(" ")),angular.isDefined(b.given)&&(d.given=b.given.split(" ")),angular.isDefined(b.family)&&(d.family=b.family.split(" ")),c.add(_.clone(d)),m.humanNames=c.getAll(),i(),a.$setPristine()}}function f(a){m.humanName=a}function g(){m.humanNames=c.getAll()}function h(){return m.mode=c.getMode(),m.mode}function i(){return"single"===m.mode&&m.humanNames.length>0?m.humanName=m.humanNames[0]:m.humanName={use:"usual"},m.humanName}function j(a){m.humanNames=c.remove(a)}function k(a){i(),a.$setPristine()}function l(){"single"===m.mode&&c.setSingle(m.humanName)}var m=this;m.addToList=e,m.editListItem=f,m.humanName={},m.humanNames=[],m.mode="multi",m.removeListItem=j,m.reset=k,m.updateName=l,d()}var b="humanName";angular.module("FHIRCloud").controller(b,["common","humanNameService",a])}(),function(){"use strict";function a(a){function b(b){var c=e(b.$$hashKey);c>-1?l[c]=b:(b.text=a("fullName")(b),l.push(b))}function c(){return _.compact(l)}function d(){var a="Unspecified Name";return l.length>0&&(a=l[0].given+" "+l[0].family),a}function e(a){if(angular.isUndefined(a)===!1)for(var b=0,c=l.length;c>b;b++)if(l[b].$$hashKey===a)return b;return-1}function f(){return m}function g(b,c){return m=c?c:"multi",angular.isArray(b)?(l=[],_.forEach(b,function(b){if((angular.isUndefined(b)||null===b)===!1){var c={};angular.isArray(b.given)&&(c.given=b.given),angular.isArray(b.family)&&(c.family=b.family),angular.isArray(b.prefix)&&(c.prefix=b.prefix),angular.isArray(b.suffix)&&(c.suffix=b.suffix),c.text=b.text||a("fullName")(b),c.period=b.period,c.use=b.use,l.push(c)}})):l=[],l}function h(){var a=[];return _.forEach(l,function(b){var c={};c.given=b.given,c.family=b.family,c.prefix=b.prefix,c.suffix=b.suffix,c.text=b.text,c.period=b.period,c.use=b.use,a.push(c)}),a}function i(a){var b=e(a.$$hashKey);return l.splice(b,1),l}function j(){for(;l.length>0;)l.pop()}function k(a){j(),b(a)}var l=[],m="multi",n={add:b,remove:i,getAll:c,getFullName:d,getMode:f,init:g,mapFromViewModel:h,reset:j,setSingle:k};return n}var b="humanNameService";angular.module("FHIRCloud").factory(b,["$filter",a])}(),function(){"use strict";function a(a,c){function d(){a.activateController([h(),i()],b).then(function(){m.identifiers.length>0&&"single"===m.mode&&(m.identifier=m.identifiers[0])})}function e(a,b){a.$valid&&(c.add(_.clone(b)),m.identifiers=c.getAll(),m.identifier={},a.$setPristine(),a.$setUntouched())}function f(a){m.identifier=a}function g(){return a.generateUUID()}function h(){m.identifiers=c.getAll()}function i(){return m.mode=c.getMode(),m.mode}function j(a){c.remove(a),m.identifiers=c.getAll()}function k(a){m.identifier={use:"usual"},a.$setPristine()}function l(){c.setSingle(_.clone(m.identifier))}var m=this;m.addToList=e,m.editListItem=f,m.genId=g,m.identifier={},m.identifiers=[],m.mode="multi",m.removeListItem=j,m.reset=k,m.updateIdentifier=l,d()}var b="identifier";angular.module("FHIRCloud").controller(b,["common","identifierService",a])}(),function(){"use strict";function a(a){function b(a){var b=d(a.$$hashKey);b>-1?l[b]=a:l.push(a)}function c(){return _.compact(l)}function d(a){if(angular.isUndefined(a)===!1)for(var b=0,c=l.length;c>b;b++)if(l[b].$$hashKey===a)return b;return-1}function e(){return m}function f(){return k}function g(b,c,d){if(m=c?c:"multi",angular.isArray(b))l=b;else if(angular.isObject(b))l=[],l.push(b);else{l=[];var e="urn:fhir-cloud:id";d&&(e="urn:fhir-cloud:"+d);var f={use:"usual",system:e,value:a.generateUUID()};l.push(f)}return k=l[0],l}function h(a){var b=d(a.$$hashKey);l.splice(b,1)}function i(){for(;l.length>0;)l.pop()}function j(a){k=a}var k,l=[],m="multi",n={add:b,remove:h,getAll:c,getMode:e,getSingle:f,init:g,reset:i,setSingle:j};return n}var b="identifierService";angular.module("FHIRCloud").factory(b,["common",a])}(),function(){"use strict";function a(a,c,d){function e(){a.activateController([f()],b).then(function(){})}function f(){c.getActiveServer().then(function(a){j.activeServer=a})}function g(b){var c=m.defer();return d.remoteLookup(j.activeServer.baseUrl,b).then(function(a){c.resolve(a)},function(b){k(a.unexpectedOutcome(b),null,n),c.reject()}),c.promise}function h(a){a&&(l("Adding "+a.reference+" to list",null,n),d.add(a),j.organizations=d.getAll())}function i(a){d.remove(a),j.organizations=d.getAll()}var j=this,k=a.logger.getLogFn(b,"error"),l=a.logger.getLogFn(b,"info"),m=a.$q,n=!1;j.getOrganizationReference=g,j.addToList=h,j.removeFromList=i,j.activeServer=null,j.activate=e,j.isBusy=!1,j.organizations=[],j.organizationSearchText="",j.selectedOrganization=null,e()}var b="organizationReference";angular.module("FHIRCloud").controller(b,["common","fhirServers","organizationReferenceService",a])}(),function(){"use strict";function a(a,b,c){function d(a){var b=f(a.$$hashKey);b>-1?k[b]=a:k.push(a)}function e(){return _.compact(k)}function f(a){if(angular.isUndefined(a)===!1)for(var b=0,c=k.length;c>b;b++)if(k[b].$$hashKey===a)return b;return-1}function g(a,b){var d=l.defer();return c.getResource(a+"/Organization?name="+b+"&_count=10").then(function(b){var c=[];if(b.data.entry)for(var e=0,f=b.data.entry.length;f>e;e++){var g=b.data.entry[e];if(g.resource&&"Organization"===g.resource.resourceType&&c.push({display:g.resource.name,reference:a+"/Organization/"+g.resource.id}),10===e)break}0===c.length&&c.push({display:"No matches",reference:""}),d.resolve(c)},function(a){d.reject(a)}),d.promise}function h(a){return angular.isArray(a)?(k=[],_.forEach(a,function(a){a&&k.push(a)})):k=[],k}function i(a){var b=f(a.$$hashKey);return k.splice(b,1),k}function j(){for(;k.length>0;)k.pop()}var k=[],l=b.$q,m={add:d,remove:i,getAll:e,remoteLookup:g,init:h,reset:j};return m}var b="organizationReferenceService";angular.module("FHIRCloud").factory(b,["$filter","common","fhirClient",a])}(),function(){"use strict";function a(a,c,d){function e(){a.activateController([f()],b).then(function(){})}function f(){c.getActiveServer().then(function(a){j.activeServer=a})}function g(b){var c=m.defer();return d.remoteLookup(j.activeServer.baseUrl,b).then(function(a){c.resolve(a)},function(b){k(a.unexpectedOutcome(b),null,n),c.reject()}),c.promise}function h(a){a&&(l("Adding "+a.reference+" to list",null,n),d.add(a),j.practitioners=d.getAll())}function i(a){d.remove(a),j.practitioners=d.getAll()}var j=this,k=a.logger.getLogFn(b,"error"),l=a.logger.getLogFn(b,"info"),m=(a.logger.getLogFn(b,"warning"),a.$q),n=!1;j.getPractitionerReference=g,j.addToList=h,j.removeFromList=i,j.activeServer=null,j.activate=e,j.isBusy=!1,j.practitioners=[],j.practitionerSearchText="",j.selectedPractitioner=null,e()}var b="practitionerReference";angular.module("FHIRCloud").controller(b,["common","fhirServers","practitionerReferenceService",a])}(),function(){"use strict";function a(a,b,c){function d(a){var b=f(a.$$hashKey);b>-1?k[b]=a:k.push(a)}function e(){return _.compact(k)}function f(a){if(angular.isUndefined(a)===!1)for(var b=0,c=k.length;c>b;b++)if(k[b].$$hashKey===a)return b;return-1}function g(b,d){var e=l.defer();return c.getResource(b+"/Practitioner?name="+d+"&_count=10").then(function(c){var d=[];if(c.data.entry)for(var f=0,g=c.data.entry.length;g>f;f++){var h=c.data.entry[f];if(h.resource&&"Practitioner"===h.resource.resourceType&&d.push({display:a("fullName")(h.resource.name),reference:b+"/Practitioner/"+h.resource.id}),10===f)break}0===d.length&&d.push({display:"No matches",reference:""}),e.resolve(d)},function(a){e.reject(a)}),e.promise}function h(a){return angular.isArray(a)?(k=[],_.forEach(a,function(a){a&&k.push(a)})):k=[],k}function i(a){var b=f(a.$$hashKey);return k.splice(b,1),k}function j(){for(;k.length>0;)k.pop()}var k=[],l=b.$q,m={add:d,remove:i,getAll:e,remoteLookup:g,init:h,reset:j};return m}var b="practitionerReferenceService";angular.module("FHIRCloud").factory(b,["$filter","common","fhirClient",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i){function j(){}function k(){return!u.isEditing}function l(){return!u.isSaving}function m(b){function d(){b&&b.resourceId&&b.hashKey&&h.deleteCachedExtensionDefinition(b.hashKey,b.resourceId).then(function(){w("Deleted extensionDefinition "+b.name),a.path("/extensionDefinitions")},function(a){v(e.unexpectedOutcome(a))})}var f=c.confirm().title("Delete "+b.name+"?").ok("Yes").cancel("No");c.show(f).then(d)}function n(b){b&&b.hashKey&&a.path("/extensionDefinition/edit/"+b.hashKey)}function o(){f.getActiveServer().then(function(a){return u.activeServer=a,u.activeServer})}function p(){function a(a){var b=angular.copy(a.resource);angular.isDefined(b.text)?u.narrative=b.text.div||"<div>Not provided</div>":u.narrative="<div>Not provided</div>",u.json=b,u.json.text={div:"see narrative tab"},u.json=angular.toJson(b,!0),u.extensionDefinition=b,angular.isUndefined(u.extensionDefinition.code)&&(u.extensionDefinition.code={coding:[]}),u.title=u.extensionDefinition.name,g.init(u.extensionDefinition.identifier),i.init(u.extensionDefinition.telecom,!1,!1)}if("new"===d.hashKey){var b=h.initializeNewExtensionDefinition();a(b),u.title="Add New ExtensionDefinition",u.isEditing=!1}else if(d.hashKey)h.getCachedExtensionDefinition(d.hashKey).then(a).then(function(){},function(a){v(a)});else if(d.id){var c=u.activeServer.baseUrl+"/ExtensionDefinition/"+d.id;h.getExtensionDefinition(c).then(a,function(a){v(a)})}}function q(){var a="";return a=u.extensionDefinition?u.title="Edit "+(u.extensionDefinition&&u.extensionDefinition.fullName||""):u.title="Add New ExtensionDefinition",u.title=a,u.title}function r(a){var b=a.headers.location||a.headers["content-location"];angular.isUndefined(b)?x("ExtensionDefinition saved, but location is unavailable. CORS not implemented correctly at remote host.",null,y):(u.extensionDefinition.resourceId=e.setResourceId(u.extensionDefinition.resourceId,b),w("ExtensionDefinition saved at "+b)),u.isEditing=!0,q()}function s(){if(u.extensionDefinition.name.length<5)return void v("ExtensionDefinition Name must be at least 5 characters");var a=h.initializeNewExtensionDefinition().resource;a.name=u.extensionDefinition.name,a.identifier=g.getAll(),u.isEditing?h.updateExtensionDefinition(u.extensionDefinition.resourceId,a).then(r,function(a){v(e.unexpectedOutcome(a))}):h.addExtensionDefinition(a).then(r,function(a){v(e.unexpectedOutcome(a))})}function t(){e.activateController([o()],b).then(function(){p()})}var u=this,v=e.logger.getLogFn(b,"error"),w=e.logger.getLogFn(b,"success"),x=e.logger.getLogFn(b,"warning"),y=!1;Object.defineProperty(u,"canSave",{get:l}),Object.defineProperty(u,"canDelete",{get:k}),u.activeServer=null,u.cancel=j,u.activate=t,u["delete"]=m,u.edit=n,u.getTitle=q,u.isSaving=!1,u.isEditing=!0,u.extensionDefinition=void 0,u.save=s,u.states=void 0,u.title="extensionDefinitionDetail",t()}var b="extensionDefinitionDetail";angular.module("FHIRCloud").controller(b,["$location","$mdDialog","$routeParams","common","fhirServers","identifierService","extensionDefinitionService","contactPointService",a])}(),function(){"use strict";function a(a,c,d,e,f,g){function h(){f.getActiveServer().then(function(a){return v.activeServer=a,v.activeServer})}function i(){g.getCachedSearchResults().then(l)}function j(){d.activateController([h(),i()],b).then(function(){c("right").close()})}function k(b){b&&a.path("/extensionDefinition/view/"+b)}function l(a){a&&(v.extensionDefinitions=a.entry||[],v.paging.links=a.link||[],v.paging.totalResults=a.total||0)}function m(a){a&&(q(!0),g.getExtensionDefinitions(v.activeServer.baseUrl,v.searchText).then(function(a){return t("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" ExtensionDefinitions from "+v.activeServer.name,!1),a},function(a){q(!1),u(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(l).then(function(){q(!1)}))}function n(a){q(!0),g.getExtensionDefinitionsByLink(a).then(function(a){return t("Returned "+(angular.isArray(a.extensionDefinitions)?a.extensionDefinitions.length:0)+" ExtensionDefinitions from "+v.activeServer.name),a},function(a){q(!1),u(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(l).then(function(){q(!1)})}function o(a){a.keyCode===r.esc&&(v.searchText="")}function p(a){a.preventDefault(),c("right").toggle()}function q(a){v.isBusy=a}var r=e.keyCodes,s=d.logger.getLogFn,t=s(b,"info"),u=s(b,"error"),v=this;v.activeServer=null,v.isBusy=!1,v.extensionDefinitions=[],v.errorOutcome=null,v.paging={currentPage:1,totalResults:0,links:null},v.searchResults=null,v.searchText="",v.title="ExtensionDefinitions",v.keyPress=o,v.dereferenceLink=n,v.submit=m,v.goToDetail=k,v.toggleSideNav=p,j()}var b="extensionDefinitionSearch";angular.module("FHIRCloud").controller(b,["$location","$mdSidenav","common","config","fhirServers","extensionDefinitionService",a])}(),function(){"use strict";function a(a,c,d,e){function f(a){r(a).then(function(a){a.type.coding=s(a.type.coding)});var b=w.defer();return e.getActiveServer().then(function(c){var e=c.baseUrl+"/ExtensionDefinition";d.addResource(e,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function g(){c.addToCache(t,null)}function h(a,b){function d(b){for(var d=!1,f=b.entry,g=0,h=f.length;h>g;g++)if(f[g].$$hashKey===a){f.splice(g,1),b.entry=f,b.totalResults=b.totalResults-1,c.addToCache(t,b),d=!0;break}d?e.resolve():(v("ExtensionDefinition not found in cache: "+a),e.resolve())}var e=w.defer();return i(b).then(j,function(a){e.reject(a)}).then(d).then(function(){e.resolve()}),e.promise}function i(a){var b=w.defer();return d.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function j(){var a=w.defer(),b=c.readFromCache(t);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function k(a){function b(b){var d,e=b.entry;d=_.find(e,{$$hashKey:a}),d?c.resolve(d):c.reject("ExtensionDefinition not found in cache: "+a)}var c=w.defer();return j().then(b,function(){c.reject("ExtensionDefinition search results not found in cache.")}),c.promise}function l(a){var b=w.defer();return d.getResource(a).then(function(a){c.addToCache(t,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function m(a,b){var c=w.defer();return d.getResource(a+"/ExtensionDefinition?name="+b+"&_count=20").then(function(a){var b=[];a.data.entry&&angular.forEach(a.data.entry,function(a){b.push({display:a.resource.name,reference:a.resource.id})}),0===b.length&&b.push({display:"No matches",reference:""}),c.resolve(b)},function(a){c.reject(a)}),c.promise}function n(a,b){var e=w.defer();return d.getResource(a+"/ExtensionDefinition?name="+b+"&_count=20").then(function(a){c.addToCache(t,a.data),e.resolve(a.data)},function(a){e.reject(a)}),e.promise}function o(a){var b=w.defer();return d.getResource(a).then(function(a){c.addToCache(t,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function p(){var a={};return a.resource={resourceType:"ExtensionDefinition",identifier:[],telecom:[],active:!0},a}function q(a,b){r(b).then(function(a){a.type.coding=s(a.type.coding)});var c=w.defer();return d.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function r(a){return 0===a.identifier.length&&(a.identifier=null),0===a.telecom.length&&(a.telecom=null),w.when(a)}function s(a){var b=null;if(angular.isArray(a)&&angular.isDefined(a[0]))if(angular.isObject(a[0]))b=a;else{var c=JSON.parse(a[0]);b=[],b.push(c?c:null)}return b}var t="localExtensionDefinitions",u=a.logger.getLogFn,v=u(b,"warning"),w=a.$q,x={addExtensionDefinition:f,clearCache:g,deleteCachedExtensionDefinition:h,deleteExtensionDefinition:i,getCachedExtensionDefinition:k,getCachedSearchResults:j,getExtensionDefinition:l,getExtensionDefinitions:n,getExtensionDefinitionsByLink:o,getExtensionDefinitionReference:m,initializeNewExtensionDefinition:p,updateExtensionDefinition:q};return x}var b="extensionDefinitionService";angular.module("FHIRCloud").factory(b,["common","dataCache","fhirClient","fhirServers",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){i.activateController([B(),v(),z(),x(),w(),y()],b).then(function(){var a=moment(new Date);Y.vitals.date=new Date(a.year(),a.month(),a.date(),a.hour(),a.minute()),A()})}function s(){Y.vitals.bp.diastolic=0,Y.vitals.bp.systolic=0,Y.vitals.bp.interpretationCode=void 0,Y.vitals.bp.interpretationText="Enter new reading"}function t(){Y.vitals.bmi.height=void 0,Y.vitals.bmi.weight=void 0,Y.vitals.bmi.interpretationCode=void 0,Y.vitals.bmi.interpretationText="Enter new reading"}function u(){if(Y.vitals.bmi.height&&Y.vitals.bmi.weight&&Y.vitals.bmi.height>0&&Y.vitals.bmi.weight>0){var a=Y.vitals.bmi.height/39.3700787,b=Y.vitals.bmi.weight/2.20462;Y.vitals.bmi.calculated=Math.floor(b/Math.pow(a,2)*100)/100}switch(!0){case Y.vitals.bmi.calculated<=18.5:Y.vitals.bmi.interpretationText="Underweight",Y.vitals.bmi.color="blue";break;case Y.vitals.bmi.calculated>=30&&Y.vitals.bmi.calculated<40:Y.vitals.bmi.interpretationText="Obese",Y.vitals.bmi.color="red";break;case Y.vitals.bmi.calculated>=40:Y.vitals.bmi.interpretationText="Severely Obese",Y.vitals.bmi.color="purple";break;case Y.vitals.bmi.calculated>18.5&&Y.vitals.bmi.calculated<25:Y.vitals.bmi.interpretationText="Healthy weight",Y.vitals.bmi.color="green";break;case Y.vitals.bmi.calculated>=25&&Y.vitals.bmi.calculated<30:Y.vitals.bmi.interpretationText="Overweight",Y.vitals.bmi.color="orange";break;default:Y.vitals.bmi.interpretationText="",Y.vitals.bmi.color="grey"}}function v(){return Y.smokingStatuses=n.smokingStatus()}function w(){return Y.bmiInterpretations=n.bmiRange()}function x(){return Y.bpInterpretations=n.bpInterpretation()}function y(){Y.bodyTempMethods=n.bodyTempMethods(),Y.bodyTempFinding=n.bodyTempFindings()}function z(){return Y.interpretations=n.interpretation()}function A(){if(angular.isDefined(f.smartApp)){var b="";switch(f.smartApp){case"cardiac-risk":b="https://fhir-dstu2.smarthealthit.org/apps/cardiac-risk/launch.html?";break;case"bp-centiles":b="https://fhir-dstu2.smarthealthit.org/apps/bp-centiles/launch.html?";break;case"growth-chart":b="https://fhir-dstu2.smarthealthit.org/apps/growth-chart/launch.html?";break;case"disease-monograph":b="https://fhir-dstu2.smarthealthit.org/apps/disease-monograph/launch.html?";break;case"diabetes-monograph":b="https://fhir-dstu2.smarthealthit.org/apps/diabetes-monograph/launch.html?";break;default:b="https://fhir.meducation.com/launch.html?"}var d=encodeURIComponent(Y.activeServer.baseUrl);Y.smartLaunchUrl=b+"fhirServiceUrl="+d+"&patientId="+f.patientId,$("Launching SMART on FHIR application, please wait ...")}else angular.isDefined(h.localStorage.patient)?(Y.consultation.patient=JSON.parse(h.localStorage.patient),Y.consultation.patient.fullName=a("fullName")(Y.consultation.patient.name),Y.consultation.patient.age=i.calculateAge(Y.consultation.patient.birthDate)):(Z("You must first select a patient before initiating a consultation",error),c.path("/patient"))}function B(){j.getActiveServer().then(function(a){Y.activeServer=a})}function C(a){var b=aa.defer();return o.getPractitionerReference(Y.activeServer.baseUrl,a).then(function(a){b.resolve(a);

},function(a){Z(i.unexpectedOutcome(a),null,ba),b.reject()}),b.promise}function D(a){function b(a){this.items=[{name:"Back to face sheet",icon:"person",index:0},{name:"Lab",icon:"lab",index:1},{name:"Cardiac Risk",icon:"cardio",index:2},{name:"Find another patient",icon:"person",index:7}],this.title="Observation options",this.performAction=function(b){a.hide(b)}}d.show({parent:angular.element(document.getElementById("content")),templateUrl:"./templates/resourceSheet.html",controller:["$mdBottomSheet",b],controllerAs:"vm",bindToController:!0,targetEvent:a}).then(function(a){switch(a.index){case 0:c.path("patient/view/current");break;case 1:c.path("/lab");break;case 2:c.path("consultation/smart/cardiac-risk/"+Y.consultation.patient.id);break;case 3:c.path("consultation/smart/disease-monograph/"+Y.consultation.patient.id);break;case 4:c.path("consultation/smart/diabetes-monograph/"+Y.consultation.patient.id);break;case 5:c.path("consultation/smart/bp-centiles/"+Y.consultation.patient.id);break;case 6:c.path("consultation/smart/meducation/"+Y.consultation.patient.id);break;case 7:c.path("/patient")}})}function E(){var a=Y.vitals.bp.systolic;if(Y.vitals.bp.diastolic<60||90>=a)Y.vitals.bp.interpretationText="Low reading",Y.vitals.bp.color="blue";else if(Y.vitals.bp.diastolic>90||a>=140)Y.vitals.bp.interpretationText="High reading",Y.vitals.bp.color="red";else if(Y.vitals.bp.diastolic>=60&&Y.vitals.bp.diastolic<=80)switch(!0){case 120>=a:Y.vitals.bp.interpretationText="Reading is ideal and healthy",Y.vitals.bp.color="green";break;case 140>=a:Y.vitals.bp.interpretationText="A little higher than it should be",Y.vitals.bp.color="orange";break;default:Y.vitals.bp.interpretationText="Inconclusive",Y.vitals.bp.color="grey"}else if(Y.vitals.bp.diastolic>80&&Y.vitals.bp.diastolic<=90)switch(!0){case 140>=a:Y.vitals.bp.interpretationText="A little higher than it should be",Y.vitals.bp.color="orange";break;default:Y.vitals.bp.interpretationText="Inconclusive",Y.vitals.bp.color="grey"}}function F(){switch(!0){case Y.vitals.temperature.value<95:Y.vitals.temperature.interpretationText="Hypothermia",Y.vitals.temperature.color="blue";break;case Y.vitals.temperature.value>=95&&Y.vitals.temperature.value<97.7:Y.vitals.temperature.interpretationText="Below normal",Y.vitals.temperature.color="orange";break;case Y.vitals.temperature.value>=97.7&&Y.vitals.temperature.value<=99.5:Y.vitals.temperature.interpretationText="Normal",Y.vitals.temperature.color="green";break;case Y.vitals.temperature.value>99.5&&Y.vitals.temperature.value<=100.9:Y.vitals.temperature.interpretationText="Fever",Y.vitals.temperature.color="red";break;case Y.vitals.temperature.value>100.9:Y.vitals.temperature.interpretationText="Hyperpyrexia",Y.vitals.temperature.color="purple";break;default:Y.vitals.temperature.interpretationText="Indeterminate",Y.vitals.temperature.color="grey"}}function G(){switch(!0){case Y.vitals.hr.pulse<60:Y.vitals.hr.interpretationText="Heart rate is below normal",Y.vitals.hr.color="blue";break;case Y.vitals.hr.pulse>100:Y.vitals.hr.interpretationText="Heart rate is above normal",Y.vitals.hr.color="red";break;case Y.vitals.hr.pulse<=100&&Y.vitals.hr.pulse>=60:Y.vitals.hr.interpretationText="Normal heart rate",Y.vitals.hr.color="green";break;default:Y.vitals.hr.interpretationText="Indeterminate",Y.vitals.hr.color="grey"}}function H(){switch(!0){case Y.vitals.respiration.rate<12:Y.vitals.respiration.interpretationText="Respiration is lower than normal",Y.vitals.respiration.color="blue";break;case Y.vitals.respiration.rate>16:Y.vitals.respiration.interpretationText="Respiration is higher than normal",Y.vitals.respiration.color="red";break;case Y.vitals.respiration.rate>=12&&Y.vitals.respiration.rate<=16:Y.vitals.respiration.interpretationText="Respiration is normal",Y.vitals.respiration.color="green";break;default:Y.vitals.respiration.interpretationText="Indeterminate",Y.vitals.respiration.color="grey"}}function I(a){function b(a){for(var b=aa.defer(),c=0,d=T(),e=0,f=a.length;f>=e;e++)void 0!==a[e]&&(Y.isBusy=!0,m.addObservation(a[e]).then(X,function(a){Z(i.unexpectedOutcome(a)),Y.isBusy=!1,b.reject(a)}).then(function(e){if(angular.isDefined(e)&&angular.isDefined(d)){var f={type:"has-component"};f.target={reference:"Observation/"+e},d.related.push(f),c+=1}c===a.length&&b.resolve(d)}));return b.promise}$("Saving blood pressure readings to "+Y.activeServer.name);var c=[];c.push(S()),c.push(R()),b(c).then(function(a){angular.isDefined(a)&&m.addObservation(a).then(X,function(a){Z(i.unexpectedOutcome(a))})},function(a){Z(i.unexpectedOutcome(a))}).then(function(){s(),a.$setPristine()})}function J(a){function b(a){for(var b=aa.defer(),c=0,d=T(),e=0,f=a.length;f>=e;e++)void 0!==a[e]&&(Y.isBusy=!0,m.addObservation(a[e]).then(X(),function(a){Z(i.unexpectedOutcome(a)),Y.isBusy=!1,b.reject(a)}).then(function(e){if(angular.isDefined(e)&&angular.isDefined(d)){var f={type:"has-component"};f.target={reference:"Observation/"+e},d.related.push(f),c+=1}c===a.length&&b.resolve(d)}));return b.promise}$("Saving heart and respiration results to "+Y.activeServer.name);var c=[];c.push(O()),c.push(P()),b(c).then(function(a){angular.isDefined(a)&&m.addObservation(a).then(X,function(a){Z(i.unexpectedOutcome(a))})},function(a){Z(i.unexpectedOutcome(a))}).then(function(){s(),a.$setPristine()})}function K(a){function b(a){for(var b=aa.defer(),c=0,d=U(),e=0,f=a.length;f>=e;e++)void 0!==a[e]&&(Y.isBusy=!0,m.addObservation(a[e]).then(X,function(a){Z(i.unexpectedOutcome(a)),Y.isBusy=!1,b.reject(a)}).then(function(e){if(angular.isDefined(e)&&angular.isDefined(d)){var f={type:"has-component"};f.target={reference:"Observation/"+e},d.related.push(f),c+=1}c===a.length&&b.resolve(d)}));return b.promise}$("Saving height, weight and BMI to "+Y.activeServer.name);var c=[];c.push(V()),c.push(W()),b(c).then(function(a){angular.isDefined(a)&&m.addObservation(a).then(X,function(a){Z(i.unexpectedOutcome(a))})},function(a){Z(i.unexpectedOutcome(a))}).then(function(){t(),a.$setPristine()})}function L(a){if(angular.isDefined(Y.vitals.temperature.value)){var b=Q();$("Saving body temperature to "+Y.activeServer.name),m.addObservation(b).then(X,function(a){Z(i.unexpectedOutcome(a))}).then(function(){t(),a.$setPristine()})}}function M(a){var b=N();$("Saving smoking status to "+Y.activeServer.name),m.addObservation(b).then(X,function(a){Z(i.unexpectedOutcome(a))}).then(function(){t(),a.$setPristine()})}function N(){var a=m.initializeNewObservation();a.code={coding:[],text:"Smoking status"};var b=angular.fromJson(Y.vitals.smokingStatus);return b.system=Y.smokingStatuses.system,a.code.coding.push(b),a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+Y.consultation.patient.id,display:Y.consultation.patient.fullName},a.appliesDateTime=Y.vitals.date.toISOString(),a}function O(){var a=m.initializeNewObservation();return a.code={coding:[{system:"http://loinc.org",code:"8867-4",display:"Heart rate",primary:!0}],text:"Heart rate"},a.valueQuantity={value:Y.vitals.bp.systolic,units:"mm[Hg]"},a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+Y.consultation.patient.id,display:Y.consultation.patient.fullName},a.appliesDateTime=Y.vitals.date.toISOString(),a}function P(){var a=m.initializeNewObservation();return a.code={coding:[{system:"http://snomed.info/sct",code:"86290005",display:"Respiratory rate"},{system:"http://loinc.org",code:"9279-1",display:"Respiratory rate",primary:!0}],text:"Respiratory rate"},a.valueQuantity={value:Y.vitals.respiration.rate,units:"breaths/min",code:"258984001",system:"http://snomed.info/sct"},a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+Y.consultation.patient.id,display:Y.consultation.patient.fullName},a.appliesDateTime=Y.vitals.date.toISOString(),a}function Q(){var a=m.initializeNewObservation();if(a.code={coding:[{system:"http://loinc.org",code:"8310-5",display:"Body temperature",primary:!0},{system:"http://snomed.info/sct",code:"386725007",display:"Body temperature",primary:!1}],text:"Body temperature"},angular.isDefined(Y.vitals.temperature.method)){a.method={coding:[]};var b=angular.fromJson(Y.vitals.temperature.method);b.system=Y.bodyTempMethods.system,b.primary=!0,a.method.coding.push(b)}if(angular.isDefined(Y.vitals.temperature.interpretationCode)){a.interpretation={coding:[]};var c=angular.fromJson(Y.vitals.temperature.interpretationCode);c.system=Y.bodyTempFinding.system,c.primary=!0,a.interpretation.coding.push(c)}return a.valueQuantity={value:Y.vitals.temperature.value,units:"F",code:"258712004",system:"http://snomed.info/sct"},a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+Y.consultation.patient.id,display:Y.consultation.patient.fullName},a.appliesDateTime=Y.vitals.date.toISOString(),a}function R(){var a=m.initializeNewObservation();return a.code={coding:[{system:"http://snomed.info/sct",code:"271649006",display:"Systolic blood pressure",primary:!1},{system:"http://loinc.org",code:"8480-6",display:"Systolic blood pressure",primary:!0}],text:"Systolic blood pressure"},a.valueQuantity={value:Y.vitals.bp.systolic,units:"mm[Hg]",system:"http://loinc.org",code:"20053-5"},a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+Y.consultation.patient.id,display:Y.consultation.patient.fullName},a.appliesDateTime=Y.vitals.date.toISOString(),a}function S(){var a=m.initializeNewObservation();return a.code={coding:[{system:"http://snomed.info/sct",code:"271650006",display:"Diastolic blood pressure",primary:!1},{system:"http://loinc.org",code:"8462-4",display:"Diastolic blood pressure",primary:!0}],text:"Diastolic blood pressure"},a.valueQuantity={value:Y.vitals.bp.diastolic,units:"mm[Hg]",system:"http://loinc.org",code:"20053-5"},a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+Y.consultation.patient.id,display:Y.consultation.patient.fullName},a.appliesDateTime=Y.vitals.date.toISOString(),a}function T(){if(Y.vitals.bp.interpretationCode){var a=m.initializeNewObservation();a.code={coding:[{system:"http://loinc.org",code:"55284-4",display:"Blood pressure systolic & diastolic",primary:!0}],text:"Blood pressure systolic & diastolic"},a.interpretation={coding:[],text:Y.vitals.bp.interpretationText};var b=angular.fromJson(Y.vitals.bp.interpretationCode);return b.system=Y.interpretations.system,a.interpretation.coding.push(b),a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+Y.consultation.patient.id,display:Y.consultation.patient.fullName},a.appliesDateTime=Y.vitals.date.toISOString(),a}return void 0}function U(){var a=m.initializeNewObservation();if(a.code={coding:[{system:"http://snomed.info/sct",code:"60621009",display:"Body mass index",primary:!1},{system:"http://loinc.org",code:"39156-5",display:"Body mass index (BMI) [Ratio]",primary:!0}],text:"Body mass index"},a.bodySiteCodeableConcept={coding:[{system:"http://snomed.info/sct",code:"38266002",display:"Entire body as a whole"}]},a.referenceRange=[{high:{value:20},meaning:{coding:[{system:"http://snomed.info/sct",code:"310252000",display:"Low BMI"}]}},{low:{value:20},high:{value:25},meaning:{coding:[{system:"http://snomed.info/sct",code:"412768003",display:"Normal BMI"}]}},{low:{value:25},high:{value:30},meaning:{coding:[{system:"http://snomed.info/sct",code:"162863004",display:"Overweight"}]}},{low:{value:30},high:{value:40},meaning:{coding:[{system:"http://snomed.info/sct",code:"162864005",display:"Obesity"}]}},{low:{value:40},meaning:{coding:[{system:"http://snomed.info/sct",code:"162864005",display:"Severe obesity"}]}}],a.valueQuantity={value:Y.vitals.bmi.calculated,units:"lb/in2",code:"362981000",system:"http://snomed.info/sct"},a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+Y.consultation.patient.id,display:Y.consultation.patient.fullName},a.appliesDateTime=Y.vitals.date.toISOString(),Y.vitals.bmi.interpretationCode){a.interpretation={coding:[],text:Y.vitals.bmi.interpretationText};var b=angular.fromJson(Y.vitals.bmi.interpretationCode);b.system=Y.interpretations.system,a.interpretation.coding.push(b)}return a}function V(){var a=m.initializeNewObservation();return"Standing"===Y.vitals.bmi.heightMeasured?a.code={coding:[{system:"http://loinc.org",code:"8302-2",display:"Body height",primary:!0},{system:"http://snomed.info/sct",code:"248333004",display:"Standing height",primary:!1}],text:"Standing body height"}:a.code={coding:[{system:"http://loinc.org",code:"8306-3",display:"Body height - lying",primary:!0},{system:"http://snomed.info/sct",code:"248334005",display:"Length of body",primary:!1}],text:"Lying body height"},a.valueQuantity={value:Y.vitals.bmi.height,units:"in",system:"http://snomed.info/sct",code:"258677007"},a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+Y.consultation.patient.id,display:Y.consultation.patient.fullName},a.appliesDateTime=Y.vitals.date.toISOString(),a}function W(){var a=m.initializeNewObservation();return a.code={coding:[{system:"http://snomed.info/sct",code:"27113001",display:"Body weight",primary:!1},{system:"http://loinc.org",code:"3141-9",display:"Body weight Measured",primary:!0}],text:"Body weight"},a.valueQuantity={value:Y.vitals.bmi.weight,units:"lb",system:"http://snomed.info/sct",code:"258693003"},a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+Y.consultation.patient.id,display:Y.consultation.patient.fullName},a.appliesDateTime=Y.vitals.date.toISOString(),a}function X(b){var c=aa.defer(),d=b.headers.location||b.headers["content-location"];return angular.isUndefined(d)?(_("Observation saved, but location is unavailable. CORS not implemented correctly at remote host.",null,ba),c.resolve(void 0)):($("Observation recorded at "+d,null,ba),c.resolve(a("idFromURL")(d))),c.promise}var Y=this,Z=i.logger.getLogFn(b,"error"),$=i.logger.getLogFn(b,"info"),_=i.logger.getLogFn(b,"warning"),aa=i.$q,ba=!1;Y.calculateBMI=u,Y.getPractitionerReference=C,Y.updateBP=E,Y.updateTemperature=F,Y.updatePulse=G,Y.updateRespiration=H,Y.saveBloodPressure=I,Y.savePulseAndRespiration=J,Y.saveBMI=K,Y.saveOther=L,Y.saveSmokingStatus=M,Y.actions=D,Y.activeServer=null,Y.activate=r,Y.observation=null,Y.isBusy=!1,Y.observation=void 0,Y.practitionerSearchText="",Y.selectedPractitioner=null,Y.smartLaunchUrl="",Y.consultation={},Y.smokingStatuses=[],Y.bpInterpretations=[],Y.bmiInterpretations=[],Y.interpretations=[],Y.bodyTempFinding=void 0,Y.bodyTempMethods=void 0,Y.vitals={bp:{systolic:void 0,diastolic:void 0,interpretationCode:void 0,color:"black",interpretationText:void 0},hr:{pulse:void 0,interpretationCode:void 0,color:"black",interpretationText:void 0},respiration:{rate:void 0,interpretationCode:void 0,color:"black",interpretationText:void 0},bmi:{height:void 0,heightMeasured:"Standing",weight:void 0,calculated:void 0,interpretationCode:void 0,color:"black",interpretationText:void 0},smokingStatus:void 0,temperature:{value:void 0,method:void 0,interpretationCode:void 0,color:"black",interpretationText:void 0}},Y.consultation.patient=void 0,Y.smartLaunchUrl="",r()}var b="consultationDetail";angular.module("FHIRCloud").controller(b,["$filter","$location","$mdBottomSheet","$mdDialog","$routeParams","$scope","$window","common","fhirServers","localValueSets","identifierService","observationService","observationValueSets","practitionerService","careProviderService","patientService",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i){function j(a){G(a);var b=L.defer();return h.getActiveServer().then(function(c){var d=c.baseUrl+"/Observation";g.addResource(d,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function k(){f.addToCache(H,null)}function l(a,b){function c(b){if(b&&b.entry){var c=b.entry;b.entry=_.remove(c,function(b){return b.$$hashKey!==a}),b.totalResults=b.totalResults-1,f.addToCache(H,b)}d.resolve()}var d=L.defer();return m(b).then(o,function(a){d.reject(a)}).then(c,function(a){d.reject(a)}).then(function(){d.resolve()}),d.promise}function m(a){var b=L.defer();return g.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function n(a){function b(b){for(var e,f=b.entry,g=0,h=f.length;h>g;g++)if(f[g].$$hashKey===a){e=f[g].resource;var i=b.base||c.baseUrl+"/";e.resourceId=i+e.resourceType+"/"+e.id,e.hashKey=a;break}e?d.resolve(e):d.reject("Observation not found in cache: "+a)}var c,d=L.defer();return o().then(h.getActiveServer().then(function(a){c=a})).then(b,function(){d.reject("Observation search results not found in cache.")}),d.promise}function o(){var a=L.defer(),b=f.readFromCache(H);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function p(a){var b=L.defer();return g.getResource(a).then(function(a){f.addToCache(H,a),b.resolve(a)},function(a){b.reject(a)}),b.promise}function q(){return f.readFromCache(H)}function r(b,c){var d=L.defer();return g.getResource(b+"/Observation?code="+c+"&_count=20").then(function(b){var c=[];b.data.entry&&angular.forEach(b.data.entry,function(b){b.content&&"Observation"===b.content.resourceType&&c.push({display:a("fullName")(b.content.name),reference:b.id})}),0===c.length&&c.push({display:"No matches",reference:""}),d.resolve(c)},function(a){d.reject(a)}),d.promise}function s(a,b){var c=L.defer();return angular.isUndefined(b)&&angular.isUndefined(organizationId)&&c.reject("Invalid search input"),g.getResource(a+"/Observation?"+b+"&_count=20").then(function(a){f.addToCache(H,a.data),c.resolve(a.data)},function(a){c.reject(a)}),c.promise}function t(a,b,c){var d=L.defer(),e="";if(angular.isUndefined(b)&&angular.isUndefined(c)&&d.reject("Invalid search input"),angular.isDefined(c)){var h="subject:Patient="+c;e=e.length>1?e+"&"+h:h}return g.getResource(a+"/Observation/_filter?"+e+"&_count=20").then(function(a){f.addToCache(H,a.data),d.resolve(a.data)},function(a){d.reject(a)}),d.promise}function u(a){var b=L.defer();return g.getResource(a).then(function(a){f.addToCache(H,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function v(){return{resourceType:"Observation",code:null,valueQuantity:null,valueCodeableConcept:null,valueString:null,valueRange:null,valueRatio:null,valueSampledData:null,valueAttachment:null,valueTime:null,valueDateTime:null,valuePeriod:null,dataAbsentReason:null,interpretation:null,comments:null,appliesDateTime:null,appliesPeriod:null,issued:null,status:null,reliability:null,bodySiteCodeableConcept:null,bodySiteReference:null,method:null,identifier:[{system:"urn:fhir-cloud:observation",value:e.randomHash(),use:"official",assigner:{display:"FHIR Cloud"}}],subject:null,specimen:null,performer:[],device:null,encounter:null,referenceRange:[],related:[]}}function w(a){f.addToCache(I,a)}function x(a,b){G(b);var c=L.defer();return g.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function y(b,e){var f=L.defer(),g=[],h=[];return c.get("http://api.randomuser.me/?results=25&nat=us").success(function(c){angular.forEach(c.results,function(c){var f=c.user,i=new Date(parseInt(f.dob)),k=a("date")(i,"yyyy-MM-dd"),l={resourceType:"Observation",name:[{family:[a("titleCase")(f.name.last)],given:[a("titleCase")(f.name.first)],prefix:[a("titleCase")(f.name.title)],use:"usual"}],gender:f.gender,birthDate:k,contact:[],communication:E(),maritalStatus:F(),telecom:[{system:"email",value:f.email,use:"home"},{system:"phone",value:f.cell,use:"mobile"},{system:"phone",value:f.phone,use:"home"}],address:[{line:[a("titleCase")(f.location.street)],city:a("titleCase")(f.location.city),state:a("abbreviateState")(f.location.state),postalCode:f.location.zip,use:"home"}],photo:[{url:f.picture.large}],identifier:[{system:"urn:oid:2.16.840.1.113883.4.1",value:f.SSN,use:"official",label:"Social Security Number",assigner:{display:"Social Security Administration"}},{system:"urn:oid:2.16.840.1.113883.15.18",value:f.registered,use:"official",label:e+" master Id",assigner:{display:e}}],managingOrganization:{reference:"Organization/"+b,display:e},link:[],active:!0,extension:[]};l.extension.push(B()),l.extension.push(C()),l.extension.push(D()),l.extension.push(z(h)),l.extension.push(A(g)),h.push([a("titleCase")(f.name.last)]),g.push(l.address[0].city+", "+l.address[0].state);var m=d(function(){},3e3);m.then(function(){j(l).then(function(a){K("Created observation "+f.name.first+" "+f.name.last+" at "+(a.headers.location||a.headers["content-location"]),null,!1)},function(a){J("Failed to create observation "+f.name.first+" "+f.name.last,a,!1)})})}),f.resolve()}).error(function(a){f.reject(a)}),f.promise}function z(a){var b={url:"http://hl7.org/fhir/StructureDefinition/observation-mothersMaidenName",valueString:""};return a.length>0?(e.shuffle(a),b.valueString=a[0]):b.valueString="Gibson",b}function A(a){var b={url:"http://hl7.org/fhir/StructureDefinition/birthPlace",valueAddress:null};return a.length>0?(e.shuffle(a),b.valueAddress={text:a[0]}):b.valueAddress={text:"New York, NY",city:"New York",state:"NY",country:"USA"},b}function B(){var a=i.race();e.shuffle(a.concept);var b=a.concept[1],c={url:"http://hl7.org/fhir/StructureDefinition/us-core-race",valueCodeableConcept:{coding:[],text:b.display}};return c.valueCodeableConcept.coding.push({system:a.system,code:b.code,display:b.display}),c}function C(){var a=i.ethnicity();e.shuffle(a.concept);var b=a.concept[1],c={url:"http://hl7.org/fhir/StructureDefinition/us-core-ethnicity",valueCodeableConcept:{coding:[],text:b.display}};return c.valueCodeableConcept.coding.push({system:a.system,code:b.code,display:b.display}),c}function D(){var a=i.religion();e.shuffle(a.concept);var b=a.concept[1],c={url:"http://hl7.org/fhir/StructureDefinition/us-core-religion",valueCodeableConcept:{coding:[],text:b.display}};return c.valueCodeableConcept.coding.push({system:a.system,code:b.code,display:b.display}),c}function E(){var a=i.iso6391Languages();e.shuffle(a);var b=[],c={language:{text:a[1].display,coding:[]},preferred:!0};return c.language.coding.push({system:a[1].system,code:a[1].code,display:a[1].display}),b.push(c),b}function F(){var a=i.maritalStatus();e.shuffle(a);var b=a[1],c={coding:[],text:b.display};return c.coding.push({system:b.system,code:b.code,display:b.display}),c}function G(a){return 0===a.identifier.length&&(a.identifier=null),0===a.performer.length&&(a.performer=null),0===a.referenceRange.length&&(a.referenceRange=null),0===a.related.length&&(a.related=null),L.when(a)}var H="localObservations",I="contextObservation",J=e.logger.getLogFn(b,"error"),K=e.logger.getLogFn(b,"info"),L=e.$q,M={addObservation:j,clearCache:k,deleteCachedObservation:l,deleteObservation:m,getCachedObservation:n,getCachedSearchResults:o,getObservation:p,getObservationContext:q,getObservationReference:r,getObservations:t,getObservationsByLink:u,initializeNewObservation:v,setObservationContext:w,updateObservation:x,seedRandomObservations:y,searchObservations:s};return M}var b="observationService";angular.module("FHIRCloud").factory(b,["$filter","$http","$timeout","common","dataCache","fhirClient","fhirServers","localValueSets",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){i.activateController([t()],b).then(function(){var a=moment(new Date);M.lab.date=new Date(a.year(),a.month(),a.date(),a.hour(),a.minute()),s()})}function s(){if(angular.isDefined(f.smartApp)){var b="";switch(f.smartApp){case"cardiac-risk":b="https://fhir-dstu2.smarthealthit.org/apps/cardiac-risk/launch.html?";break;case"growth-chart":b="https://fhir-dstu2.smarthealthit.org/apps/growth-chart/launch.html?";break;default:b="https://fhir-dstu2.smarthealthit.org/apps/diabetes-monograph/launch.html?"}var d=encodeURIComponent(M.activeServer.baseUrl);M.smartLaunchUrl=b+"fhirServiceUrl="+d+"&patientId="+f.patientId}else angular.isDefined(h.localStorage.patient)?(M.lab.patient=JSON.parse(h.localStorage.patient),M.lab.patient.fullName=a("fullName")(M.lab.patient.name),M.lab.patient.age=i.calculateAge(M.lab.patient.birthDate)):(N("You must first select a patient before initiating a lab",error),c.path("/patient"))}function t(){j.getActiveServer().then(function(a){M.activeServer=a})}function u(a){var b=Q.defer();return o.getPractitionerReference(M.activeServer.baseUrl,a).then(function(a){b.resolve(a)},function(a){N(i.unexpectedOutcome(a),null,R),b.reject()}),b.promise}function v(a){function b(a){this.items=[{name:"Back to face sheet",icon:"person",index:0},{name:"Consult",icon:"consult",index:1},{name:"Cardiac Risk report",icon:"cardio",index:2},{name:"Find another patient",icon:"person",index:3}],this.title="Lab options",this.performAction=function(b){a.hide(b)}}d.show({parent:angular.element(document.getElementById("content")),templateUrl:"./templates/resourceSheet.html",controller:["$mdBottomSheet",b],controllerAs:"vm",bindToController:!0,targetEvent:a}).then(function(a){switch(a.index){case 0:c.path("patient/view/current");break;case 1:c.path("consultation");break;case 2:c.path("consultation/smart/cardiac-risk/"+M.lab.patient.id);break;case 3:c.path("/patient")}})}function w(){switch(!0){case M.lab.lipid.triglyceride.value<150:M.lab.lipid.triglyceride.interpretationText="Normal",M.lab.lipid.triglyceride.color="green";break;case M.lab.lipid.triglyceride.value>=150&&M.lab.lipid.triglyceride.value<199:M.lab.lipid.triglyceride.interpretationText="Borderline High",M.lab.lipid.triglyceride.color="orange";break;case M.lab.lipid.triglyceride.value>=200&&M.lab.lipid.triglyceride.value<499:M.lab.lipid.triglyceride.interpretationText="High",M.lab.lipid.triglyceride.color="red";break;case M.lab.lipid.triglyceride.value>=500:M.lab.lipid.triglyceride.interpretationText="Very High",M.lab.lipid.triglyceride.color="purple";break;default:M.lab.lipid.triglyceride.interpretationText="Indeterminate",M.lab.lipid.triglyceride.color="grey"}z()}function x(){switch(!0){case M.lab.lipid.ldlCholesterol.value<100:M.lab.lipid.ldlCholesterol.interpretationText="Optimal",M.lab.lipid.ldlCholesterol.color="green";break;case M.lab.lipid.ldlCholesterol.value>=100&&M.lab.lipid.ldlCholesterol.value<129:M.lab.lipid.ldlCholesterol.interpretationText="Near Optimal",M.lab.lipid.ldlCholesterol.color="blue";break;case M.lab.lipid.ldlCholesterol.value>=130&&M.lab.lipid.ldlCholesterol.value<159:M.lab.lipid.ldlCholesterol.interpretationText="Borderline High",M.lab.lipid.ldlCholesterol.color="orange";break;case M.lab.lipid.ldlCholesterol.value>=160&&M.lab.lipid.ldlCholesterol.value<=189:M.lab.lipid.ldlCholesterol.interpretationText="High",M.lab.lipid.ldlCholesterol.color="red";break;case M.lab.lipid.ldlCholesterol.value>189:M.lab.lipid.ldlCholesterol.interpretationText="Very High",M.lab.lipid.ldlCholesterol.color="purple";break;default:M.lab.lipid.ldlCholesterol.interpretationText="Indeterminate",M.lab.lipid.ldlCholesterol.color="grey"}z()}function y(){switch(!0){case M.lab.lipid.hdlCholesterol.value>=60:M.lab.lipid.hdlCholesterol.interpretationText="Optimal",M.lab.lipid.hdlCholesterol.color="green";break;case M.lab.lipid.hdlCholesterol.value<60&&M.lab.lipid.hdlCholesterol.value>=50:M.lab.lipid.hdlCholesterol.interpretationText="Near Optimal",M.lab.lipid.hdlCholesterol.color="blue";break;case M.lab.lipid.hdlCholesterol.value<50&&M.lab.lipid.hdlCholesterol.value>=40:"male"===M.lab.patient.gender?(M.lab.lipid.hdlCholesterol.interpretationText="Low",M.lab.lipid.hdlCholesterol.color="red"):(M.lab.lipid.hdlCholesterol.interpretationText="Borderline",M.lab.lipid.hdlCholesterol.color="orange");break;case M.lab.lipid.hdlCholesterol.value<40:M.lab.lipid.hdlCholesterol.interpretationText="Low",M.lab.lipid.hdlCholesterol.color="red";break;default:M.lab.lipid.hdlCholesterol.interpretationText="Indeterminate",M.lab.lipid.hdlCholesterol.color="grey"}z()}function z(){if(angular.isDefined(M.lab.lipid.hdlCholesterol.value)&&angular.isDefined(M.lab.lipid.ldlCholesterol.value)&&angular.isDefined(M.lab.lipid.triglyceride.value)){var a=M.lab.lipid.hdlCholesterol.value+M.lab.lipid.ldlCholesterol.value+.2*M.lab.lipid.triglyceride.value;if(M.lab.lipid.cholesterol.value=Math.round(a),M.lab.patient.age<18)switch(!0){case M.lab.lipid.cholesterol.value<170:M.lab.lipid.cholesterol.interpretationText="Optimal",M.lab.lipid.cholesterol.color="green";break;case M.lab.lipid.cholesterol.value>=170&&M.lab.lipid.cholesterol.value<200:M.lab.lipid.cholesterol.interpretationText="Borderline High",M.lab.lipid.cholesterol.color="orange";break;case M.lab.lipid.cholesterol.value>=200:M.lab.lipid.cholesterol.interpretationText="High Risk",M.lab.lipid.cholesterol.color="red";break;default:M.lab.lipid.cholesterol.interpretationText="Indeterminate",M.lab.lipid.cholesterol.color="grey"}else switch(!0){case M.lab.lipid.cholesterol.value<200:M.lab.lipid.cholesterol.interpretationText="Optimal",M.lab.lipid.cholesterol.color="green";break;case M.lab.lipid.cholesterol.value>=200&&M.lab.lipid.cholesterol.value<240:M.lab.lipid.cholesterol.interpretationText="Borderline High",M.lab.lipid.cholesterol.color="orange";break;case M.lab.lipid.cholesterol.value>=240:M.lab.lipid.cholesterol.interpretationText="High Risk",M.lab.lipid.cholesterol.color="red";break;default:M.lab.lipid.cholesterol.interpretationText="Indeterminate",M.lab.lipid.cholesterol.color="grey"}}}function A(a){var b=F();O("Saving HS CRP result to "+M.activeServer.name),m.addObservation(b).then(L,function(a){N(i.unexpectedOutcome(a))}).then(function(){O("HS CRP result saved successfully!"),E(a)})}function B(){switch(!0){case M.lab.crp.value<1:M.lab.crp.interpretationText="Low risk",M.lab.crp.color="green";break;case M.lab.crp.value>=1&&M.lab.crp.value<3:M.lab.crp.interpretationText="Average risk",M.lab.crp.color="orange";break;case M.lab.crp.value>=3&&M.lab.crp.value<10:M.lab.crp.interpretationText="High risk",M.lab.crp.color="red";break;case M.lab.crp.value>=10:M.lab.crp.interpretationText="Abnormally high (retest later)",M.lab.crp.color="purple";break;default:M.lab.crp.interpretationText="Indeterminate",M.lab.crp.color="grey"}}function C(a){function b(a){for(var b=Q.defer(),c=0,d=I(),e=0,f=a.length;f>=e;e++)void 0!==a[e]&&m.addObservation(a[e]).then(L,function(a){N(i.unexpectedOutcome(a)),b.reject(a)}).then(function(e){if(angular.isDefined(e)&&angular.isDefined(d)){var f={type:"has-component"};f.target={reference:"Observation/"+e},d.related.push(f),c+=1}c===a.length&&b.resolve(d)});return b.promise}M.isBusy=!0,O("Saving lipid results to "+M.activeServer.name),a.$invalid=!0;var c=[];c.push(J()),c.push(K()),c.push(G()),c.push(H()),b(c).then(function(){O("Lipid profile results saved successfully!")},function(a){N(i.unexpectedOutcome(a))}).then(function(){M.isBusy=!1,D(a)})}function D(a){M.lab.lipid.hdlCholesterol.value=void 0,M.lab.lipid.ldlCholesterol.value=void 0,M.lab.lipid.triglyceride.value=void 0,M.lab.lipid.cholesterol.value=void 0,y(),x(),w(),a.$setPristine()}function E(a){M.lab.crp.value=void 0,M.lab.crp.interpretationText="Enter new reading",M.lab.crp.color="black",a.$setPristine()}function F(){var a=m.initializeNewObservation();return a.code={coding:[{system:"http://loinc.org",code:"30522-7",display:"CRP SerPl High Sens-mCnc",primary:!0},{system:"http://snomed.info/sct",code:"55235003",display:"C-reactive protein measurement",primary:!1},{system:"http://snomed.info/sct",code:"135842001",display:"Serum C-reactive protein measurement",primary:!1}],text:"High-sensitivity C-Reactive Protein (CRP)"},a.valueQuantity={value:M.lab.crp.value,units:"mg/L",system:"http://snomed.info/sct",code:"258796002"},a.referenceRange=[{low:{value:0},high:{value:.9},meaning:{coding:[{system:"http://snomed.info/sct",code:"394688002",display:"Low risk of primary heart disease"}]}},{low:{value:1},high:{value:2.9},meaning:{coding:[{system:"http://snomed.info/sct",code:"394689005",display:"Moderate risk of primary heart disease"}]}},{low:{value:3},high:{value:9.9},meaning:{coding:[{system:"http://snomed.info/sct",code:"394690001",display:"High risk of primary heart disease"}]}},{low:{value:10},meaning:{coding:[{system:"http://snomed.info/sct",code:"166584001",display:"C-reactive protein abnormal"}]}}],a.status="final",
a.reliability="ok",a.subject={reference:"Patient/"+M.lab.patient.id,display:M.lab.patient.fullName},a.appliesDateTime=M.lab.date.toISOString(),a}function G(){var a=m.initializeNewObservation();return a.code={coding:[{system:"http://loinc.org",code:"2571-8",display:"Trigl SerPl-mCnc",primary:!0}],text:"Triglyceride"},a.valueQuantity={value:M.lab.lipid.triglyceride.value,units:"mg/dL",system:"http://snomed.info/sct",code:"258797006"},a.referenceRange=[{high:{value:200,units:"mg/dL",system:"http://snomed.info/sct",code:"258797006"}}],a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+M.lab.patient.id,display:M.lab.patient.fullName},a.appliesDateTime=M.lab.date.toISOString(),a}function H(){var a=m.initializeNewObservation();return a.code={coding:[{system:"http://loinc.org",code:"2093-3",display:"Cholest SerPl-mCnc",primary:!0}],text:"Total cholesterol"},a.valueQuantity={value:M.lab.lipid.cholesterol.value,units:"mg/dL",system:"http://snomed.info/sct",code:"258797006"},a.referenceRange=[{high:{value:M.lab.patient.age<18?200:240,units:"mg/dL",system:"http://snomed.info/sct",code:"258797006"}}],a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+M.lab.patient.id,display:M.lab.patient.fullName},a.appliesDateTime=M.lab.date.toISOString(),a}function I(){var a=m.initializeNewObservation();return a}function J(){var a=m.initializeNewObservation();return a.code={coding:[{system:"http://loinc.org",code:"2089-1",display:"LDLc SerPl-mCnc",primary:!0}],text:"Cholesterol in LDL"},a.valueQuantity={value:M.lab.lipid.ldlCholesterol.value,units:"mg/dL",system:"http://snomed.info/sct",code:"258797006"},a.referenceRange=[{high:{value:160,units:"mg/dL",system:"http://snomed.info/sct",code:"258797006"}}],a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+M.lab.patient.id,display:M.lab.patient.fullName},a.appliesDateTime=M.lab.date.toISOString(),a}function K(){var a=m.initializeNewObservation();return a.code={coding:[{system:"http://loinc.org",code:"2085-9",display:"HDLc SerPl-mCnc",primary:!0}],text:"Cholesterol in HDL"},a.valueQuantity={value:M.lab.lipid.hdlCholesterol.value,units:"mg/dL",system:"http://snomed.info/sct",code:"258797006"},a.referenceRange=[{low:{value:"male"===M.lab.patient.gender?50:40,units:"mg/dL",system:"http://snomed.info/sct",code:"258797006"}}],a.status="final",a.reliability="ok",a.subject={reference:"Patient/"+M.lab.patient.id,display:M.lab.patient.fullName},a.appliesDateTime=M.lab.date.toISOString(),a}function L(b){var c=Q.defer(),d=b.headers.location||b.headers["content-location"];return angular.isUndefined(d)?(P("Observation saved, but location is unavailable. CORS not implemented correctly at remote host.",null,R),c.resolve(void 0)):(O("Observation recorded at "+d,null,R),c.resolve(a("idFromURL")(d))),c.promise}var M=this,N=i.logger.getLogFn(b,"error"),O=i.logger.getLogFn(b,"info"),P=i.logger.getLogFn(b,"warning"),Q=i.$q,R=!1;M.getPractitionerReference=u,M.updateTriglyceride=w,M.updateLdlCholesterol=x,M.updateHdlCholesterol=y,M.saveCRP=A,M.updateCRP=B,M.saveLipid=C,M.actions=v,M.activeServer=null,M.activate=r,M.observation=null,M.isBusy=!1,M.observation=void 0,M.practitionerSearchText="",M.selectedPractitioner=null,M.smartLaunchUrl="",M.interpretations=[],M.lab={lipid:{cholesterol:{value:void 0,interpretationCode:void 0,color:"black",interpretationText:void 0},hdlCholesterol:{value:void 0,interpretationCode:void 0,color:"black",interpretationText:void 0},ldlCholesterol:{value:void 0,interpretationCode:void 0,color:"black",interpretationText:void 0},triglyceride:{value:void 0,interpretationCode:void 0,color:"black",interpretationText:void 0}},crp:{value:void 0,color:"black",interpretationText:void 0}},M.lab.patient=void 0,M.smartLaunchUrl="",r()}var b="labDetail";angular.module("FHIRCloud").controller(b,["$filter","$location","$mdBottomSheet","$mdDialog","$routeParams","$scope","$window","common","fhirServers","localValueSets","identifierService","observationService","observationValueSets","practitionerService","careProviderService","patientService",a])}(),function(){"use strict";function a(){function a(){return{system:"http://hl7.org/fhir/v2/0078",caseSensitive:!0,concept:[{code:"<",display:"Below absolute low-off instrument scale"},{code:">",display:"Above absolute high-off instrument scale"},{code:"A",display:"Abnormal (applies to non-numeric results)"},{code:"AA",display:"Very abnormal (applies to non-numeric units, analogous to panic limits for numeric units)"},{code:"B",display:"Better-use when direction not relevant"},{code:"D",display:"Significant change down"},{code:"H",display:"Above high normal"},{code:"HH",display:"Above upper panic limits"},{code:"L",display:"Below low normal"},{code:"LL",display:"Below lower panic limits"},{code:"N",display:"Normal"},{code:"NEG",display:"Negative"},{code:"POS",display:"Positive"},{code:"U",display:"Significant change up"},{code:"null",display:"No range defined, or normal ranges don't apply"}]}}function b(){return{system:"http://snomed.info/sct",caseSensitive:!0,concept:[{code:"310252000",display:"Low BMI"},{code:"412768003",display:"Normal BMI"},{code:"162863004",display:"Overweight"},{code:"162864005",display:"Obesity"},{code:"162864005",display:"Severe obesity"}]}}function c(){return{system:"http://snomed.info/sct",caseSensitive:!0,concept:[{code:"164301009",display:"O/E - temperature low"},{code:"164300005",display:"O/E - temperature normal"},{code:"164303007",display:"O/E - temperature elevated"},{code:"271897009",display:"O/E - temperature fever"},{code:"164288004",display:"O/E - pyrexia of unknown origin"},{code:"274307008",display:"O/E - hypothermia"},{code:"274308003",display:"O/E - hyperpyrexia"}]}}function d(){return{system:"http://snomed.info/sct",caseSensitive:!0,concept:[{code:"164292006",display:"O/E - axillary temperature",$$label:"Axillary"},{code:"275874003",display:"O/E - oral temperature",$$label:"Oral"},{code:"164294007",display:"O/E - rectal temperature",$$label:"Rectal"},{code:"164296009",display:"O/E - skin strip temperature",$$label:"By skin"},{code:"315632006",display:"O/E - tympanic temperature",$$label:"By ear"}]}}function e(){return{system:"http://hl7.org/fhir/v2/0078",caseSensitive:!0,concept:[{code:"<",display:"Below absolute low-off instrument scale"},{code:">",display:"Above absolute high-off instrument scale"},{code:"A",display:"Abnormal (applies to non-numeric results)"},{code:"AA",display:"Very abnormal (applies to non-numeric units, analogous to panic limits for numeric units)"},{code:"AC",display:"Anti-complementary substances present"},{code:"B",display:"Better-use when direction not relevant"},{code:"D",display:"Significant change down"},{code:"DET",display:"Detected"},{code:"H",display:"Above high normal"},{code:"HH",display:"Above upper panic limits"},{code:"I",display:"Intermediate. Indicates for microbiology susceptibilities only."},{code:"IND",display:"Indeterminate"},{code:"L",display:"Below low normal"},{code:"LL",display:"Below lower panic limits"},{code:"MS",display:"Moderately susceptible. Indicates for microbiology susceptibilities only."},{code:"N",display:"Normal (applies to non-numeric results)"},{code:"ND",display:"Not Detected"},{code:"NEG",display:"Negative"},{code:"NR",display:"Non-reactive"},{code:"POS",display:"Positive"},{code:"QCF",display:"Quality Control Failure"},{code:"R",display:"Resistant. Indicates for microbiology susceptibilities only."},{code:"RR",display:"Reactive"},{code:"S",display:"Susceptible. Indicates for microbiology susceptibilities only."},{code:"TOX",display:"Cytotoxic substance present"},{code:"U",display:"Significant change up"},{code:"VS",display:"Very susceptible. Indicates for microbiology susceptibilities only."},{code:"W",display:"Worse-use when direction not relevant"},{code:"WR",display:"Weakly reactive"},{code:"null",display:"No range defined, or normal ranges don't apply"}]}}function f(){return{system:"http://hl7.org/fhir/observation-reliability",caseSensitive:!0,concept:[{code:"ok",display:"Ok",definition:"The result has no reliability concerns."},{code:"ongoing",display:"Ongoing",definition:"An early estimate of value; measurement is still occurring."},{code:"early",display:"Early",definition:"An early estimate of value; processing is still occurring."},{code:"questionable",display:"Questionable",definition:"The observation value should be treated with care."},{code:"calibrating",display:"Calibrating",definition:"The result has been generated while calibration is occurring."},{code:"error",display:"Error",definition:"The observation could not be completed because of an error."},{code:"unknown",display:"Unknown",definition:"No observation  reliability value was available."}]}}function g(){return{system:"http://snomed.info/sct",concept:[{code:"449868002",display:"Smokes tobacco daily"},{code:"428041000124106",display:"Occasional tobacco smoker"},{code:"8517006",display:"Ex-smoker"},{code:"266919005",display:"Never smoked tobacco"},{code:"77176002",display:"Smoker, current status unknown"},{code:"266927001",display:"Unknown if ever smoked"},{code:"428071000124103",display:"Heavy tobacco smoker"},{code:"428061000124105",display:"Light tobacco smoker"}]}}function h(){return{system:"http://hl7.org/fhir/observation-status",caseSensitive:!0,concept:[{code:"registered",display:"Registered",definition:"The existence of the observation is registered, but there is no result yet available."},{code:"preliminary",display:"Preliminary",definition:"This is an initial or interim observation: data may be incomplete or unverified."},{code:"final",display:"Final",definition:"The observation is complete and verified by an authorized person."},{code:"amended",display:"Amended",definition:"The observation has been modified subsequent to being Final, and is complete and verified by an authorized person."},{code:"cancelled",display:"Cancelled",definition:'The observation is unavailable because the measurement was not started or not completed (also sometimes called "aborted").'},{code:"entered-in-error",display:"Entered In Error",definition:"The observation has been withdrawn following previous Final release."},{code:"unknown",display:"Unknown",definition:'The observation status is unknown.  Note that "unknown" is a value of last resort and every attempt should be made to provide a meaningful value other than "unknown".'}]}}var i={bmiRange:b,bodyTempFindings:c,bodyTempMethods:d,bpInterpretation:a,interpretation:e,reliability:f,smokingStatus:g,status:h};return i}var b="observationValueSets";angular.module("FHIRCloud").factory(b,[a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i){function j(){}function k(){return!u.isEditing}function l(){return!u.isSaving}function m(b){function c(){b&&b.resourceId&&b.hashKey&&i.deleteCachedOperationDefinition(b.hashKey,b.resourceId).then(function(){w("Deleted operationDefinition "+b.name),a.path("/operationDefinitions")},function(a){v(f.unexpectedOutcome(a))})}var d=e.confirm().title("Delete "+b.name+"?").ok("Yes").cancel("No");e.show(d).then(c)}function n(b){b&&b.hashKey&&a.path("/operationDefinition/edit/"+b.hashKey)}function o(){h.getActiveServer().then(function(a){return u.activeServer=a,u.activeServer})}function p(){function a(a){var b=angular.copy(a.resource);u.narrative=b.text.div||"<div>Not provided</div>",u.json=b,u.json.text={div:"see narrative tab"},u.json=angular.toJson(b,!0),u.operationDefinition=b,g.init(u.operationDefinition.telecom,!1,!1)}if("new"===c.hashKey){var b=i.initializeNewOperationDefinition();a(b),u.title="Add New OperationDefinition",u.isEditing=!1}else if(c.hashKey)i.getCachedOperationDefinition(c.hashKey).then(a).then(function(){},function(a){v(a)});else if(c.id){var d=u.activeServer.baseUrl+"/OperationDefinition/"+c.id;i.getOperationDefinition(d).then(a,function(a){v(a)})}}function q(){d.history.back()}function r(a){var b=a.headers.location||a.headers["content-location"];angular.isUndefined(b)?x("OperationDefinition saved, but location is unavailable. CORS not implemented correctly at remote host."):(u.operationDefinition.resourceId=f.setResourceId(u.operationDefinition.resourceId,b),w("OperationDefinition saved at "+b)),u.isEditing=!0}function s(){if(u.operationDefinition.name.length<5)return void v("OperationDefinition Name must be at least 5 characters");var a=i.initializeNewOperationDefinition().resource;a.name=u.operationDefinition.name,a.id=u.operationDefinition.id,a.text=u.operationDefinition.text,a.title=u.operationDefinition.title,a.telecom=g.mapFromViewModel(),a.status=u.operationDefinition.status,a.kind=u.operationDefinition.kind,a.instance=u.operationDefinition.instance,a.parameter=[],u.isEditing?i.updateOperationDefinition(u.operationDefinition.resourceId,a).then(r,function(a){v(f.unexpectedOutcome(a))}):i.addOperationDefinition(a).then(r,function(a){v(f.unexpectedOutcome(a))})}function t(){f.activateController([o()],b).then(function(){p()})}var u=this,v=f.logger.getLogFn(b,"error"),w=f.logger.getLogFn(b,"success"),x=f.logger.getLogFn(b,"warning");Object.defineProperty(u,"canSave",{get:l}),Object.defineProperty(u,"canDelete",{get:k}),u.activeServer=null,u.cancel=j,u.activate=t,u["delete"]=m,u.edit=n,u.goBack=q,u.isSaving=!1,u.isEditing=!0,u.operationDefinition=void 0,u.operationDefinitionTypes=void 0,u.save=s,u.states=void 0,u.title="operationDefinitionDetail",t()}var b="operationDefinitionDetail";angular.module("FHIRCloud").controller(b,["$location","$routeParams","$window","$mdDialog","common","contactPointService","fhirServers","operationDefinitionService",a])}(),function(){"use strict";function a(a,c,d,e,f,g){function h(){f.getActiveServer().then(function(a){return v.activeServer=a,v.activeServer})}function i(){g.getCachedSearchResults().then(l)}function j(){d.activateController([h(),i()],b).then(function(){c("right").close()})}function k(b){b&&a.path("/operationDefinition/view/"+b)}function l(a){a&&(v.operationDefinitions=a.entry||[],v.paging.links=a.link||[],v.paging.totalResults=a.total||0)}function m(a){a&&(q(!0),g.getOperationDefinitions(v.activeServer.baseUrl,v.searchText).then(function(a){return t("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" OperationDefinitions from "+v.activeServer.name),a},function(a){q(!1),u(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(l).then(function(){q(!1)}))}function n(a){q(!0),g.getOperationDefinitionsByLink(a).then(function(a){return t("Returned "+(angular.isArray(a.operationDefinitions)?a.operationDefinitions.length:0)+" OperationDefinitions from "+v.activeServer.name),a},function(a){q(!1),u(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(l).then(function(){q(!1)})}function o(a){a.keyCode===r.esc&&(v.searchText="")}function p(a){a.preventDefault(),c("right").toggle()}function q(a){v.isBusy=a}var r=e.keyCodes,s=d.logger.getLogFn,t=s(b,"info"),u=s(b,"error"),v=this;v.activeServer=null,v.isBusy=!1,v.operationDefinitions=[],v.errorOutcome=null,v.paging={currentPage:1,totalResults:0,links:null},v.searchResults=null,v.searchText="",v.title="OperationDefinitions",v.keyPress=o,v.dereferenceLink=n,v.submit=m,v.goToDetail=k,v.toggleSideNav=p,j()}var b="operationDefinitionSearch";angular.module("FHIRCloud").controller(b,["$location","$mdSidenav","common","config","fhirServers","operationDefinitionService",a])}(),function(){"use strict";function a(a,c,d,e){function f(a){r(a).then(function(a){a.type.coding=s(a.type.coding)});var b=w.defer();return e.getActiveServer().then(function(c){var e=c.baseUrl+"/OperationDefinition";d.addResource(e,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function g(){c.addToCache(t,null)}function h(a,b){function d(b){for(var d=!1,f=b.entry,g=0,h=f.length;h>g;g++)if(f[g].$$hashKey===a){f.splice(g,1),b.entry=f,b.totalResults=b.totalResults-1,c.addToCache(t,b),d=!0;break}d?e.resolve():(v("OperationDefinition not found in cache: "+a),e.resolve())}var e=w.defer();return i(b).then(j,function(a){e.reject(a)}).then(d).then(function(){e.resolve()}),e.promise}function i(a){var b=w.defer();return d.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function j(){var a=w.defer(),b=c.readFromCache(t);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function k(a){function b(b){var d,e=b.entry;d=_.find(e,{$$hashKey:a}),d?c.resolve(d):c.reject("OperationDefinition not found in cache: "+a)}var c=w.defer();return j().then(b,function(){c.reject("OperationDefinition search results not found in cache.")}),c.promise}function l(a){var b=w.defer();return d.getResource(a).then(function(a){c.addToCache(t,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function m(a,b){var c=w.defer();return d.getResource(a+"/OperationDefinition?name="+b+"&_count=20").then(function(a){var b=[];a.data.entry&&angular.forEach(a.data.entry,function(a){b.push({display:a.resource.name,reference:a.resource.id})}),0===b.length&&b.push({display:"No matches",reference:""}),c.resolve(b)},function(a){c.reject(a)}),c.promise}function n(a,b){var e=w.defer();return d.getResource(a+"/OperationDefinition?name="+b+"&_count=20").then(function(a){c.addToCache(t,a.data),e.resolve(a.data)},function(a){e.reject(a)}),e.promise}function o(a){var b=w.defer();return d.getResource(a).then(function(a){var c={links:{},operationDefinitions:[]},d=[];a.data.entry&&angular.forEach(a.data.entry,function(a){a.content&&"OperationDefinition"===a.content.resourceType&&d.push({display:a.content.name,reference:a.id})}),0===d.length&&d.push({display:"No matches",reference:""}),c.operationDefinitions=d,a.data.link&&(c.links=a.data.link),c.totalResults=a.data.totalResults?a.data.totalResults:0,b.resolve(c)},function(a){b.reject(a)}),b.promise}function p(){var a={};return a.resource={resourceType:"OperationDefinition",identifier:[],type:{coding:[]},telecom:[],contact:[],address:[],partOf:null,location:[],active:!0},a}function q(a,b){r(b).then(function(a){a.type.coding=s(a.type.coding)});var c=w.defer();return d.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function r(a){return 0===a.address.length&&(a.address=null),0===a.identifier.length&&(a.identifier=null),0===a.contact.length&&(a.contact=null),0===a.telecom.length&&(a.telecom=null),0===a.location.length&&(a.location=null),w.when(a)}function s(a){var b=null;if(angular.isArray(a)&&angular.isDefined(a[0]))if(angular.isObject(a[0]))b=a;else{var c=JSON.parse(a[0]);b=[],b.push(c?c:null)}return b}var t="localOperationDefinitions",u=a.logger.getLogFn,v=u(b,"warning"),w=a.$q,x={addOperationDefinition:f,clearCache:g,deleteCachedOperationDefinition:h,deleteOperationDefinition:i,getCachedOperationDefinition:k,getCachedSearchResults:j,getOperationDefinition:l,getOperationDefinitions:n,getOperationDefinitionsByLink:o,getOperationDefinitionReference:m,initializeNewOperationDefinition:p,updateOperationDefinition:q};return x}var b="operationDefinitionService";angular.module("FHIRCloud").factory(b,["common","dataCache","fhirClient","fhirServers",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(){}function u(){return!K.isEditing}function v(){return!K.isSaving}function w(a){function b(){a&&a.resourceId&&o.deleteCachedOrganization(a.hashKey,a.resourceId).then(function(){M("Deleted organization "+a.name),c.path("/organization")},function(a){L(j.unexpectedOutcome(a))})}if(angular.isDefined(a)&&a.resourceId){var d=i.confirm().title("Delete "+a.name+"?").ok("Yes").cancel("No");i.show(d).then(b)}else N("You must first select an organization to delete.")}function x(a){a&&a.hashKey&&c.path("/organization/edit/"+a.hashKey)}function y(){l.getActiveServer().then(function(a){return K.activeServer=a,K.activeServer})}function z(a){var b=O.defer();return o.getOrganizationReference(K.activeServer.baseUrl,a).then(function(a){N("Returned "+(angular.isArray(a)?a.length:0)+" Organizations from "+K.activeServer.name,null,P),b.resolve(a||[])},function(a){L("Error getting organizations",a,P),b.reject()}),b.promise}function A(){K.organizationTypes=n.organizationType()}function B(){function b(a){K.organization=a.resource||a,angular.isUndefined(K.organization.type)&&(K.organization.type={coding:[]}),K.organization.resourceId=K.activeServer.baseUrl+"/Organization/"+K.organization.id,K.title=K.organization.name,m.init(K.organization.identifier,"multi","organization"),h.init(K.organization.address,!1),k.init(K.organization.contact),p.init(K.organization.telecom,!1,!1),"new"!==K.lookupKey&&(g.localStorage.organization=JSON.stringify(K.organization))}if(K.lookupKey=e.hashKey,"current"===K.lookupKey)angular.isUndefined(g.localStorage.organization)||null===g.localStorage.organization?angular.isUndefined(e.id)&&c.path("/organization"):(K.organization=JSON.parse(g.localStorage.organization),K.organization.hashKey="current",b(K.organization));else if("new"===K.lookupKey){var d=o.initializeNewOrganization();b(d),K.title="Add New Organization",K.isEditing=!1}else if(angular.isDefined(e.resourceId)){var f=K.activeServer.baseUrl+"/Organization/"+e.resourceId;N("Fetching "+f,null,P),o.getOrganization(f).then(b).then(function(){var a=q.getSession();a.organization=K.organization,q.updateSession(a)},function(b){L(a("unexpectedOutcome")(b))})}else if(K.lookupKey)o.getCachedOrganization(K.lookupKey).then(b).then(function(){var a=q.getSession();a.organization=K.organization,q.updateSession(a)},function(b){L(a("unexpectedOutcome")(b))});else if(e.id){var i=K.activeServer.baseUrl+"/Organization/"+e.id;o.getOrganization(i).then(b,function(b){L(a("unexpectedOutcome")(b))})}}function C(){var a="";return a=K.organization?K.title="Edit "+(K.organization&&K.organization.fullName||""):K.title="Add New Organization",K.title=a,K.title}function D(){g.history.back()}function E(a){var b=a.headers.location||a.headers["content-location"];angular.isUndefined(b)?N("Organization saved, but location is unavailable. CORS is not implemented correctly at "+K.activeServer.name):(N("Organization saved at "+b),K.organization.resourceVersionId=b,K.organization.resourceId=j.setResourceId(K.organization.resourceId,b)),K.isEditing=!0,C()}function F(){if(K.organization.name.length<5)return void L("Organization Name must be at least 5 characters");var b=o.initializeNewOrganization().resource;b.name=K.organization.name,b.type=K.organization.type,b.address=h.mapFromViewModel(),b.telecom=p.mapFromViewModel(),b.contact=k.mapFromViewModel(),b.partOf=K.organization.partOf,b.identifier=m.getAll(),b.active=K.organization.active,K.isEditing?(b.id=K.organization.id,o.updateOrganization(K.organization.resourceId,b).then(E,function(b){L(a("unexpectedOutcome")(b))})):o.addOrganization(b).then(E,function(b){L(a("unexpectedOutcome")(b))})}function G(){j.activateController([y(),A()],b).then(function(){B()})}function H(b){K.organization.resourceId=K.activeServer.baseUrl+"/Organization/"+K.organization.id,M("Creating random patients for "+K.organization.name),r.seedRandomPatients(K.organization.id,K.organization.name).then(function(a){M(a,null,P)},function(b){L(a("unexpectedOutcome")(b))})}function I(b){K.organization.resourceId=K.activeServer.baseUrl+"/Organization/"+K.organization.id,M("Creating random patients for "+K.organization.resourceId),s.seedRandomPersons(K.organization.resourceId,K.organization.name).then(function(a){M(a,null,P)},function(b){L(a("unexpectedOutcome")(b))})}function J(a){function b(a){K.isEditing?this.items=[{name:"Add random patients",icon:"groupAdd",index:0},{name:"Get patients",icon:"group",index:1},{name:"Quick find",icon:"hospital",index:3},{name:"Edit organization",icon:"edit",index:4},{name:"Add new organization",icon:"add",index:5}]:this.items=[{name:"Detailed search",icon:"search",index:2},{name:"Quick find",icon:"hospital",index:3}],this.title="Organization search options",this.performAction=function(b){a.hide(b)}}d.show({parent:angular.element(document.getElementById("content")),templateUrl:"./templates/resourceSheet.html",controller:["$mdBottomSheet",b],controllerAs:"vm",bindToController:!0,targetEvent:a}).then(function(a){switch(a.index){case 0:H();break;case 1:c.path("/patient/org/"+K.organization.id);break;case 2:c.path("/organization/detailed-search");break;case 3:c.path("/organization");break;case 4:c.path("/organization/edit/current");break;case 5:c.path("/organization/edit/new");break;case 6:w(K.organization)}})}var K=this,L=j.logger.getLogFn(b,"error"),M=j.logger.getLogFn(b,"success"),N=j.logger.getLogFn(b,"info"),O=j.$q,P=!1;f.$on("server.changed",function(a,b){K.activeServer=b.activeServer,N("Remote server changed to "+K.activeServer.name)}),Object.defineProperty(K,"canSave",{get:v}),Object.defineProperty(K,"canDelete",{get:u}),K.actions=J,K.activeServer=null,K.cancel=t,K.activate=G,K.contactTypes=void 0,K["delete"]=w,K.edit=x,K.getOrganizationReference=z,K.getTitle=C,K.goBack=D,K.isBusy=!1,K.isSaving=!1,K.isEditing=!0,K.loadingOrganizations=!1,K.organization=void 0,K.organizationTypes=void 0,K.save=F,K.searchText=void 0,K.states=void 0,K.title="organizationDetail",K.createRandomPatients=H,K.createRandomPersons=I,G()}var b="organizationDetail";angular.module("FHIRCloud").controller(b,["$filter","$location","$mdBottomSheet","$routeParams","$scope","$window","addressService","$mdDialog","common","contactService","fhirServers","identifierService","localValueSets","organizationService","contactPointService","sessionService","patientService","personService",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i){function j(){g.getActiveServer().then(function(a){return B.activeServer=a,B.activeServer})}function k(){i.getCachedSearchResults().then(n)}function l(){f.activateController([j(),k()],b).then(function(){t()})}function m(b){b&&a.path("/organization/view/"+b)}function n(a){a&&(B.organizations=a.entry||[],B.paging.links=a.link||[],B.paging.totalResults=a.total||0)}function o(a){var b=A.defer();return i.getOrganizations(B.activeServer.baseUrl,a).then(function(a){x("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" Organizations from "+B.activeServer.name,null,z),b.resolve(a.entry||[])},function(a){y("Error getting organizations",a,z),b.reject()}),b.promise}function p(a){var b=A.defer();return B.isBusy=!0,i.searchOrganizations(B.activeServer.baseUrl,a).then(function(a){x("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" Organizations from "+B.activeServer.name,null,z),n(a),B.isBusy=!1,B.selectedTab=1},function(a){B.isBusy=!1,y("Error finding organizations: ",a),b.reject()}).then(b.resolve()),b.promise}function q(a){i.getOrganizationsByLink(a).then(function(a){return x("Returned "+(angular.isArray(a.organizations)?a.organizations.length:0)+" Organizations from "+B.activeServer.name,null,z),a},function(a){y(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(n).then(function(){})}function r(a){var b=A.defer();return i.getOrganizationReference(B.activeServer.baseUrl,a).then(function(a){x("Returned "+(angular.isArray(a)?a.length:0)+" Organizations from "+B.activeServer.name,null,z),b.resolve(a||[])},function(a){y("Error getting organizations",a,z),b.reject()}),b.promise}function s(b){b&&b.$$hashKey&&a.path("/organization/view/"+b.$$hashKey)}function t(){B.organizationTypes=h.organizationType()}function u(b){function d(a){this.items=[{name:"Add new organization",icon:"add",index:0},{name:"Detailed search",icon:"search",index:1},{name:"Quick find",icon:"hospital",index:2}],this.title="Organization search options",this.performAction=function(b){a.hide(b)}}c.show({parent:angular.element(document.getElementById("content")),templateUrl:"./templates/resourceSheet.html",controller:["$mdBottomSheet",d],controllerAs:"vm",bindToController:!0,targetEvent:b}).then(function(b){switch(b.index){case 0:a.path("/organization/edit/new");break;case 1:a.path("/organization/detailed-search");break;case 2:a.path("/organization")}})}function v(){var a="",b={param:"",value:""},c=[];B.organizationSearch.name&&(b.param="name",b.value=B.organizationSearch.name,c.push(_.clone(b))),B.organizationSearch.address.street&&(b.param="addressLine",b.value=B.organizationSearch.address.street,c.push(_.clone(b))),B.organizationSearch.address.city&&(b.param="city",b.value=B.organizationSearch.address.city,c.push(_.clone(b))),B.organizationSearch.address.state&&(b.param="state",b.value=B.organizationSearch.address.state,c.push(_.clone(b))),B.organizationSearch.address.postalCode&&(b.param="postalCode",b.value=B.organizationSearch.address.postalCode,c.push(_.clone(b))),B.organizationSearch.identifier.system&&B.organizationSearch.identifier.value&&(b.param="identifier",b.value=B.organizationSearch.identifier.system.concat("|",B.organizationSearch.identifier.value),c.push(_.clone(b))),B.organizationSearch.type&&(b.param="type",b.value=B.organizationSearch.type,c.push(_.clone(b))),B.organizationSearch.partOf&&(b.param="partOf",b.value=B.organizationSearch.partOf.reference,c.push(_.clone(b))),_.forEach(c,function(b){a=a.concat(b.param,"=",encodeURIComponent(b.value),"&")}),a=_.trimRight(a,"&"),p(a)}var w=f.logger.getLogFn,x=w(b,"info"),y=w(b,"error"),z=!1,A=f.$q,B=this;B.goToDetail=m,B.querySearch=o,B.dereferenceLink=q,B.getOrganizationReference=r,B.goToOrganization=s,B.actions=u,B.detailSearch=v,B.activeServer=null,B.isBusy=!1,B.organizations=[],B.errorOutcome=null,B.organizationTypes=null,B.organizationSearch={name:void 0,address:{street:void 0,city:void 0,state:void 0,postalCode:void 0},identifier:{system:void 0,value:void 0},type:void 0,partOf:void 0},B.paging={currentPage:1,totalResults:0,links:null},B.searchResults=null,B.searchText="",B.title="Organizations",l()}var b="organizationSearch";angular.module("FHIRCloud").controller(b,["$location","$mdBottomSheet","$mdSidenav","$scope","common","fhirServers","localValueSets","organizationService",a])}(),function(){"use strict";function a(a,c,d,e){function f(a){s(a).then(function(a){a.type.coding=t(a.type.coding)});var b=x.defer();return e.getActiveServer().then(function(c){var e=c.baseUrl+"/Organization";d.addResource(e,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function g(){c.addToCache(u,null)}function h(a,b){function d(b){for(var d=!1,f=b.entry,g=0,h=f.length;h>g;g++)if(f[g].$$hashKey===a){f.splice(g,1),b.entry=f,b.totalResults=b.totalResults-1,c.addToCache(u,b),d=!0;break}d?e.resolve():(w("Organization not found in cache: "+a,null,y),e.resolve())}var e=x.defer();return i(b).then(j,function(a){e.reject(a)}).then(d).then(function(){e.resolve()}),e.promise}function i(a){var b=x.defer();return d.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function j(){var a=x.defer(),b=c.readFromCache(u);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function k(a){function b(b){var d,e=b.entry;d=_.find(e,{$$hashKey:a}),d?c.resolve(d):c.reject("Organization not found in cache: "+a)}var c=x.defer();return j().then(b,function(){c.reject("Organization search results not found in cache.")}),c.promise}function l(a){var b=x.defer();return d.getResource(a).then(function(a){c.addToCache(u,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function m(a,b){var c=x.defer();return d.getResource(a+"/Organization?name="+b+"&_count=10").then(function(b){var d=[];if(b.data.entry)for(var e=0,f=b.data.entry.length;f>e;e++){var g=b.data.entry[e];if(g.resource&&"Organization"===g.resource.resourceType&&d.push({display:g.resource.name,reference:a+"/Organization/"+g.resource.id}),10===e)break}0===d.length&&d.push({display:"No matches",reference:""}),c.resolve(d)},function(a){c.reject(a)}),c.promise}function n(a,b){var e=x.defer();return d.getResource(a+"/Organization?name="+b+"&_count=20").then(function(a){c.addToCache(u,a.data),e.resolve(a.data)},function(a){e.reject(a)}),e.promise}function o(a,b){var e=x.defer();return angular.isUndefined(b)&&e.reject("Invalid search input"),d.getResource(a+"/Organization?"+b+"&_count=20").then(function(a){c.addToCache(u,a.data),
e.resolve(a.data)},function(a){e.reject(a)}),e.promise}function p(a){var b=x.defer();return d.getResource(a).then(function(a){var c={links:{},organizations:[]},d=[];a.data.entry&&angular.forEach(a.data.entry,function(a){a.content&&"Organization"===a.content.resourceType&&d.push({display:a.content.name,reference:a.id})}),0===d.length&&d.push({display:"No matches",reference:""}),c.organizations=d,a.data.link&&(c.links=a.data.link),c.totalResults=a.data.totalResults?a.data.totalResults:0,b.resolve(c)},function(a){b.reject(a)}),b.promise}function q(){var a={};return a.resource={resourceType:"Organization",identifier:[],type:{coding:[]},telecom:[],contact:[],address:[],partOf:null,location:[],active:!0},a}function r(a,b){s(b).then(function(a){a.type.coding=t(a.type.coding)});var c=x.defer();return d.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function s(a){return 0===a.address.length&&(a.address=null),0===a.identifier.length&&(a.identifier=null),0===a.contact.length&&(a.contact=null),0===a.telecom.length&&(a.telecom=null),0===a.location.length&&(a.location=null),x.when(a)}function t(a){var b=null;if(angular.isArray(a)&&angular.isDefined(a[0]))if(angular.isObject(a[0]))b=a;else{var c=JSON.parse(a[0]);b=[],b.push(c?c:null)}return b}var u="localOrganizations",v=a.logger.getLogFn,w=v(b,"warning"),x=a.$q,y=!1,z={addOrganization:f,clearCache:g,deleteCachedOrganization:h,deleteOrganization:i,getCachedOrganization:k,getCachedSearchResults:j,getOrganization:l,getOrganizations:n,getOrganizationsByLink:p,getOrganizationReference:m,initializeNewOrganization:q,searchOrganizations:o,updateOrganization:r};return z}var b="organizationService";angular.module("FHIRCloud").factory(b,["common","dataCache","fhirClient","fhirServers",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(){k.activateController([A()],b).then(function(){E()})}function y(a,b){function d(){a&&a.resourceId&&a.hashKey&&q.deleteCachedPatient(a.hashKey,a.resourceId).then(function(){O("Deleted patient "+a.fullName),c.path("/patient")},function(a){N(k.unexpectedOutcome(a))})}var f=e.confirm().title("Delete "+a.fullName+"?").ariaLabel("delete patient").ok("Yes").cancel("No").targetEvent(b);e.show(f).then(d,function(){O("You decided to keep "+a.fullName)})}function z(a){a&&a.hashKey&&c.path("/patient/"+a.hashKey)}function A(){m.getActiveServer().then(function(a){M.activeServer=a})}function B(a){var b=Q.defer();return p.getOrganizationReference(M.activeServer.baseUrl,a).then(function(a){b.resolve(a)},function(a){N(k.unexpectedOutcome(a),null,R),b.reject()}),b.promise}function C(){q.getPatientEverything(M.patient.resourceId).then(function(a){M.summary=a.summary,M.history=a.history,O("Retrieved everything for patient at "+M.patient.resourceId,null,R)},function(a){N(k.unexpectedOutcome(a),null,R),D()})}function D(){v.getObservations(M.activeServer.baseUrl,null,M.patient.id).then(function(a){M.summary=a.entry,O("Retrieved observations for patient "+M.patient.fullName,null,R)},function(a){M.isBusy=!1,N(k.unexpectedOutcome(a),null,R)})}function E(){function a(a){if(M.patient=a,n.init(M.patient.name),l.init(M.patient.gender,M.patient.maritalStatus,M.patient.communication),l.initBirth(M.patient.multipleBirthBoolean,M.patient.multipleBirthInteger),l.initDeath(M.patient.deceasedBoolean,M.patient.deceasedDateTime),l.setBirthDate(M.patient.birthDate),l.initializeKnownExtensions(M.patient.extension),M.patient.race=l.getRace(),M.patient.religion=l.getReligion(),M.patient.ethnicity=l.getEthnicity(),M.patient.mothersMaidenName=l.getMothersMaidenName(),M.patient.birthPlace=l.getBirthPlace(),j.init(M.patient.photo,"Photos"),o.init(M.patient.identifier,"multi","patient"),i.init(M.patient.address,!0),r.init(M.patient.telecom,!0,!0),u.init(M.patient.careProvider),M.patient.communication&&t.init(M.patient.communication,"multi"),M.patient.fullName=n.getFullName(),angular.isDefined(M.patient.id)&&(M.patient.resourceId=M.activeServer.baseUrl+"/Patient/"+M.patient.id),M.patient.managingOrganization&&M.patient.managingOrganization.reference){var b=M.patient.managingOrganization.reference;k.isAbsoluteUri(b)===!1&&(M.patient.managingOrganization.reference=M.activeServer.baseUrl+"/"+b),angular.isUndefined(M.patient.managingOrganization.display)&&(M.patient.managingOrganization.display=b)}"new"!==M.lookupKey&&(h.localStorage.patient=JSON.stringify(M.patient))}if(M.patient=void 0,M.lookupKey=f.hashKey,"current"===M.lookupKey)angular.isUndefined(h.localStorage.patient)||null===h.localStorage.patient?angular.isUndefined(f.id)&&c.path("/patient"):(M.patient=JSON.parse(h.localStorage.patient),M.patient.hashKey="current",a(M.patient));else if(angular.isDefined(f.id)){M.isBusy=!0;var b=M.activeServer.baseUrl+"/Patient/"+f.id;q.getPatient(b).then(function(c){a(c.data),M.patient&&C(b)},function(a){N(k.unexpectedOutcome(a))}).then(function(){M.isBusy=!1})}else if("new"===M.lookupKey){var d=q.initializeNewPatient();a(d),M.title="Add New Patient",M.isEditing=!1}else"current"!==M.lookupKey?(M.isBusy=!0,q.getCachedPatient(M.lookupKey).then(function(b){a(b),M.patient&&M.patient.resourceId&&C(M.patient.resourceId)},function(a){N(k.unexpectedOutcome(a))}).then(function(){M.isBusy=!1})):N("Unable to resolve patient lookup")}function F(){function b(a){var b=a.headers.location||a.headers["content-location"];angular.isUndefined(b)?P("Patient saved, but location is unavailable. CORS not implemented correctly at remote host."):(O("Patient saved at "+b),M.patient.resourceVersionId=b,M.patient.resourceId=k.setResourceId(M.patient.resourceId,b)),M.patient.fullName=n.getFullName(),M.isEditing=!0,h.localStorage.patient=JSON.stringify(M.patient),M.isBusy=!1}var c=q.initializeNewPatient();return 0===n.getAll().length?void N("Patient must have at least one name."):(c.name=n.mapFromViewModel(),c.photo=j.getAll(),c.birthDate=a("dateString")(l.getBirthDate()),c.gender=l.getGender(),c.maritalStatus=l.getMaritalStatus(),c.multipleBirthBoolean=l.getMultipleBirth(),c.multipleBirthInteger=l.getBirthOrder(),c.deceasedBoolean=l.getDeceased(),c.deceasedDateTime=l.getDeceasedDate(),c.race=l.getRace(),c.religion=l.getReligion(),c.ethnicity=l.getEthnicity(),c.mothersMaidenName=l.getMothersMaidenName(),c.birthPlace=l.getBirthPlace(),c.address=i.mapFromViewModel(),c.telecom=r.mapFromViewModel(),c.identifier=o.getAll(),c.managingOrganization=M.patient.managingOrganization,c.communication=t.getAll(),c.careProvider=u.getAll(),c.active=M.patient.active,M.isBusy=!0,void(M.isEditing?(c.id=M.patient.id,q.updatePatient(M.patient.resourceId,c).then(b,function(a){N(k.unexpectedOutcome(a)),M.isBusy=!1})):q.addPatient(c).then(b,function(a){N(k.unexpectedOutcome(a)),M.isBusy=!1})))}function G(a,b){I(M.history[a],b)}function H(a,b){I(M.summary[a],b)}function I(a,b){e.show({optionsOrPresent:{disableParentScroll:!1},templateUrl:"templates/rawData-dialog.html",controller:"rawDataController",locals:{data:a},targetEvent:b})}function J(){return!M.isEditing}function K(){return!M.isSaving}function L(a){function b(a){M.isEditing?this.items=[{name:"Vitals",icon:"vitals",index:0},{name:"Lab",icon:"lab",index:1},{name:"Refresh data",icon:"refresh",index:2},{name:"Find another patient",icon:"person",index:3},{name:"Edit patient",icon:"edit",index:4},{name:"Add new patient",icon:"personAdd",index:5}]:this.items=[{name:"Find another patient",icon:"person",index:3}],this.title="Patient options",this.performAction=function(b){a.hide(b)}}d.show({parent:angular.element(document.getElementById("content")),templateUrl:"./templates/resourceSheet.html",controller:["$mdBottomSheet",b],controllerAs:"vm",bindToController:!0,targetEvent:a}).then(function(a){switch(a.index){case 0:c.path("/consultation");break;case 1:c.path("/lab");break;case 2:O("Refreshing patient data from "+M.activeServer.name),c.path("/patient/get/"+M.patient.id);break;case 3:c.path("/patient");break;case 4:c.path("/patient/edit/current");break;case 5:c.path("/patient/edit/new");break;case 6:y(M.patient)}})}var M=this,N=k.logger.getLogFn(b,"error"),O=k.logger.getLogFn(b,"info"),P=k.logger.getLogFn(b,"warning"),Q=k.$q,R=!1;g.$on("server.changed",function(a,b){M.activeServer=b.activeServer,O("Remote server changed to "+M.activeServer.name)}),Object.defineProperty(M,"canSave",{get:K}),Object.defineProperty(M,"canDelete",{get:J}),M.actions=L,M.activeServer=null,M["delete"]=y,M.dataEvents=[],M.errors=[],M.history=[],M.isBusy=!1,M.summary=[],M.edit=z,M.getOrganizationReference=B,M.lookupKey=void 0,M.isBusy=!1,M.isSaving=!1,M.isEditing=!0,M.patient=void 0,M.practitionerSearchText="",M.save=F,M.selectedPractitioner=null,M.title="Patient Detail",M.showAuditData=G,M.showClinicalData=H,x()}var b="patientDetail";angular.module("FHIRCloud").controller(b,["$filter","$location","$mdBottomSheet","$mdDialog","$routeParams","$scope","$window","addressService","attachmentService","common","demographicsService","fhirServers","humanNameService","identifierService","organizationService","patientService","contactPointService","practitionerService","communicationService","careProviderService","observationService","config",a])}(),function(){"use strict";var a=angular.module("FHIRCloud");a.directive("smartApp",["$compile","$sce",function(a,b){var c={restrict:"E",scope:{smartUrl:"=smartUrl"},link:function(c,d,e){var f="";c.$watch("smartUrl",function(e){if(f!==e){f=e,c.trustedUri=b.trustAsResourceUrl(c.smartUrl);var g='<iframe src="{{trustedUri}}" style="height: 1280px; width: 800px;" allowfullscreen="" frameborder="0"></iframe>',h=a(g)(c);d.empty(),d.append(h)}})}};return c}]),a.directive("fhirClinicalResource",function(){var a={restrict:"E",scope:{resource:"=resource?"},templateUrl:"templates/pagination.html",link:function(a,b,c){a.$watch("links",function(b){b&&(a.refresh=_.remove(b,function(a){return"self"===a.relation}))})}};return a})}(),function(){"use strict";function a(a,c,d,e,f,g,h,i){function j(){f.activateController([k()],b).then(function(){angular.isDefined(d.orgId)?(l(d.orgId),z("Retrieving patients for current organization, please wait...")):n()},function(a){y("Error initializing patient search",a)})}function k(){g.getActiveServer().then(function(a){w.activeServer=a})}function l(a){w.patientSearch.organization=a,o()}function m(b){b&&b.$$hashKey&&a.path("/patient/view/"+b.$$hashKey)}function n(){w.ethnicities=h.ethnicity().concept,w.races=h.race().concept,w.languages=h.iso6391Languages()}function o(){function a(a){var b=a.getFullYear().toString(),c=(a.getMonth()+1).toString(),d=a.getDate().toString();return b.concat("-",c[1]?c:"0"+c[0]).concat("-",d[1]?d:"0"+d[0])}var b="",c={param:"",value:""},d=[];w.patientSearch.organization&&(c.param="organization",c.value=w.patientSearch.organization,d.push(_.clone(c))),w.patientSearch.name.given&&(c.param="given",c.value=w.patientSearch.name.given,d.push(_.clone(c))),w.patientSearch.name.family&&(c.param="family",c.value=w.patientSearch.name.family,d.push(_.clone(c))),w.patientSearch.mothersMaidenName&&(c.param="mothersMaidenName",c.value=w.patientSearch.mothersMaidenName,d.push(_.clone(c))),w.patientSearch.address.street&&(c.param="addressLine",c.value=w.patientSearch.address.street,d.push(_.clone(c))),w.patientSearch.address.city&&(c.param="city",c.value=w.patientSearch.address.city,d.push(_.clone(c))),w.patientSearch.address.state&&(c.param="state",c.value=w.patientSearch.address.state,d.push(_.clone(c))),w.patientSearch.address.postalCode&&(c.param="postalCode",c.value=w.patientSearch.address.postalCode,d.push(_.clone(c))),w.patientSearch.dob&&(c.param="birthDate",c.value=a(w.patientSearch.dob),d.push(_.clone(c))),(w.patientSearch.age.start||w.patientSearch.age.end)&&(w.patientSearch.age.start===w.patientSearch.age.end?(c.param="age",c.value=w.patientSearch.age.start,d.push(_.clone(c))):(c.param="age",c.value=">".concat(0===w.patientSearch.age.start?w.patientSearch.age.start:w.patientSearch.age.start-1),d.push(_.clone(c)),c.value="<".concat(1===w.patientSearch.age.end?w.patientSearch.age.end:w.patientSearch.age.end+1),d.push(_.clone(c)))),w.patientSearch.identifier.system&&w.patientSearch.identifier.value&&(c.param="identifier",c.value=w.patientSearch.identifier.system.concat("|",w.patientSearch.identifier.value),d.push(_.clone(c))),w.patientSearch.telecom&&(c.param="telecom",c.value=w.patientSearch.telecom,d.push(_.clone(c))),w.patientSearch.gender&&(c.param="gender",c.value=w.patientSearch.gender,d.push(_.clone(c))),w.patientSearch.race&&(c.param="race",c.value=h.race().system.concat("|",w.patientSearch.race.code),d.push(_.clone(c))),w.patientSearch.language&&(c.param="language",c.value=w.patientSearch.language.system.concat("|",w.patientSearch.language.code),d.push(_.clone(c))),w.patientSearch.ethnicity&&(c.param="ethnicity",c.value=h.ethnicity().system.concat("|",w.patientSearch.ethnicity.code),d.push(_.clone(c))),_.forEach(d,function(a){b=b.concat(a.param,"=",encodeURIComponent(a.value),"&")}),b=_.trimRight(b,"&"),r(b)}function p(a){w.isBusy=!0,i.getPatientsByLink(a).then(function(a){return z("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" Patients from "+w.activeServer.name,null,A),a},function(a){w.isBusy=!1,y(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(s).then(function(){w.isBusy=!1})}function q(a){var b=B.defer();return i.getPatients(w.activeServer.baseUrl,a).then(function(a){z("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" Patients from "+w.activeServer.name,null,A),b.resolve(a.entry||[])},function(a){y("Error getting patients",a,A),b.reject()}),b.promise}function r(a){var b=B.defer();return w.isBusy=!0,i.searchPatients(w.activeServer.baseUrl,a).then(function(a){z("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" Patients from "+w.activeServer.name,null,A),s(a),w.isBusy=!1,w.selectedTab=1},function(a){w.isBusy=!1,y("Error getting patients",a),b.reject()}).then(b.resolve()),b.promise}function s(a){a&&(w.patients=a.entry||[],w.paging.links=a.link||[],w.paging.totalResults=a.total||0)}function t(){void 0===w.patientSearch.age.end&&(w.patientSearch.age.end=w.patientSearch.age.start),void 0===w.patientSearch.age.start&&(w.patientSearch.age.start=w.patientSearch.age.end),w.patientSearch.age.start>w.patientSearch.age.end&&(w.patientSearch.age.end=w.patientSearch.age.start)}function u(){void 0!==w.patientSearch.dob&&(w.patientSearch.age.end=w.patientSearch.age.start=void 0)}function v(b){function d(a){this.items=[{name:"Add new patient",icon:"personAdd",index:0},{name:"Detailed search",icon:"search",index:1},{name:"Quick find",icon:"person",index:2}],this.title="Patient search options",this.performAction=function(b){a.hide(b)}}c.show({parent:angular.element(document.getElementById("content")),templateUrl:"./templates/resourceSheet.html",controller:["$mdBottomSheet",d],controllerAs:"vm",bindToController:!0,targetEvent:b}).then(function(b){switch(b.index){case 0:a.path("/patient/edit/new");break;case 1:a.path("/patient/detailed-search");break;case 2:a.path("/patient")}})}var w=this,x=f.logger.getLogFn,y=x(b,"error"),z=x(b,"info"),A=!1,B=f.$q;w.quickSearch=q,w.activeServer=null,w.dereferenceLink=p,w.goToPatient=m,w.patients=[],w.selectedPatient=null,w.searchResults=null,w.searchText="",w.title="Patients",w.managingOrganization=void 0,w.practitioner=void 0,w.actions=v,w.races=[],w.ethnicities=[],w.languages=[],w.detailSearch=o,w.isBusy=!1,w.ageRangeChange=t,w.dobChange=u,w.patientSearch={name:{first:void 0,last:void 0},mothersMaidenName:void 0,address:{street:void 0,city:void 0,state:void 0,postalCode:void 0},telecom:void 0,identifier:{system:void 0,value:void 0},age:{start:void 0,end:void 0},dob:void 0,race:void 0,gender:void 0,ethnicity:void 0,language:void 0,organization:void 0,careProvider:void 0},w.paging={currentPage:1,totalResults:0,links:null},w.selectedTab=0,j()}var b="patientSearch";angular.module("FHIRCloud").controller(b,["$location","$mdBottomSheet","$routeParams","$scope","common","fhirServers","localValueSets","patientService",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i){function j(a){I(a);var b=N.defer();return h.getActiveServer().then(function(c){var d=c.baseUrl+"/Patient";g.addResource(d,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function k(){f.addToCache(J,null)}function l(a,b){function c(b){if(b&&b.entry){var c=b.entry;b.entry=_.remove(c,function(b){return b.$$hashKey!==a}),b.totalResults=b.totalResults-1,f.addToCache(J,b)}d.resolve()}var d=N.defer();return m(b).then(p,function(a){d.reject(a)}).then(c,function(a){d.reject(a)}).then(function(){d.resolve()}),d.promise}function m(a){var b=N.defer();return g.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function n(a){var b=N.defer();return g.getResource(a+"/$everything").then(function(a){var c={patient:null,summary:[],history:[]};c.history=_.remove(a.data.entry,function(a){return"AuditEvent"===a.resource.resourceType}),c.patient=_.remove(a.data.entry,function(a){return"Patient"===a.resource.resourceType})[0],c.summary=a.data.entry,b.resolve(c)},function(a){b.reject(a)}),b.promise}function o(a){function b(b){for(var e,f=b.entry,g=0,h=f.length;h>g;g++)if(f[g].$$hashKey===a){e=f[g].resource;var i=b.base||c.baseUrl+"/";e.resourceId=i+e.resourceType+"/"+e.id,e.hashKey=a;break}e?d.resolve(e):d.reject("Patient not found in cache: "+a)}var c,d=N.defer();return p().then(h.getActiveServer().then(function(a){c=a})).then(b,function(){d.reject("Patient search results not found in cache.")}),d.promise}function p(){var a=N.defer(),b=f.readFromCache(J);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function q(a){var b=N.defer();return g.getResource(a).then(function(a){f.addToCache(J,a),b.resolve(a)},function(a){b.reject(a)}),b.promise}function r(){return f.readFromCache(J)}function s(b,c){var d=N.defer();return g.getResource(b+"/Patient?name="+c+"&_count=20").then(function(b){var c=[];b.data.entry&&angular.forEach(b.data.entry,function(b){b.content&&"Patient"===b.content.resourceType&&c.push({display:a("fullName")(b.content.name),reference:b.id})}),0===c.length&&c.push({display:"No matches",reference:""}),d.resolve(c)},function(a){d.reject(a)}),d.promise}function t(a,b){var c=N.defer();return angular.isUndefined(b)&&angular.isUndefined(organizationId)&&c.reject("Invalid search input"),g.getResource(a+"/Patient?"+b+"&_count=20").then(function(a){f.addToCache(J,a.data),c.resolve(a.data)},function(a){c.reject(a)}),c.promise}function u(a,b,c){var d=N.defer(),e="";if(angular.isUndefined(b)&&angular.isUndefined(c)&&d.reject("Invalid search input"),angular.isDefined(b)&&b.length>1){var h=b.split(" ");e=1===h.length?"name="+h[0]:"given="+h[0]+"&family="+h[1]}if(angular.isDefined(c)){var i="organization:="+c;e=e.length>1?e+"&"+i:i}return g.getResource(a+"/Patient?"+e+"&_count=20").then(function(a){f.addToCache(J,a.data),d.resolve(a.data)},function(a){d.reject(a)}),d.promise}function v(a){var b=N.defer();return g.getResource(a).then(function(a){f.addToCache(J,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function w(){return{resourceType:"Patient",name:[],gender:void 0,birthDate:null,maritalStatus:void 0,multipleBirth:!1,telecom:[],address:[],photo:[],communication:[],managingOrganization:null,careProvider:[],contact:[],link:[],extension:[],active:!0}}function x(a){f.addToCache(K,a)}function y(a,b){I(b);var c=N.defer();return g.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function z(b,f){var g=N.defer(),h=[],i=[];return c.get("http://api.randomuser.me/?results=25&nat=us").success(function(c){angular.forEach(c.results,function(c){var g=c.user,k=new Date(parseInt(g.dob)),l=(a("date")(k,"yyyy-MM-dd"),{resourceType:"Patient",name:[{family:[a("titleCase")(g.name.last)],given:[a("titleCase")(g.name.first)],prefix:[a("titleCase")(g.name.title)],use:"usual"}],gender:g.gender,birthDate:B(),contact:[],communication:G(),maritalStatus:H(),telecom:[{system:"email",value:g.email,use:"home"},{system:"phone",value:g.cell,use:"mobile"},{system:"phone",value:g.phone,use:"home"}],address:[{line:[a("titleCase")(g.location.street)],city:a("titleCase")(g.location.city),state:a("abbreviateState")(g.location.state),postalCode:g.location.zip,use:"home"}],photo:[{url:g.picture.large}],identifier:[{system:"urn:oid:2.16.840.1.113883.4.1",value:g.SSN,use:"secondary",assigner:{display:"Social Security Administration"}},{system:"urn:oid:2.16.840.1.113883.15.18",value:g.registered,use:"official",assigner:{display:f}},{system:"urn:fhir-cloud:patient",value:e.randomHash(),use:"secondary",assigner:{display:"FHIR Cloud"}}],managingOrganization:{reference:"Organization/"+b,display:f},link:[],active:!0,extension:[]});l.extension.push(D()),l.extension.push(E()),l.extension.push(F()),l.extension.push(A(i)),l.extension.push(C(h)),i.push(a("titleCase")(g.name.last)),h.push(l.address[0].city+", "+a("abbreviateState")(g.location.state));var m=d(function(){},3e3);m.then(function(){j(l).then(function(a){M("Created patient "+g.name.first+" "+g.name.last+" at "+(a.headers.location||a.headers["content-location"]),null,!1)},function(a){L("Failed to create patient "+g.name.first+" "+g.name.last,a,!1)})})}),g.resolve()}).error(function(a){g.reject(a)}),g.promise}function A(a){var b={url:"http://hl7.org/fhir/StructureDefinition/patient-mothersMaidenName",valueString:""};return a.length>0?(e.shuffle(a),b.valueString=a[0]):b.valueString="Gibson",b}function B(){var b=new Date(1945,1,1),c=new Date(1995,12,31),d=new Date(b.getTime()+Math.random()*(c.getTime()-b.getTime()));return a("date")(d,"yyyy-MM-dd")}function C(a){var b={url:"http://hl7.org/fhir/StructureDefinition/birthPlace",valueAddress:null};if(a.length>0){e.shuffle(a);var c=a[0].split(",");b.valueAddress={text:a[0],city:c[0],state:c[1],country:"USA"}}else b.valueAddress={text:"New York, NY",city:"New York",state:"NY",country:"USA"};return b}function D(){var a=i.race();e.shuffle(a.concept);var b=a.concept[1],c={url:"http://hl7.org/fhir/StructureDefinition/us-core-race",valueCodeableConcept:{coding:[],text:b.display}};return c.valueCodeableConcept.coding.push({system:a.system,code:b.code,display:b.display}),c}function E(){function a(){var a=i.ethnicity();P=a.system;for(var b=0,c=a.concept.length;c>b;b++){var d=a.concept[b];if(O.push(d),angular.isDefined(d.concept)&&angular.isArray(d.concept))for(var e=0,f=d.concept.length;f>e;e++){var g=d.concept[e];if(O.push(g),angular.isDefined(g.concept)&&angular.isArray(g.concept))for(var h=0,j=g.concept.length;j>h;h++){var k=g.concept[h];O.push(k)}}}}0===O.length&&a(),e.shuffle(O);var b=O[1],c={url:"http://hl7.org/fhir/StructureDefinition/us-core-ethnicity",valueCodeableConcept:{coding:[],text:b.display}};return c.valueCodeableConcept.coding.push({system:P,code:b.code,display:b.display}),c}function F(){var a=i.religion();e.shuffle(a.concept);var b=a.concept[1],c={url:"http://hl7.org/fhir/StructureDefinition/us-core-religion",valueCodeableConcept:{coding:[],text:b.display}};return c.valueCodeableConcept.coding.push({system:a.system,code:b.code,display:b.display}),c}function G(){var a=i.iso6391Languages();e.shuffle(a);var b=[],c={language:{text:a[1].display,coding:[]},preferred:!0};return c.language.coding.push({system:a[1].system,code:a[1].code,display:a[1].display}),b.push(c),b}function H(){var a=i.maritalStatus();e.shuffle(a);var b=a[1],c={coding:[],text:b.display};return c.coding.push({system:b.system,code:b.code,display:b.display}),c}function I(a){return 0===a.address.length&&(a.address=null),0===a.identifier.length&&(a.identifier=null),0===a.contact.length&&(a.contact=null),0===a.telecom.length&&(a.telecom=null),0===a.photo.length&&(a.photo=null),0===a.communication.length&&(a.communication=null),0===a.link.length&&(a.link=null),angular.isDefined(a.maritalStatus)&&(angular.isUndefined(a.maritalStatus.coding)||0===a.maritalStatus.coding.length)&&(a.maritalStatus=null),N.when(a)}var J="localPatients",K="contextPatient",L=e.logger.getLogFn(b,"error"),M=e.logger.getLogFn(b,"info"),N=e.$q,O=[],P="",Q={addPatient:j,clearCache:k,deleteCachedPatient:l,deletePatient:m,getCachedPatient:o,getCachedSearchResults:p,getPatient:q,getPatientContext:r,getPatientReference:s,getPatients:u,getPatientsByLink:v,getPatientEverything:n,initializeNewPatient:w,setPatientContext:x,updatePatient:y,seedRandomPatients:z,searchPatients:t};return Q}var b="patientService";angular.module("FHIRCloud").factory(b,["$filter","$http","$timeout","common","dataCache","fhirClient","fhirServers","localValueSets",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){}function q(){return!D.isEditing}function r(){return!D.isSaving}function s(b){function c(){b&&b.resourceId&&b.hashKey&&k.deleteCachedPerson(b.hashKey,b.resourceId).then(function(){F("Deleted person "+b.fullName),a.path("/person")},function(a){E(h.unexpectedOutcome(a))})}var e=d.confirm().title("Delete "+b.fullName+"?").ariaLabel("delete person").ok("Yes").cancel("No").targetEvent(event);d.show(e).then(c,function(){F("You decided to keep "+b.fullName)})}function t(b){b&&b.hashKey&&a.path("/person/edit/"+b.hashKey)}function u(){i.getActiveServer().then(function(a){return D.activeServer=a,D.activeServer})}function v(a){var b=H.defer();return D.loadingOrganizations=!0,o.getOrganizationReference(D.activeServer.baseUrl,a).then(function(a){D.loadingOrganizations=!1,b.resolve(a)},function(a){D.loadingOrganizations=!1,E(h.unexpectedOutcome(a)),b.reject()}),b.promise}function w(){function a(a){D.person=a,m.init([D.person.photo],"Photo"),n.init(D.person.name),j.init(D.person.identifier,"multi","person"),g.init(D.person.address,!0),l.init(D.person.telecom,!0,!0),D.person.fullName=n.getFullName()}if("new"===e.hashKey)D.person=null,m.reset(),n.reset(),j.reset(),g.reset(),l.reset(),k.seedNewPerson().then(a).then(function(){D.title="Add New person",D.isEditing=!1},function(a){E(a)});else if(e.hashKey)k.getCachedPerson(e.hashKey).then(a,function(a){E(a)});else if(e.id){var b=D.activeServer.baseUrl+"/Person/"+e.id;k.getPerson(b).then(a,function(a){E(a)})}}function x(){var a="";return a=D.person?D.title="Edit "+(D.person&&D.person.fullName||""):D.title="Add New person",D.title=a,D.title}function y(){f.history.back()}function z(a){var b=a.headers.location||a.headers["content-location"];angular.isUndefined(b)?G("Person saved, but location is unavailable. CORS not implemented correctly at remote host.",!0):(D.person.resourceId=h.setResourceId(D.person.resourceId,b),F("Person saved at "+b,!0)),D.person.fullName=D.person.name,D.isEditing=!0,x()}function A(){var a=k.initializePerson().resource;a.name=n.mapFromViewModel(),a.photo=m.getAll()[0],a.address=g.mapFromViewModel(),a.telecom=l.mapFromViewModel(),a.identifier=j.getAll(),a.gender=D.person.gender,a.birthDate=D.person.birthDate,a.link=D.person.link,a.managingOrganization=D.person.managingOrganization,D.isEditing?k.updatePerson(D.person.resourceId,a).then(z,function(a){E(h.unexpectedOutcome(a))}):k.addPerson(a).then(z,function(a){E(h.unexpectedOutcome(a))})}function B(b){var d=[{name:"Edit",icon:"img/account4.svg"},{name:"Add",icon:"img/add184.svg"},{name:"Locate",icon:"img/share39.svg"},{name:"Delete",icon:"img/rubbish.svg"}];c.show({locals:{items:d},templateUrl:"templates/bottomSheet.html",controller:"bottomSheetController",targetEvent:b}).then(function(c){switch(c.name){case"Edit":a.path("/person/edit/"+D.person.$$hashKey);break;case"Add":a.path("/person/edit/new");break;case"Locate":F("TODO: implement Locate");break;case"Delete":s(D.person,b)}})}function C(){h.activateController([u()],b).then(function(){w()})}var D=this,E=h.logger.getLogFn(b,"error"),F=h.logger.getLogFn(b,"info"),G=h.logger.getLogFn(b,"warning"),H=h.$q;Object.defineProperty(D,"canSave",{get:r}),Object.defineProperty(D,"canDelete",{get:q}),D.activeServer=null,D.cancel=p,D.activate=C,D.contactTypes=void 0,D["delete"]=s,D.edit=t,D.getOrganizationReference=v,D.getTitle=x,D.goBack=y,D.isSaving=!1,D.isEditing=!0,D.loadingOrganizations=!1,D.person=void 0,D.personTypes=void 0,D.save=A,D.states=void 0,D.title="Person Detail",D.personActionsMenu=B,C()}var b="personDetail";angular.module("FHIRCloud").controller(b,["$location","$mdBottomSheet","$mdDialog","$routeParams","$window","addressService","common","fhirServers","identifierService","personService","contactPointService","attachmentService","humanNameService","organizationService",a])}(),function(){"use strict";function a(a,c,d,e,f,g){function h(){d.activateController([i(),j()],b).then(function(){},function(a){t("Error activating controller",a,v)})}function i(){f.getActiveServer().then(function(a){return q.activeServer=a,q.activeServer})}function j(){g.getCachedSearchResults().then(function(a){return s("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" persons from cache",null,v),a},function(a){s(a,null,v)}).then(l)}function k(b){b&&b.$$hashKey&&a.path("/person/view/"+b.$$hashKey)}function l(a){a&&(q.persons=a.entry||[],q.paging.links=a.link||[],q.paging.totalResults=a.total||0)}function m(){q.searchText.length>0&&(o(!0),g.getPersons(q.activeServer.baseUrl,q.searchText).then(function(a){return s("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" persons from "+q.activeServer.name),a},function(a){t("Error: "+a),o(!1)}).then(l).then(function(){o(!1)}))}function n(a){a.keyCode===u.esc&&(q.searchText="")}function o(a){q.isBusy=a}function p(b){var d=[{name:"Add",icon:"img/add184.svg"},{name:"Search",icon:"img/search100.svg"},{name:"Clear",icon:"img/clear5.svg"}];c.show({locals:{items:d},templateUrl:"templates/bottomSheet.html",controller:"bottomSheetController",targetEvent:b}).then(function(b){switch(b.name){case"Add":a.path("/person/edit/new");break;case"Search":s("TODO: implement Locate");break;case"Clear":g.clearCache(),q.searchText="",q.persons=[],q.paging=null,a.path("/person"),s("Search results cache cleared")}})}var q=this,r=d.logger.getLogFn,s=r(b,"info"),t=r(b,"error"),u=e.keyCodes,v=!1;q.activeServer=null,q.isBusy=!1,q.keyPress=n,q.goToPerson=k,q.persons=[],q.paging={currentPage:1,totalResults:0,links:null},q.submit=m,q.searchResults=null,q.searchText="",q.title="Person",q.personSearchActionsMenu=p,h()}var b="personSearch";angular.module("FHIRCloud").controller(b,["$location","$mdBottomSheet","common","config","fhirServers","personService",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h){function i(a){x(a);var b=C.defer();return h.getActiveServer().then(function(c){var d=c.baseUrl+"/Person";g.addResource(d,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function j(){f.addToCache(y,null)}function k(a,b){function c(b){if(b&&b.entry){var c=b.entry;b.entry=_.remove(c,function(b){return b.$$hashKey!==a}),b.totalResults=b.totalResults-1,f.addToCache(y,b)}d.resolve()}var d=C.defer();return l(b).then(n,function(a){d.reject(a)}).then(c,function(a){d.reject(a)}).then(function(){d.resolve()}),d.promise}function l(a){var b=C.defer();return g.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function m(a){function b(b){for(var d,e=b.entry,f=0,g=e.length;g>f;f++)if(e[f].$$hashKey===a){d=e[f].resource,d.resourceId=b.base+d.resourceType+"/"+d.id,d.hashKey=a;break}d?c.resolve(d):c.reject("Person not found in cache: "+a)}var c=C.defer();return n().then(b,function(){c.reject("Person search results not found in cache.")}),c.promise}function n(){var a=C.defer(),b=f.readFromCache(y);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function o(a){var b=C.defer();return g.getResource(a).then(function(a){f.addToCache(y,a),b.resolve(a)},function(a){b.reject(a)}),b.promise}function p(){return f.readFromCache(y)}function q(b,c){var d=C.defer();return g.getResource(b+"/Person/?name="+c+"&_count=20&_summary=true").then(function(b){var c=[];b.data.entry&&angular.forEach(b.data.entry,function(b){b.content&&"Person"===b.content.resourceType&&c.push({display:a("fullName")(b.content.name),reference:b.id})}),0===c.length&&c.push({
display:"No matches",reference:""}),d.resolve(c)},function(a){d.reject(a)}),d.promise}function r(a,b,c){var d=C.defer(),e="";if(angular.isUndefined(b)&&angular.isUndefined(c)&&d.reject("Invalid search input"),angular.isDefined(b)&&b.length>1){var h=b.split(" ");e=1===h.length?"name="+h[0]:"given="+h[0]+"&family="+h[1]}if(angular.isDefined(c)){var i="organization:Organization="+c;e=e.length>1?e+"&"+i:i}return g.getResource(a+"/Person?"+e+"&_count=20").then(function(a){f.addToCache(y,a.data),d.resolve(a.data)},function(a){d.reject(a)}),d.promise}function s(){var b=C.defer();return c.get("http://api.randomuser.me").success(function(c){var d=c.results[0].user,e={resourceType:"Person",name:[{family:[a("titleCase")(d.name.last)],given:[a("titleCase")(d.name.first)],prefix:[a("titleCase")(d.name.title)],use:"usual"}],gender:d.gender,birthDate:new Date(parseInt(d.dob)),telecom:[{system:"email",value:d.email,use:"home"},{system:"phone",value:d.cell,use:"mobile"},{system:"phone",value:d.phone,use:"home"}],address:[{line:[a("titleCase")(d.location.street)],city:a("titleCase")(d.location.city),state:a("abbreviateState")(d.location.state),postalCode:d.location.zip,use:"home"}],photo:{url:d.picture.large},identifier:[{system:"urn:oid:2.16.840.1.113883.4.1",value:d.SSN,use:"official"}],managingOrganization:null,link:[],active:!0},f={resource:e};b.resolve(f.resource)}).error(function(a){b.reject(a)}),b.promise}function t(){var a={};return a.resource={resourceType:"Person",name:[],gender:void 0,birthDate:void 0,telecom:[],address:[],photo:void 0,identifier:[],managingOrganization:void 0,link:[],active:!0},a}function u(b,e){var f=C.defer();return c.get("http://api.randomuser.me/?results=100").success(function(c){angular.forEach(c.results,function(c){var f=c.user,g=new Date(parseInt(f.dob)),h=a("date")(g,"yyyy-MM-dd"),j={resourceType:"Person",name:[{family:[a("titleCase")(f.name.last)],given:[a("titleCase")(f.name.first)],prefix:[a("titleCase")(f.name.title)],use:"usual"}],gender:f.gender,birthDate:h,telecom:[{system:"email",value:f.email,use:"home"},{system:"phone",value:f.cell,use:"mobile"},{system:"phone",value:f.phone,use:"home"}],address:[{line:[a("titleCase")(f.location.street)],city:a("titleCase")(f.location.city),state:a("abbreviateState")(f.location.state),postalCode:f.location.zip,use:"home"}],photo:{url:f.picture.large},identifier:[{system:"urn:oid:2.16.840.1.113883.4.1",value:f.SSN,use:"official",label:"Social Security Number",assigner:{display:"Social Security Administration"}},{system:"urn:oid:2.16.840.1.113883.15.34",value:f.registered,use:"official",label:e+" master Id",assigner:{reference:b,display:e}}],managingOrganization:{reference:b,display:e},link:[],active:!0},k=d(function(){},5e3);k.then(function(){i(j).then(function(a){B("Created person "+f.name.first+" "+f.name.last+" at "+(a.headers.location||a.headers["content-location"]),null,!1)},function(a){A("Failed to create person "+f.name.first+" "+f.name.last,a,!1)})})}),f.resolve()}).error(function(a){f.reject(a)}),f.promise}function v(a){f.addToCache(z,a)}function w(a,b){x(b);var c=C.defer();return g.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function x(a){return 0===a.address.length&&(a.address=null),0===a.identifier.length&&(a.identifier=null),0===a.telecom.length&&(a.telecom=null),0===a.link.length&&(a.link=null),C.when(a)}var y="localPersons",z="contextPerson",A=e.logger.getLogFn(b,"error"),B=e.logger.getLogFn(b,"info"),C=e.$q,D={addPerson:i,clearCache:j,deleteCachedPerson:k,deletePerson:l,getCachedPerson:m,getCachedSearchResults:n,getPerson:o,getPersonContext:p,getPersonReference:q,getPersons:r,initializePerson:t,seedNewPerson:s,seedRandomPersons:u,setPersonContext:v,updatePerson:w};return D}var b="personService";angular.module("FHIRCloud").factory(b,["$filter","$http","$timeout","common","dataCache","fhirClient","fhirServers",a])}(),function(){"use strict";function a(a,c,d,e,f,g){function h(){d.activateController([i(),j()],b).then(function(){},function(a){t("Error "+a)})}function i(){f.getActiveServer().then(function(a){q.activeServer=a})}function j(){g.getCachedSearchResults().then(function(a){return u("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" practitioners from cache",v),a},function(a){u(a,null,v)}).then(l)}function k(b){b&&b.$$hashKey&&a.path("/practitionerReference/view/"+b.$$hashKey)}function l(a){a&&(q.practitioners=a.entry||[],q.paging.links=a.link||[],q.paging.totalResults=a.total||0)}function m(a){d.toggleProgressBar(!0),g.getpractitionersByLink(a).then(function(a){return u("Returned "+(angular.isArray(a.practitioners)?a.practitioners.length:0)+" practitioners from "+q.activeServer.name,v),a},function(a){d.toggleProgressBar(!1),t(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(l).then(function(){d.toggleProgressBar(!1)})}function n(){q.searchText.length>0&&(d.toggleProgressBar(!0),g.getpractitioners(q.activeServer.baseUrl,q.searchText).then(function(a){return u("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" practitioners from "+q.activeServer.name),a},function(a){t("Error getting practitioners",a,v),d.toggleProgressBar(!1)}).then(l).then(function(){d.toggleProgressBar(!1)}))}function o(a){a.keyCode===s.esc&&(q.searchText="")}function p(a){a.preventDefault(),c("right").toggle()}var q=this,r=d.logger.getLogFn,s=e.keyCodes,t=r(b,"error"),u=r(b,"info"),v=!1;q.activeServer=null,q.keyPress=o,q.goTopractitioner=k,q.practitioners=[],q.practitionersCount=0,q.paging={currentPage:1,totalResults:0,links:null},q.dereferenceLink=m,q.submit=n,q.searchResults=null,q.searchText="",q.title="practitioners",q.managingOrganization=void 0,q.toggleSideNav=p,h()}var b="practitionerSearch";angular.module("FHIRCloud").controller(b,["$location","$mdSidenav","common","config","fhirServers","practitionerService",a])}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a){x(a);var b=A.defer();return g.getActiveServer().then(function(c){var d=c.baseUrl+"/Practitioner";f.addResource(d,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function i(){e.addToCache(y,null)}function j(a,b){function c(b){if(b&&b.entry){var c=b.entry;b.entry=_.remove(c,function(b){return b.$$hashKey!==a}),b.totalResults=b.totalResults-1,e.addToCache(y,b)}d.resolve()}var d=A.defer();return k(b).then(n,function(a){d.reject(a)}).then(c,function(a){d.reject(a)}).then(function(){d.resolve()}),d.promise}function k(a){var b=A.defer();return f.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function l(a){var b=A.defer();return f.getResource(a+"/$everything").then(function(a){var c={practitioner:null,summary:[],history:[]};c.history=_.remove(a.data.entry,function(a){return"SecurityEvent"===a.resource.resourceType}),c.practitioner=_.remove(a.data.entry,function(a){return"Practitioner"===a.resource.resourceType})[0],c.summary=a.data.entry,b.resolve(c)},function(a){b.reject(a)}),b.promise}function m(a){function b(b){for(var d,e=b.entry,f=0,g=e.length;g>f;f++)if(e[f].$$hashKey===a){d=e[f].resource,d.resourceId=b.base+d.resourceType+"/"+d.id,d.hashKey=d.$$hashKey;break}d?c.resolve(d):c.reject("Practitioner not found in cache: "+a)}var c=A.defer();return n().then(b,function(){c.reject("Practitioner search results not found in cache.")}),c.promise}function n(){var a=A.defer(),b=e.readFromCache(y);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function o(a){var b=A.defer();return f.getResource(a).then(function(a){e.addToCache(y,a),b.resolve(a)},function(a){b.reject(a)}),b.promise}function p(){return e.readFromCache(y)}function q(b,c){var d=A.defer();return f.getResource(b+"/Practitioner?name="+c+"&_count=10").then(function(c){var e=[];if(c.data.entry)for(var f=0,g=c.data.entry.length;g>f;f++){var h=c.data.entry[f];if(h.resource&&"Practitioner"===h.resource.resourceType&&e.push({display:a("fullName")(h.resource.name),reference:b+"/Practitioner/"+h.resource.id}),10===f)break}0===e.length&&e.push({display:"No matches",reference:""}),d.resolve(e)},function(a){d.reject(a)}),d.promise}function r(a,b){var c=A.defer(),d="";angular.isUndefined(b)&&c.reject("Invalid search input");var g=b.split(" ");return d=1===g.length?"name="+g[0]:"given="+g[0]+"&family="+g[1],f.getResource(a+"/Practitioner?"+d+"&_count=20").then(function(a){e.addToCache(y,a.data),c.resolve(a.data)},function(a){c.reject(a)}),c.promise}function s(a){var b=A.defer();return f.getResource(a).then(function(a){e.addToCache(y,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function t(){return{resourceType:"Practitioner",name:[],gender:void 0,birthDate:null,maritalStatus:void 0,telecom:[],address:[],photo:[],communication:[],managingpractitioner:null,contact:[],link:[],active:!0}}function u(a){e.addToCache(z,a)}function v(a,b){x(b);var c=A.defer();return f.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function w(d,e){var f=A.defer();return b.get("http://api.randomuser.me/?results=10").success(function(b){var g=0;angular.forEach(b.results,function(b){var f=b.user,i=new Date(parseInt(f.dob)),j=a("date")(i,"yyyy-MM-dd"),k={resourceType:"Practitioner",name:[{family:[a("titleCase")(f.name.last)],given:[a("titleCase")(f.name.first)],prefix:[a("titleCase")(f.name.title)],use:"usual"}],gender:f.gender,birthDate:j,contact:[],communication:[],maritalStatus:[],telecom:[{system:"email",value:f.email,use:"home"},{system:"phone",value:f.cell,use:"mobile"},{system:"phone",value:f.phone,use:"home"}],address:[{line:[a("titleCase")(f.location.street)],city:a("titleCase")(f.location.city),state:a("abbreviateState")(f.location.state),postalCode:f.location.zip,use:"home"}],photo:[{url:f.picture.large}],identifier:[{system:"urn:oid:2.16.840.1.113883.4.1",value:f.SSN,use:"official",label:"Social Security Number",assigner:{display:"Social Security Administration"}},{system:"urn:oid:2.16.840.1.113883.15.18",value:f.registered,use:"official",label:e+" master Id",assigner:{reference:d,display:e}}],managingpractitioner:{reference:d,display:e},link:[],active:!0};c(h(k).then(g+=1),2e3)}),f.resolve(g+" practitioners created for "+e)}).error(function(a){f.reject(a)}),f.promise}function x(a){return 0===a.address.length&&(a.address=null),0===a.identifier.length&&(a.identifier=null),0===a.contact.length&&(a.contact=null),0===a.telecom.length&&(a.telecom=null),0===a.photo.length&&(a.photo=null),0===a.communication.length&&(a.communication=null),0===a.link.length&&(a.link=null),a.maritalStatus.coding&&0===a.maritalStatus.coding.length&&(a.maritalStatus=null),A.when(a)}var y="localPractitioners",z="contextPractitioner",A=d.$q,B={addPractitioner:h,clearCache:i,deleteCachedPractitioner:j,deletePractitioner:k,getCachedPractitioner:m,getCachedSearchResults:n,getPractitioner:o,getPractitionerContext:p,getPractitionerReference:q,getPractitioners:r,getPractitionersByLink:s,getPractitionerEverything:l,initializeNewPractitioner:t,setPractitionerContext:u,updatePractitioner:v,seedRandomPractitioners:w};return B}var b="practitionerService";angular.module("FHIRCloud").factory(b,["$filter","$http","$timeout","common","dataCache","fhirClient","fhirServers",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i,j){function k(){}function l(){return!A.isEditing}function m(){return!A.isSaving}function n(b){function c(){b&&b.resourceId&&b.hashKey&&h.deleteCachedProfile(b.hashKey,b.resourceId).then(function(){C("Deleted profile "+b.name),a.path("/profiles")},function(a){B(f.unexpectedOutcome(a))})}var d=e.confirm().title("Delete "+b.name+"?").ok("Yes").cancel("No");e.show(d).then(c)}function o(b){b&&b.hashKey&&a.path("/profile/edit/"+b.hashKey)}function p(){g.getActiveServer().then(function(a){return A.activeServer=a,A.activeServer})}function q(){function a(a){var b=angular.copy(a.resource);b.text?A.narrative=b.text.div||"<div>Not provided</div>":A.narrative="<div>Not provided</div>",A.json=b,A.json.text={div:"see narrative tab"},A.json=angular.toJson(b,!0),A.profile=b,angular.isUndefined(A.profile.type)&&(A.profile.type={coding:[]}),A.title=A.profile.name,i.init(A.profile.telecom,!1,!1)}if("new"===c.hashKey){var b=h.initializeNewProfile();a(b),A.title="Add New Profile",A.isEditing=!1}else if(c.hashKey)h.getCachedProfile(c.hashKey).then(a).then(function(){},function(a){B(a)});else if(c.id){var d=A.activeServer.baseUrl+"/Profile/"+c.id;h.getProfile(d).then(a,function(a){B(a)})}}function r(){var a="";return a=A.profile?A.title="Edit "+(A.profile&&A.profile.fullName||""):A.title="Add New Profile",A.title=a,A.title}function s(){d.history.back()}function t(a){var b=a.headers.location||a.headers["content-location"];angular.isUndefined(b)?D("Profile saved, but location is unavailable. CORS not implemented correctly at remote host."):(A.profile.resourceId=f.setResourceId(A.profile.resourceId,b),C("Profile saved at "+b)),A.isEditing=!0,r()}function u(){if(A.profile.name.length<5)return void B("Profile Name must be at least 5 characters");var a=h.initializeNewProfile().resource;a.name=A.profile.name,a.type=A.profile.type,a.telecom=i.mapFromViewModel(),a.active=A.profile.active,A.isEditing?h.updateProfile(A.profile.resourceId,a).then(t,function(a){B(f.unexpectedOutcome(a))}):h.addProfile(a).then(t,function(a){B(f.unexpectedOutcome(a))})}function v(a,b){e.show({optionsOrPresent:{disableParentScroll:!1},templateUrl:"templates/rawData-dialog.html",controller:"rawDataController",locals:{data:a},targetEvent:b})}function w(a,b){console.log(a)}function x(a,b){console.log(a)}function y(a,b){e.show({optionsOrPresent:{disableParentScroll:!1},templateUrl:"templates/valueSet-popup.html",controller:"valueSetPopupController",locals:{data:a},targetEvent:b})}function z(){f.activateController([p()],b).then(function(){q()})}var A=this,B=f.logger.getLogFn(b,"error"),C=f.logger.getLogFn(b,"success"),D=f.logger.getLogFn(b,"warning");Object.defineProperty(A,"canSave",{get:m}),Object.defineProperty(A,"canDelete",{get:l}),A.activeServer=null,A.cancel=k,A.activate=z,A["delete"]=n,A.edit=o,A.getTitle=r,A.goBack=s,A.isSaving=!1,A.isEditing=!0,A.profile=void 0,A.save=u,A.title="profileDetail",A.showFullDescription=v,A.viewExtensionDefinition=x,A.viewBoundValueSet=y,A.viewProfileDetail=w,z()}var b="profileDetail";angular.module("FHIRCloud").controller(b,["$location","$routeParams","$window","$mdDialog","common","fhirServers","profileService","contactPointService","valueSetService",a])}(),function(){"use strict";function a(a,c,d,e,f){function g(){e.getActiveServer().then(function(a){return t.activeServer=a,t.activeServer})}function h(){f.getCachedSearchResults().then(k)}function i(){c.activateController([g(),h()],b).then(function(){})}function j(b){b&&a.path("/profile/view/"+b)}function k(a){a&&(t.profiles=a.entry||[],t.paging.links=a.link||[],t.paging.totalResults=a.total||0)}function l(a){a&&(o(!0),f.getProfiles(t.activeServer.baseUrl,t.searchText).then(function(a){return r("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" Profiles from "+t.activeServer.name,!1),a},function(a){o(!1),s(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(k).then(function(){o(!1)}))}function m(a){o(!0),f.getProfilesByLink(a).then(function(a){return r("Returned "+(angular.isArray(a.profiles)?a.profiles.length:0)+" Profiles from "+t.activeServer.name,!0),a},function(a){o(!1),s(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(k).then(function(){o(!1)})}function n(a){a.keyCode===p.esc&&(t.searchText="")}function o(a){t.isBusy=a}var p=d.keyCodes,q=c.logger.getLogFn,r=q(b,"info"),s=q(b,"error"),t=this;t.activeServer=null,t.isBusy=!1,t.profiles=[],t.errorOutcome=null,t.paging={currentPage:1,totalResults:0,links:null},t.searchResults=null,t.searchText="",t.title="Profiles",t.keyPress=n,t.dereferenceLink=m,t.submit=l,t.goToDetail=j,i()}var b="profileSearch";angular.module("FHIRCloud").controller(b,["$location","common","config","fhirServers","profileService",a])}(),function(){"use strict";function a(a,c,d,e){function f(a){r(a).then(function(a){a.type.coding=s(a.type.coding)});var b=w.defer();return e.getActiveServer().then(function(c){var e=c.baseUrl+"/Profile";d.addResource(e,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function g(){c.addToCache(t,null)}function h(a,b){function d(b){for(var d=!1,f=b.entry,g=0,h=f.length;h>g;g++)if(f[g].$$hashKey===a){f.splice(g,1),b.entry=f,b.totalResults=b.totalResults-1,c.addToCache(t,b),d=!0;break}d?e.resolve():(v("Profile not found in cache: "+a),e.resolve())}var e=w.defer();return i(b).then(j,function(a){e.reject(a)}).then(d).then(function(){e.resolve()}),e.promise}function i(a){var b=w.defer();return d.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function j(){var a=w.defer(),b=c.readFromCache(t);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function k(a){function b(b){var d,e=b.entry;d=_.find(e,{$$hashKey:a}),d?c.resolve(d):c.reject("Profile not found in cache: "+a)}var c=w.defer();return j().then(b,function(){c.reject("Profile search results not found in cache.")}),c.promise}function l(a){var b=w.defer();return d.getResource(a).then(function(a){c.addToCache(t,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function m(a,b){var c=w.defer();return d.getResource(a+"/Profile?type="+b+"&_count=20").then(function(a){var b=[];a.data.entry&&angular.forEach(a.data.entry,function(a){b.push({display:a.resource.name,reference:a.resource.id})}),0===b.length&&b.push({display:"No matches",reference:""}),c.resolve(b)},function(a){c.reject(a)}),c.promise}function n(a,b){var e=w.defer();return d.getResource(a+"/Profile?name="+b+"&_count=20").then(function(a){c.addToCache(t,a.data),e.resolve(a.data)},function(a){e.reject(a)}),e.promise}function o(a){var b=w.defer();return d.getResource(a).then(function(a){var c={links:{},profiles:[]},d=[];a.data.entry&&angular.forEach(a.data.entry,function(a){a.content&&"Profile"===a.content.resourceType&&d.push({display:a.content.name,reference:a.id})}),0===d.length&&d.push({display:"No matches",reference:""}),c.profiles=d,a.data.link&&(c.links=a.data.link),c.totalResults=a.data.totalResults?a.data.totalResults:0,b.resolve(c)},function(a){b.reject(a)}),b.promise}function p(){var a={};return a.resource={resourceType:"Profile",identifier:[],type:{coding:[]},telecom:[],contact:[],address:[],partOf:null,location:[],active:!0},a}function q(a,b){r(b).then(function(a){a.type.coding=s(a.type.coding)});var c=w.defer();return d.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function r(a){return 0===a.address.length&&(a.address=null),0===a.identifier.length&&(a.identifier=null),0===a.contact.length&&(a.contact=null),0===a.telecom.length&&(a.telecom=null),0===a.location.length&&(a.location=null),w.when(a)}function s(a){var b=null;if(angular.isArray(a)&&angular.isDefined(a[0]))if(angular.isObject(a[0]))b=a;else{var c=JSON.parse(a[0]);b=[],b.push(c?c:null)}return b}var t="localProfiles",u=a.logger.getLogFn,v=u(b,"warning"),w=a.$q,x={addProfile:f,clearCache:g,deleteCachedProfile:h,deleteProfile:i,getCachedProfile:k,getCachedSearchResults:j,getProfile:l,getProfiles:n,getProfilesByLink:o,getProfileReference:m,initializeNewProfile:p,updateProfile:q};return x}var b="profileService";angular.module("FHIRCloud").factory(b,["common","dataCache","fhirClient","fhirServers",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){}function q(){return!D.isEditing}function r(){return!D.isSaving}function s(b){function c(){b&&b.resourceId&&b.hashKey&&k.deleteCachedRelatedperson(b.hashKey,b.resourceId).then(function(){F("Deleted relatedPerson "+b.fullName),a.path("/relatedPerson")},function(a){E(h.unexpectedOutcome(a))})}var e=d.confirm().title("Delete "+b.fullName+"?").ariaLabel("delete relatedPerson").ok("Yes").cancel("No").targetEvent(event);d.show(e).then(c,function(){F("You decided to keep "+b.fullName)})}function t(b){b&&b.hashKey&&a.path("/relatedPerson/edit/"+b.hashKey)}function u(){i.getActiveServer().then(function(a){return D.activeServer=a,D.activeServer})}function v(a){var b=H.defer();return D.loadingOrganizations=!0,o.getOrganizationReference(D.activeServer.baseUrl,a).then(function(a){D.loadingOrganizations=!1,b.resolve(a)},function(a){D.loadingOrganizations=!1,E(h.unexpectedOutcome(a)),b.reject()}),b.promise}function w(){function a(a){D.relatedPerson=a,m.init([D.relatedPerson.photo],"Photo"),n.init(D.relatedPerson.name),j.init(D.relatedPerson.identifier,"multi","relatedPerson"),g.init(D.relatedPerson.address,!0),l.init(D.relatedPerson.telecom,!0,!0),D.relatedPerson.fullName=n.getFullName()}if("new"===e.hashKey)D.relatedPerson=null,m.reset(),n.reset(),j.reset(),g.reset(),l.reset(),k.seedNewRelatedperson().then(a).then(function(){D.title="Add New relatedPerson",D.isEditing=!1},function(a){E(a)});else if(e.hashKey)k.getCachedRelatedperson(e.hashKey).then(a,function(a){E(a)});else if(e.id){var b=D.activeServer.baseUrl+"/Relatedperson/"+e.id;k.getRelatedperson(b).then(a,function(a){E(a)})}}function x(){var a="";return a=D.relatedPerson?D.title="Edit "+(D.relatedPerson&&D.relatedPerson.fullName||""):D.title="Add New relatedPerson",D.title=a,D.title}function y(){f.history.back()}function z(a){var b=a.headers.location||a.headers["content-location"];angular.isUndefined(b)?G("Relatedperson saved, but location is unavailable. CORS not implemented correctly at remote host.",!0):(D.relatedPerson.resourceId=h.setResourceId(D.relatedPerson.resourceId,b),F("Relatedperson saved at "+b,!0)),D.relatedPerson.fullName=D.relatedPerson.name,D.isEditing=!0,x()}function A(){var a=k.initializeRelatedperson().resource;a.name=n.mapFromViewModel(),a.photo=m.getAll()[0],a.address=g.mapFromViewModel(),a.telecom=l.mapFromViewModel(),a.identifier=j.getAll(),a.gender=D.relatedPerson.gender,a.birthDate=D.relatedPerson.birthDate,a.link=D.relatedPerson.link,a.managingOrganization=D.relatedPerson.managingOrganization,D.isEditing?k.updateRelatedperson(D.relatedPerson.resourceId,a).then(z,function(a){E(h.unexpectedOutcome(a))}):k.addRelatedperson(a).then(z,function(a){E(h.unexpectedOutcome(a))})}function B(b){var d=[{name:"Edit",icon:"img/account4.svg"},{name:"Add",icon:"img/add184.svg"},{name:"Locate",icon:"img/share39.svg"},{name:"Delete",icon:"img/rubbish.svg"}];c.show({locals:{items:d},templateUrl:"templates/bottomSheet.html",controller:"bottomSheetController",targetEvent:b}).then(function(c){switch(c.name){case"Edit":a.path("/relatedPerson/edit/"+D.relatedPerson.$$hashKey);break;case"Add":a.path("/relatedPerson/edit/new");break;case"Locate":F("TODO: implement Locate");break;case"Delete":s(D.relatedPerson,b)}})}function C(){h.activateController([u()],b).then(function(){w()})}var D=this,E=h.logger.getLogFn(b,"error"),F=h.logger.getLogFn(b,"info"),G=h.logger.getLogFn(b,"warning"),H=h.$q;Object.defineProperty(D,"canSave",{get:r}),Object.defineProperty(D,"canDelete",{get:q}),D.activeServer=null,D.cancel=p,D.activate=C,D.contactTypes=void 0,D["delete"]=s,D.edit=t,D.getOrganizationReference=v,D.getTitle=x,D.goBack=y,D.isSaving=!1,D.isEditing=!0,D.loadingOrganizations=!1,D.relatedPerson=void 0,D.relatedPersonTypes=void 0,D.save=A,D.states=void 0,D.title="Relatedperson Detail",D.relatedPersonActionsMenu=B,C()}var b="relatedPersonDetail";angular.module("FHIRCloud").controller(b,["$location","$mdBottomSheet","$mdDialog","$routeParams","$window","addressService","common","fhirServers","identifierService","relatedPersonService","contactPointService","attachmentService","humanNameService","organizationService",a])}(),function(){"use strict";function a(a,c,d,e,f,g){function h(){d.activateController([i(),j()],b).then(function(){},function(a){t("Error activating controller",a,v)})}function i(){f.getActiveServer().then(function(a){return q.activeServer=a,q.activeServer})}function j(){g.getCachedSearchResults().then(function(a){return s("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" relatedPersons from cache",null,v),a},function(a){s(a,null,v)}).then(l)}function k(b){b&&b.$$hashKey&&a.path("/relatedPerson/view/"+b.$$hashKey)}function l(a){a&&(q.relatedPersons=a.entry||[],q.paging.links=a.link||[],q.paging.totalResults=a.total||0)}function m(){q.searchText.length>0&&(o(!0),g.getRelatedpersons(q.activeServer.baseUrl,q.searchText).then(function(a){return s("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" relatedPersons from "+q.activeServer.name),a},function(a){t("Error: "+a),o(!1)}).then(l).then(function(){o(!1)}))}function n(a){a.keyCode===u.esc&&(q.searchText="")}function o(a){q.isBusy=a}function p(b){var d=[{name:"Add",icon:"img/add184.svg"},{name:"Search",icon:"img/search100.svg"},{name:"Clear",icon:"img/clear5.svg"}];c.show({locals:{items:d},templateUrl:"templates/bottomSheet.html",controller:"bottomSheetController",targetEvent:b}).then(function(b){switch(b.name){case"Add":a.path("/relatedPerson/edit/new");break;case"Search":s("TODO: implement Locate");break;case"Clear":g.clearCache(),q.searchText="",q.relatedPersons=[],q.paging=null,a.path("/relatedPerson"),s("Search results cache cleared")}})}var q=this,r=d.logger.getLogFn,s=r(b,"info"),t=r(b,"error"),u=e.keyCodes,v=!1;q.activeServer=null,q.isBusy=!1,q.keyPress=n,q.goToRelatedperson=k,q.relatedPersons=[],q.paging={currentPage:1,totalResults:0,links:null},q.submit=m,q.searchResults=null,q.searchText="",q.title="Relatedperson",q.relatedPersonSearchActionsMenu=p,h()}var b="relatedPersonSearch";angular.module("FHIRCloud").controller(b,["$location","$mdBottomSheet","common","config","fhirServers","relatedPersonService",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h){function i(a){x(a);var b=C.defer();return h.getActiveServer().then(function(c){var d=c.baseUrl+"/relatedPerson";g.addResource(d,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function j(){f.addToCache(y,null)}function k(a,b){function c(b){if(b&&b.entry){var c=b.entry;b.entry=_.remove(c,function(b){return b.$$hashKey!==a}),b.totalResults=b.totalResults-1,f.addToCache(y,b)}d.resolve()}var d=C.defer();return l(b).then(n,function(a){d.reject(a)}).then(c,function(a){d.reject(a)}).then(function(){d.resolve()}),d.promise}function l(a){var b=C.defer();return g.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function m(a){function b(b){for(var d,e=b.entry,f=0,g=e.length;g>f;f++)if(e[f].$$hashKey===a){d=e[f].resource,d.resourceId=b.base+d.resourceType+"/"+d.id,d.hashKey=a;break}d?c.resolve(d):c.reject("Relatedperson not found in cache: "+a)}var c=C.defer();return n().then(b,function(){c.reject("Relatedperson search results not found in cache.")}),c.promise}function n(){var a=C.defer(),b=f.readFromCache(y);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function o(a){var b=C.defer();return g.getResource(a).then(function(a){f.addToCache(y,a),b.resolve(a)},function(a){b.reject(a)}),b.promise}function p(){return f.readFromCache(y)}function q(b,c){var d=C.defer();return g.getResource(b+"/Relatedperson/?name="+c+"&_count=20&_summary=true").then(function(b){var c=[];b.data.entry&&angular.forEach(b.data.entry,function(b){b.content&&"Relatedperson"===b.content.resourceType&&c.push({display:a("fullName")(b.content.name),reference:b.id})}),0===c.length&&c.push({display:"No matches",reference:""}),d.resolve(c)},function(a){d.reject(a)}),d.promise}function r(a,b,c){var d=C.defer(),e="";if(angular.isUndefined(b)&&angular.isUndefined(c)&&d.reject("Invalid search input"),angular.isDefined(b)&&b.length>1){var h=b.split(" ");e=1===h.length?"name="+h[0]:"given="+h[0]+"&family="+h[1]}if(angular.isDefined(c)){var i="organization:Organization="+c;e=e.length>1?e+"&"+i:i}return g.getResource(a+"/Relatedperson?"+e+"&_count=20").then(function(a){f.addToCache(y,a.data),d.resolve(a.data)},function(a){d.reject(a)}),d.promise}function s(){var b=C.defer();return c.get("http://api.randomuser.me").success(function(c){var d=c.results[0].user,e={resourceType:"Relatedperson",name:[{family:[a("titleCase")(d.name.last)],given:[a("titleCase")(d.name.first)],prefix:[a("titleCase")(d.name.title)],use:"usual"}],gender:d.gender,birthDate:new Date(parseInt(d.dob)),telecom:[{system:"email",value:d.email,use:"home"},{system:"phone",value:d.cell,use:"mobile"},{system:"phone",value:d.phone,use:"home"}],address:[{line:[a("titleCase")(d.location.street)],city:a("titleCase")(d.location.city),state:a("abbreviateState")(d.location.state),postalCode:d.location.zip,use:"home"}],photo:{url:d.picture.large},identifier:[{system:"urn:oid:2.16.840.1.113883.4.1",value:d.SSN,use:"official"}],managingOrganization:null,link:[],active:!0},f={resource:e};b.resolve(f.resource)}).error(function(a){b.reject(a)}),b.promise}function t(){var a={};return a.resource={resourceType:"Relatedperson",name:[],gender:void 0,birthDate:void 0,telecom:[],address:[],photo:void 0,identifier:[],managingOrganization:void 0,link:[],active:!0},a}function u(b,e){var f=C.defer();return c.get("http://api.randomuser.me/?results=100").success(function(c){angular.forEach(c.results,function(c){var f=c.user,g=new Date(parseInt(f.dob)),h=a("date")(g,"yyyy-MM-dd"),j={resourceType:"Relatedperson",name:[{family:[a("titleCase")(f.name.last)],given:[a("titleCase")(f.name.first)],prefix:[a("titleCase")(f.name.title)],use:"usual"}],gender:f.gender,birthDate:h,telecom:[{system:"email",value:f.email,use:"home"},{system:"phone",value:f.cell,use:"mobile"},{system:"phone",value:f.phone,use:"home"}],address:[{line:[a("titleCase")(f.location.street)],city:a("titleCase")(f.location.city),state:a("abbreviateState")(f.location.state),postalCode:f.location.zip,use:"home"}],photo:{url:f.picture.large},identifier:[{system:"urn:oid:2.16.840.1.113883.4.1",value:f.SSN,use:"official",label:"Social Security Number",assigner:{display:"Social Security Administration"}},{system:"urn:oid:2.16.840.1.113883.15.34",value:f.registered,use:"official",label:e+" master Id",assigner:{reference:b,display:e}}],managingOrganization:{reference:b,display:e},link:[],active:!0},k=d(function(){},5e3);k.then(function(){i(j).then(function(a){B("Created relatedPerson "+f.name.first+" "+f.name.last+" at "+(a.headers.location||a.headers["content-location"]),null,!1)},function(a){A("Failed to create relatedPerson "+f.name.first+" "+f.name.last,a,!1)})})}),f.resolve()}).error(function(a){f.reject(a)}),f.promise}function v(a){f.addToCache(z,a)}function w(a,b){x(b);var c=C.defer();return g.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function x(a){return 0===a.address.length&&(a.address=null),0===a.identifier.length&&(a.identifier=null),0===a.telecom.length&&(a.telecom=null),0===a.link.length&&(a.link=null),C.when(a)}var y="localRelatedPersons",z="contextRelatedPerson",A=e.logger.getLogFn(b,"error"),B=e.logger.getLogFn(b,"info"),C=e.$q,D={addRelatedperson:i,clearCache:j,deleteCachedRelatedperson:k,deleteRelatedperson:l,getCachedRelatedperson:m,getCachedSearchResults:n,getRelatedperson:o,getRelatedpersonContext:p,getRelatedpersonReference:q,getRelatedpersons:r,initializeRelatedperson:t,seedNewRelatedperson:s,seedRandomRelatedpersons:u,setRelatedpersonContext:v,updateRelatedperson:w};return D}var b="relatedPersonService";angular.module("FHIRCloud").factory(b,["$filter","$http","$timeout","common","dataCache","fhirClient","fhirServers",a])}(),function(){"use strict";function a(a,c,d,e){function f(b){var d=a.items[b];c.hide(d)}function g(){d.activateController(b).then(function(){})}a.items=e,a.listItemClick=f,a.activate=g,g()}var b="bottomSheetController";angular.module("FHIRCloud").controller(b,["$scope","$mdBottomSheet","common","items",a])}(),function(){"use strict";function a(a,c,d,e){function f(){d.activateController(b).then(function(){g()})}function g(){e.getActiveServer().then(function(a){return h.activeServer=a,a.secure?"https":"http"}).then(function(b){switch(a.profile){case"patient":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/patient-daf.html");

break;case"allergyIntolerance":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/allergyintolerance-daf.html");break;case"organization":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/diagnosticorder-daf.html");break;case"diagnosticReport":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/diagnosticreport-daf.html");break;case"encounter":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/encounter-daf.html");break;case"familyHistory":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/familymemberhistory-daf.html");break;case"immunization":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/immunization-daf.html");break;case"results":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/observation-daf-results.html");break;case"medication":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/medication-daf.html");break;case"condition":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/condition-daf.html");break;case"medicationAdministration":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/medicationadministration-daf.html");break;case"medicationStatement":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/medicationstatement-daf.html");break;case"procedure":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/procedure-daf.html");break;case"smokingStatus":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/observation-daf-smokingstatus.html");break;case"vitalSigns":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/observation-daf-vitalsigns.html");break;case"list":h.dafUrl=c.trustAsResourceUrl(b+"://hl7-fhir.github.io/list-daf.html");break;case"organization":h.dafUrl=b+"://hl7-fhir.github.io/patient-daf-dafpatient.html";break;default:h.dafUrl=b+"://hl7-fhir.github.io/patient-daf-dafpatient.html"}})}var h=this;h.dafUrl="",h.activate=f,f()}var b="dafController";angular.module("FHIRCloud").controller(b,["$routeParams","$sce","common","fhirServers",a])}(),function(){"use strict";function a(a,c,d,e){function f(){c.hide()}function g(){d.activateController(b).then(function(){})}a.data=angular.toJson(e,!0),a.closeDialog=f,a.activate=g,g()}var b="rawDataController";angular.module("FHIRCloud").controller(b,["$scope","$mdDialog","common","data",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h){function i(){c.hide()}function j(){g.getActiveServer().then(function(b){return a.activeServer=b,a.activeServer})}function k(){d.activateController([j()],b).then(function(){l(a.data)})}function l(b){h.getValueSets(a.activeServer.baseUrl,void 0,b).then(function(b){a.options=void 0,a.valueSet=b.entry[0].resource,angular.isDefined(a.valueSet.define)?(o("Value set defines its own concepts",null,r),a.system=a.valueSet.define.system,a.options=a.valueSet.define.concept,a.valueSet.selectedCode=a.options[0],n()):angular.isDefined(a.valueSet.compose)&&angular.isArray(a.valueSet.compose.include)&&(o("Value set includes concepts",null,r),a.system=a.valueSet.compose.include[0].system,a.options=a.valueSet.compose.include[0].concept,a.valueSet.selectedCode=a.options[0],n())},function(a){p("Error returning value set",a)})}function m(b){var c=q.defer();return a.fetchingExpansion=!0,h.getFilteredExpansion(a.activeServer.baseUrl,a.valueSet.id,b).then(function(b){a.fetchingExpansion=!1,c.resolve(b)},function(b){a.fetchingExpansion=!1,p(b,null,r),c.reject()}),c.promise}function n(){void 0===a.valueSet.selectedCode.system&&(a.valueSet.selectedCode.system=a.system)}var o=d.logger.getLogFn(b,"info"),p=d.logger.getLogFn(b,"error"),q=d.$q,r=!1;a.data=f,a.closeDialog=i,a.activate=k,a.expandValueSet=m,a.selectionChanged=n,a.fetchingExpansion=!1,k()}var b="valueSetPopupController";angular.module("FHIRCloud").controller(b,["$scope","$mdDialog","common","config","data","fhirServers","valueSetService",a])}(),function(){"use strict";function a(a,c,d,e,f,g,h,i){function j(){}function k(){return!v.isEditing}function l(){return!v.isSaving}function m(b){function c(){b&&b.resourceId&&b.hashKey&&h.deleteCachedValueSet(b.hashKey,b.resourceId).then(function(){x("Deleted valueSet "+b.name),a.path("/valueSets")},function(a){w(f.unexpectedOutcome(a))})}var d=e.confirm().title("Delete "+b.name+"?").ok("Yes").cancel("No");e.show(d).then(c)}function n(b){b&&b.hashKey&&a.path("/valueSet/edit/"+b.hashKey)}function o(){g.getActiveServer().then(function(a){return v.activeServer=a,v.activeServer})}function p(){function a(a){var b=angular.copy(a.resource);v.narrative=b.text.div||"<div>Not provided</div>",v.json=b,v.json.text={div:"see narrative tab"},v.json=angular.toJson(b,!0),v.valueSet=b,i.init(v.valueSet.telecom,!1,!1),v.title=v.valueSet.name}if("new"===c.hashKey){var b=h.initializeNewValueSet();a(b),v.title="Add New ValueSet",v.isEditing=!1}else if(c.hashKey)h.getCachedValueSet(c.hashKey).then(a).then(function(){},function(a){w(a)});else if(c.id){var d=v.activeServer.baseUrl+"/ValueSet/"+c.id;h.getValueSet(d).then(a,function(a){w(a)})}}function q(){var a="";return a=v.valueSet?v.title="Edit "+(v.valueSet&&v.valueSet.fullName||""):v.title="Add New ValueSet",v.title=a,v.title}function r(){d.history.back()}function s(a){var b=a.headers.location||a.headers["content-location"];angular.isUndefined(b)?y("ValueSet saved, but location is unavailable. CORS not implemented correctly at remote host."):(v.valueSet.resourceId=f.setResourceId(v.valueSet.resourceId,b),x("ValueSet saved at "+b)),v.isEditing=!0,q()}function t(){if(v.valueSet.name.length<5)return void w("ValueSet Name must be at least 5 characters");var a=h.initializeNewValueSet().resource;a.name=v.valueSet.name,a.type=v.valueSet.type,a.telecom=i.mapFromViewModel(),a.partOf=v.valueSet.partOf,a.active=v.valueSet.active,v.isEditing?h.updateValueSet(v.valueSet.resourceId,a).then(s,function(a){w(f.unexpectedOutcome(a))}):h.addValueSet(a).then(s,function(a){w(f.unexpectedOutcome(a))})}function u(){f.activateController([o()],b).then(function(){p()})}var v=this,w=f.logger.getLogFn(b,"error"),x=f.logger.getLogFn(b,"success"),y=f.logger.getLogFn(b,"warning");Object.defineProperty(v,"canSave",{get:l}),Object.defineProperty(v,"canDelete",{get:k}),v.activeServer=null,v.cancel=j,v.activate=u,v["delete"]=m,v.edit=n,v.goBack=r,v.isSaving=!1,v.isEditing=!0,v.valueSet=void 0,v.save=t,v.states=void 0,v.title="valueSetDetail",u()}var b="valueSetDetail";angular.module("FHIRCloud").controller(b,["$location","$routeParams","$window","$mdDialog","common","fhirServers","valueSetService","contactPointService",a])}(),function(){"use strict";function a(a,c,d,e,f){function g(){e.getActiveServer().then(function(a){return t.activeServer=a,t.activeServer})}function h(){f.getCachedSearchResults().then(k)}function i(){c.activateController([g(),h()],b).then(function(){})}function j(b){b&&a.path("/valueSet/view/"+b)}function k(a){a&&(t.valueSets=a.entry||[],t.paging.links=a.link||[],t.paging.totalResults=a.total||0)}function l(a){a&&(o(!0),f.getValueSets(t.activeServer.baseUrl,t.searchText).then(function(a){return r("Returned "+(angular.isArray(a.entry)?a.entry.length:0)+" ValueSets from "+t.activeServer.name,!1),a},function(a){o(!1),s(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(k).then(function(){o(!1)}))}function m(a){o(!0),f.getValueSetsByLink(a).then(function(a){return r("Returned "+(angular.isArray(a.valueSets)?a.valueSets.length:0)+" ValueSets from "+t.activeServer.name,!0),a},function(a){o(!1),s(angular.isDefined(a.outcome)?a.outcome.issue[0].details:a)}).then(k).then(function(){o(!1)})}function n(a){a.keyCode===p.esc&&(t.searchText="")}function o(a){t.isBusy=a}var p=d.keyCodes,q=c.logger.getLogFn,r=q(b,"info"),s=q(b,"error"),t=this;t.activeServer=null,t.isBusy=!1,t.valueSets=[],t.errorOutcome=null,t.paging={currentPage:1,totalResults:0,links:null},t.searchResults=null,t.searchText="",t.title="ValueSets",t.keyPress=n,t.dereferenceLink=m,t.submit=l,t.goToDetail=j,i()}var b="valueSetSearch";angular.module("FHIRCloud").controller(b,["$location","common","config","fhirServers","valueSetService",a])}(),function(){"use strict";function a(a,c,d,e){function f(a){s(a).then(function(a){a.type.coding=t(a.type.coding)});var b=x.defer();return e.getActiveServer().then(function(c){var e=c.baseUrl+"/ValueSet";d.addResource(e,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})}),b.promise}function g(){c.addToCache(u,null)}function h(a,b){function d(b){for(var d=!1,f=b.entry,g=0,h=f.length;h>g;g++)if(f[g].$$hashKey===a){f.splice(g,1),b.entry=f,b.totalResults=b.totalResults-1,c.addToCache(u,b),d=!0;break}d?e.resolve():(w("ValueSet not found in cache: "+a),e.resolve())}var e=x.defer();return i(b).then(j,function(a){e.reject(a)}).then(d).then(function(){e.resolve()}),e.promise}function i(a){var b=x.defer();return d.deleteResource(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise}function j(){var a=x.defer(),b=c.readFromCache(u);return b?a.resolve(b):a.reject("Search results not cached."),a.promise}function k(a){function b(b){var d,e=b.entry;d=_.find(e,{$$hashKey:a}),d?c.resolve(d):c.reject("ValueSet not found in cache: "+a)}var c=x.defer();return j().then(b,function(){c.reject("ValueSet search results not found in cache.")}),c.promise}function l(a){var b=x.defer();return d.getResource(a).then(function(a){c.addToCache(u,a.data),b.resolve(a.data)},function(a){b.reject(a)}),b.promise}function m(a,b){var c=x.defer();return d.getResource(a+"/ValueSet?name="+b+"&_count=20").then(function(a){var b=[];a.data.entry&&angular.forEach(a.data.entry,function(a){b.push({display:a.resource.name,reference:a.resource.id})}),0===b.length&&b.push({display:"No matches",reference:""}),c.resolve(b)},function(a){c.reject(a)}),c.promise}function n(a,b,e){var f=x.defer(),g="";if(angular.isUndefined(b)&&angular.isUndefined(e)&&f.reject("Invalid search input"),angular.isDefined(b)&&b.length>1&&(g="name="+b),angular.isDefined(e)){var h="identifier="+e;g=g.length>1?g+"&"+h:h}return d.getResource(a+"/ValueSet?"+g+"&_count=20").then(function(a){c.addToCache(u,a.data),f.resolve(a.data)},function(a){f.reject(a)}),f.promise}function o(a){var b=x.defer();return d.getResource(a).then(function(a){var c={links:{},valueSets:[]},d=[];a.data.entry&&angular.forEach(a.data.entry,function(a){a.content&&"ValueSet"===a.content.resourceType&&d.push({display:a.content.name,reference:a.id})}),0===d.length&&d.push({display:"No matches",reference:""}),c.valueSets=d,a.data.link&&(c.links=a.data.link),c.totalResults=a.data.totalResults?a.data.totalResults:0,b.resolve(c)},function(a){b.reject(a)}),b.promise}function p(){var a={};return a.resource={resourceType:"ValueSet",active:!0},a}function q(a,b,c){var e=x.defer();return d.getResource(a+"/ValueSet/"+b+"/$expand?filter="+c+"&_count=10").then(function(a){a.data&&a.data.expansion&&angular.isArray(a.data.expansion.contains)?e.resolve(a.data.expansion.contains):e.reject("Response did not include expected expansion")}),e.promise}function r(a,b){s(b).then(function(a){a.type.coding=t(a.type.coding)});var c=x.defer();return d.updateResource(a,b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}function s(a){return x.when(a)}function t(a){var b=null;if(angular.isArray(a)&&angular.isDefined(a[0]))if(angular.isObject(a[0]))b=a;else{var c=JSON.parse(a[0]);b=[],b.push(c?c:null)}return b}var u="localValueSets",v=a.logger.getLogFn,w=v(b,"warning"),x=a.$q,y={addValueSet:f,clearCache:g,deleteCachedValueSet:h,deleteValueSet:i,getFilteredExpansion:q,getCachedValueSet:k,getCachedSearchResults:j,getValueSet:l,getValueSets:n,getValueSetsByLink:o,getValueSetReference:m,initializeNewValueSet:p,updateValueSet:r};return y}var b="valueSetService";angular.module("FHIRCloud").factory(b,["common","dataCache","fhirClient","fhirServers",a])}();