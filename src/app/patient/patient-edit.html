<div ng-controller="patientDetail as vm" layout="row" layout-wrap>
    <div flex="100">
        <h3 ng-if="vm.isEditing === false">Add New Patient</h3>

        <h3 ng-if="vm.isEditing === true">Edit {{vm.patient.name | fullName}}</h3>
    </div>
    <div flex="20">
        <md-button class="actions" md-no-ink ng-click="vm.actions($event)" aria-label="Actions">
            <md-icon md-svg-icon="actions"></md-icon>
        </md-button>
    </div>
    <div flex="100">
        <form name="patientEditForm" class="form-horizontal"
              ng-model="vm.patient">
            <md-tabs>
                <md-tab label="Name">
                    <div ng-include="'elements/humanName/humanName.html'"></div>
                </md-tab>
                <md-tab label="Demographics">
                    <div ng-include="'elements/demographics/demographics.html'"></div>
                </md-tab>
                <md-tab label="Address">
                    <div ng-include="'elements/address/address.html'"></div>
                </md-tab>
                <md-tab label="Telecom">
                    <div ng-include="'elements/contactPoint/contactPoint.html'"></div>
                </md-tab>
                <md-tab label="Contact">
                    <div ng-include="'elements/contact/contact.html'"></div>
                </md-tab>
                <md-tab label="Photo">
                    <div ng-include="'elements/attachment/attachment.html'"></div>
                </md-tab>
                <md-tab label="Identifier">
                    <div ng-include="'elements/identifier/identifier.html'"></div>
                </md-tab>
                <md-tab label="Care Providers">
                    <div class="form-group col-md-12">
                        <legend>Care&nbsp;Providers</legend>
                        <div class="controls col-md-10 col-md-offset-2">
                            <div class="form-group col-md-10">
                                <input required
                                       type="text"
                                       id="care-provider"
                                       class="form-control"
                                       placeholder="Start typing provider name to begin search"
                                       typeahead="item as item.display for item in vm.getPractionerReference($viewValue) | filter:$viewValue"
                                       typeahead-loading="vm.loadingPractitioners"
                                       typeahead-wait-ms="300"
                                       typeahead-editable="false"
                                       typeahead-min-length="5"
                                       ng-model="vm.patient.careProvider">
                            </div>
                            <div class="form-group col-md-10"
                                 ng-show="vm.patient.careProvider.reference">
                                <a class="control-label" href="{{vm.patient.careProvider.reference}}"
                                   target="_blank">Referenced Provider:
                                    {{vm.patient.managingOrganization.display || "Name Not Specified" }}</a>
                            </div>
                        </div>
                    </div>

                    <div class="form-group col-md-12">
                        <legend>Managing&nbsp;Organization</legend>
                        <div class="controls col-md-10 col-md-offset-2">
                            <div class="form-group col-md-10">
                                <input required
                                       type="text"
                                       id="managing-organization"
                                       class="form-control"
                                       placeholder="Start typing organization name to begin search"
                                       typeahead="item as item.display for item in vm.getOrganizationReference($viewValue) | filter:$viewValue"
                                       typeahead-loading="vm.loadingOrganizations"
                                       typeahead-wait-ms="300"
                                       typeahead-editable="false"
                                       typeahead-min-length="5"
                                       ng-model="vm.patient.managingOrganization">
                            </div>
                            <div class="form-group col-md-10"
                                 ng-show="vm.patient.managingOrganization.reference">
                                <a class="control-label"
                                   ng-href="{{vm.patient.managingOrganization.reference}}"
                                   target="_blank">Referenced Organization:
                                    {{vm.patient.managingOrganization.display || "Name Not Specified" }}</a>
                            </div>
                        </div>
                    </div>
                </md-tab>
            </md-tabs>
            <div layout="row" layout-align="end end">
                <md-button ng-click="vm.save()" aria-label="Execute save">
                    <md-icon md-svg-icon="saveToCloud" aria-label="save patient" alt="Save Patient"></md-icon>
                </md-button>
                <md-progress-linear md-mode="indeterminate" ng-if="vm.isBusy"></md-progress-linear>
            </div>
        </form>
    </div>
</div>