<section data-ng-controller="patientDetail as vm">
    <md-content id="patientDetail">
        <div layout="row" layout-wrap >
            <div flex="15" hide-sm>
                <img data-fs-img-person="vm.patient.photo[0]"
                     class="largeFace" src="/img/unknown_person.jpg"/>
            </div>
            <div flex="85">
                <h3>{{ vm.patient.name | fullName }}</h3>
                <md-tabs md-selected="selectedIndex">
                    <md-tab label="Administration Detail">
                        <table class="table table-striped table-hover">
                            <tr>
                                <td>Resource Id</td>
                                <td>
                                    {{vm.patient.resourceId}}
                                </td>
                            </tr>
                            <tr>
                                <td>Name</td>
                                <td>{{vm.patient.name | fullName }}</td>
                            </tr>
                            <tr>
                                <td>Date of Birth</td>
                                <td>
                                    <div data-ng-show="vm.patient.birthDate">
                                        {{vm.patient.birthDate | date: longDate}}
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Gender</td>
                                <td>
                                    {{vm.patient.gender}}
                                </td>
                            </tr>
                            <tr>
                                <td>Addresses</td>
                                <td>
                                    <p class="small" data-ng-repeat="a in vm.patient.address">
                                        <strong>{{a.use}}</strong>: {{a | singleLineAddress}}
                                    </p>
                                </td>
                            </tr>
                            <tr>
                                <td>Telecommunication</td>
                                <td>
                                    <p class="small" data-ng-repeat="t in vm.patient.telecom">
                                        <strong>{{t.use}} {{t.system}}</strong>: {{t.value}}
                                    </p>
                                </td>
                            </tr>
                            <tr>
                                <td>Contact</td>
                                <td>
                                    <p class="small" data-ng-repeat="c in vm.patient.contact">
                                        {{c.name.given.join(' ')}} {{c.name.family.join(' ')}}
                                        ({{c.relationship.text || "relationship unspecified"}})
                                    </p>
                                </td>
                            </tr>
                            <tr>
                                <td>Links</td>
                                <td>
                                    <div data-ng-repeat="l in vm.patient.link">
                                        <a href="{{l.other.reference}}">{{l.other.type || "Link Type Unspecified"}}</a>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Languages</td>
                                <td>
                                    <p class="small" data-ng-repeat="l in vm.patient.communication">
                                        {{l | codeableConcept}}<br/>
                                    </p>
                                </td>
                            </tr>
                            <tr>
                                <td>Marital Status</td>
                                <td>
                                    {{vm.patient.maritalStatus | codeableConcept}}
                                </td>
                            </tr>
                            <tr>
                                <td>Multiple Birth</td>
                                <td>
                                    {{vm.patient.multipleBirthInteger || vm.patient.multipleBirthBoolean}}
                                </td>
                            </tr>
                            <tr>
                                <td>Deceased</td>
                                <td>
                                    {{vm.patient.deceasedDateTime || vm.patient.deceasedBoolean}}
                                </td>
                            </tr>
                            <tr>
                                <td>Managing Organization</td>
                                <td>
                                    <a href="{{vm.patient.managingOrganization.reference}}">{{vm.patient.managingOrganization.display}}</a>
                                </td>
                            </tr>
                            <tr data-ng-show="vm.patient.identifier">
                                <td>Identifiers</td>
                                <td>
                                    <table class="table table-striped table-hover small">
                                        <thead>
                                        <tr>
                                            <th>System</th>
                                            <th>Value</th>
                                            <th>Label</th>
                                            <th>Use</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr data-ng-repeat="id in vm.patient.identifier">
                                            <td>{{id.system}}</td>
                                            <td>{{id.value}}</td>
                                            <td>{{id.label}}</td>
                                            <td>{{id.use}}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td>Active</td>
                                <td>
                                    <i data-fs-true-check="vm.patient.active"></i>
                                </td>
                            </tr>
                        </table>
                    </md-tab>
                    <md-tab label="Clinical Summary">
                        <table class="table table-striped table-hover">
                            <thead>
                            <tr>
                                <th></th>
                                <th>Date</th>
                                <th>Description</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr data-ng-repeat="item in vm.summary">
                                <td>
                                    <md-button layout="row" layout-align="start center"
                                               ng-click="vm.showClinicalData($index, $event)"
                                               aria-label="{{item.resource.id}}">
                                        <md-icon icon="img/visibility1.svg"
                                                 style="width: 20px; height: 20px;"></md-icon>
                                    </md-button>
                                </td>
                                <td>
                                    {{ item.resource.resourceType }}
                                </td>
                                <td>
                                    <div data-ng-if="item.resource.text.div" data-ng-bind-html="item.resource.text.div">
                                    </div>
                                    <div data-ng-if="item.resource.emptyReason.text">
                                        {{ item.resource.emptyReason.text }}
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </md-tab>
                    <md-tab label="Audit History">
                        <table class="table table-striped table-hover">
                            <thead>
                            <tr>
                                <th></th>
                                <th>Date</th>
                                <th>User</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr data-ng-repeat="ev in vm.history">
                                <td>
                                    <md-button layout="row" layout-align="start center"
                                               ng-click="vm.showAuditData($index, $event)"
                                               aria-label="{{ev.resource.id}}">
                                        <md-icon icon="img/visibility1.svg"
                                                 style="width: 20px; height: 20px;"></md-icon>
                                    </md-button>
                                </td>
                                <td>
                                    {{ev.resource.event.dateTime | date: 'short'}}
                                </td>
                                <td>
                                    <p data-ng-repeat="p in ev.resource.participant">{{p.name}}</p>
                                </td>
                                <td>

                                    {{ev.resource.event.subtype[0].coding[0].display}}
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </md-tab>
                </md-tabs>
            </div>
                <md-button md-no-ink data-ng-click="vm.patientActionsMenu($event)" class="md-primary">Actions
                </md-button>
        </div>
    </md-content>
</section>